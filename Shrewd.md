
# Shrewd 規格

Shrewd 是一個用於 TypeScript 前端開發專用的反應式框架。
Shrewd 的執行週期分成手動階段（manual stage）和認可階段（commiting stage）兩個階段。

- 在手動階段中，Shrewd 有如不存在一樣，此時若呼叫觀測者（雖然除了初始化反應方法之外不建議這麼做）會直接進行 top-down 的執行。
- 在認可階段中，會 bottom-up 地執行未更新的觀測者的操作。

## 可觀測物件（Observable）

- 可觀測物件會在自身狀態發生改變的時候對訂閱的觀測者發送通知。

## 自由物件（Independent）

- 可以被寫入的可觀測物件稱為自由物件。自由物件是資料流的起點。
- 自由物件只能在手動階段中被寫入，如果在認可階段中進行寫入，會忽略寫入並且在主控台中輸出警告。
- 自由物件具有稽核方法，稽核方法會在自由物件發生寫入的時候檢查寫入值並且設置一個經過稽核的輸出值。預設的稽核行為是原封不動地輸出。
- 自由物件的稽核方法可能會參照到別的可觀測物件，因此雖然名為自由物件，但是它的相依度未必是零。
- 稽核行為有可能會對自由物件內部的狀態進行不可逆的修改（例如刪除掉陣列中符合某種條件的元素）。
- 如果一個自由物件並沒有被一個反應方法間接訂閱，那麼它在發生改變的時候將不會送出任何通知，直到未來有反應方法重新間接訂閱了這個自由物件。

## 觀測者

- 觀測者在執行的時候會側錄執行過程中讀取可觀測物件的行為，並且在讀取的時候對該物件進行訂閱。
- 觀測者在任何一次執行完畢都進入「已更新」狀態，而在接到任何訂閱對象的新通知時變成「未更新」狀態。
- 觀測者在手動階段中無論更新與否，被呼叫的時候都會重新執行。
- 觀測者在認可階段中只有在未更新的時候被呼叫會真的執行，如果已更新，則呼叫時會直接傳回暫存值。

## 計算屬性

- 計算屬性在被呼叫的時候如果沒有訂閱者，且它此時也不是被一個觀測者所呼叫，那麼它就不會對參照對象進行訂閱，從而清空參照。
- 如果上述的呼叫是發生在認可階段，那麼它甚至不會真的執行，而直接傳回暫存值。

## 反應方法

- 反應方法在概念上是資料流的終點，不過它仍然可以被其它觀測者呼叫（尤其是繼承類別中的同名方法）。
- 由於呼叫它的觀測者有可能會使用到它或許會有的傳回值，因此任何觀測者只要有呼叫它都視為是有參照它，無論它是否有傳回值（畢竟或許沒有傳回值對呼叫它的觀測者來說也有其意義）。