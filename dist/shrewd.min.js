/**
 * shrewd v0.0.0-beta.12
 * (c) 2019-2020 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t{constructor(t,e,s,i){this.t=t,this.s=e,this.i=s,this.h=i}get o(){return this.t.constructor.name+"."+this.s.toString()}}class e{constructor(){this.u=new Set,this.l=e.$++}static p(t){return!(!k.m&&t.g)||(k.j&&!k.v(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),r.S.debug,!1):!(!k.j&&k.O)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty. For constructing new Shrewd objects, use Shrewd.construct() method."),r.S.debug,!1))}static _(t){r.S.hook.write(t.l);for(let e of t.u)e.k()}R(t){this.u.add(t)}C(t){this.u.delete(t)}get g(){return this.u.size>0}get P(){return this.u.values()}}e.$=0;class s{read(t){}write(t){}gc(){}sub(t){return!1}}class i{constructor(){this.A=new Vue({data:{shrewd:{}}})}read(t){t in this.A.shrewd||this.write(t),this.A.shrewd[t]}write(t){Vue.set(this.A.shrewd,t,{})}gc(){for(let t in this.A.shrewd)0==this.A.shrewd[t].G.dep.subs.length&&Vue.delete(this.A.shrewd,t)}sub(t){return t in this.A.shrewd&&this.A.shrewd[t].G.dep.subs.length>0}}class r{static D(){k.M({O:!0});try{for(let t of r.F)f.T(t)}finally{f.V(),r.F.clear(),k.W();for(let t of r.q)t.H();r.q.clear(),r.S.hook.gc()}}static I(){r.D(),r.B=!1}static J(t){r.F.delete(t)}static K(t){if(t.L||r.F.add(t),r.S.autoCommit&&!r.B){Promise.resolve().then(r.I),r.B=!0}}static N(t,...e){k.M({m:!0,O:!1,U:null}),f.X.push("construct "+t.name);try{return new t(...e)}finally{f.X.pop(),k.W()}}static H(t,e=!1){if(c.Y(t,h)){let s=t[h];e?r.q.add(s):s.H()}}}r.S={hook:new s,autoCommit:!0,debug:!0},r.F=new Set,r.q=new Set,r.B=!1;class n{static get(t){if(c.Y(t,R))return t[R];{let e=[];return c.Z(t,R,e),e}}static tt(t,e,s,i){if(void 0===e)return(e,s,i)=>n.tt(e,s,i,t);if("string"==typeof e){let r=s||Object.getOwnPropertyDescriptor(t,e);if(!r)return n.et(a,t,e,void 0,i);if(r.get&&!r.set)return n.et(O,t,e,r);if("function"==typeof r.value)return n.et(_,t,e,r,i)}console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. `+"Decorated member must be one of the following: a field, a readonly get accessor, or a method."),r.S.debug}static et(t,e,s,i,r){var h=new t(e,s,i,r);if(!h.st||h.st())return n.get(e).push(h.it),h.rt()}}const h=Symbol("ShrewdObject");class o{constructor(t){this.nt=!1,this.ht=new Map,this.ot=c.Z(t,h,this);let e=Object.getPrototypeOf(this.ot);for(;e;){if(c.Y(e,R)){let t=e[R];for(let e of t)this.et(e)}e=Object.getPrototypeOf(e)}}static get(t){return c.Y(t,h)?t[h]:new o(t)}et(t){this.ht.set(t.ct,new t.ut(this.ot,t))}H(){if(!this.nt){for(let t of this.ht.values())t.H();this.nt=!0}}at(t){return this.ht.get(t)}get lt(){let t=[];for(let e of this.ht.values())e instanceof j&&t.push(e);return t}}class c{static Y(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static Z(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class u{get(t,e,s){let i=t[d],r=Reflect.get(t,e);return"function"==typeof r&&(r=this.ft.bind({dt:e,U:t,$t:r.bind(t),pt:i,bt:s})),"size"==e&&f.gt(t[d]),r}ft(...t){switch(this.dt){case"clear":return void(f.p(this.pt)&&this.U.size>0&&(this.U.clear(),e._(this.pt)));case"delete":return void(f.p(this.pt)&&this.U.has(t[0])&&(this.U.delete(t[0]),e._(this.pt)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":f.gt(this.pt);default:return this.$t(...t)}}}class a extends t{precondition(){return!Object.getOwnPropertyDescriptor(this.t,this.s)||(console.warn(`Setup error at ${this.t.constructor.name}[${this.s.toString()}]. `+"Decorated property is not a field."),r.S.debug,!1)}get it(){return{ct:this.s,yt:this.o,ut:j,S:this.h}}rt(){var t=this.t,e=this.s;Object.defineProperty(t,e,{get(){return o.get(this),this[e]},set(t){o.get(this),this[e]=t}})}}var l;!function(t){t[t.wt=0]="$outdated",t[t.jt=1]="$updated",t[t.vt=2]="$pending"}(l||(l={}));class f extends e{constructor(t){super(),this.St=new Set,this.xt=!1,this.Ot=l.wt,this.nt=!1,this.o=t}static V(){for(let t of f._t)t.Ot==l.vt&&t.kt&&(t.Rt(),f._t.delete(t))}static gt(t){if(t instanceof f&&t.nt)return;r.S.hook.read(t.l);let e=k.U;e&&e!=t&&!e.nt&&e.St.add(t)}static Ct(t){if(t instanceof f&&!t.nt&&(t.Pt=t.checkActive(),!t.kt)){let e=new Set(t.St);r.J(t);for(let t of e)f.Ct(t)}}static T(t){k.M({m:!1,U:t}),t.xt=!0,r.J(t);try{let e=new Set(t.St);t.At();let s=t.T();if(t.Rt(),!t.nt)for(let s of t.St)e.delete(s),s.R(t),t.kt&&s instanceof f&&s.activate();for(let t of e)f.Ct(t);return s}finally{t.xt=!1,k.W()}}get L(){return this.xt}k(){this.Gt(),this.Dt(),this.kt&&r.K(this)}H(){this.nt||(r.J(this),f._t.delete(this),this.nt=!0,this.Mt())}Mt(){this.At();for(let t of this.P)t.St.delete(this),this.C(t);this.Rt(),this.xt=!1}Gt(){if(this.Ot==l.jt){this.Ot=l.vt,f._t.add(this);for(let t of this.P)t.Gt()}}Ft(t=!1){if(this.xt&&this.Tt(),this.Ot!=l.jt){f.X.push(this);try{for(let t of this.St)if(t instanceof f){if(t.xt){f.T(this);break}t.Ot!=l.jt&&t.Ft()}this.Ot==l.wt||t?f.T(this):(f._t.delete(this),this.Rt())}finally{f.X.pop()}}}Tt(){let t=f.X.indexOf(this),e=[this,...f.X.slice(t+1)];e.forEach(t=>t instanceof f&&t.H()),e.push(this);let s=e.map(t=>"string"==typeof t?t:t.o).join(" => ");console.warn("Cyclic dependency detected: "+s+"\nAll these reactions will be terminated."),r.S.debug}Rt(){this.Ot=l.jt}Dt(){this.Ot=l.wt}get Vt(){return this.Ot}get kt(){return this.Pt=null!=this.Pt?this.Pt:this.checkActive()}checkActive(){if(r.S.hook.sub(this.l))return!0;for(let t of this.P)if(t.kt)return!0;return!1}activate(){if(!this.kt){this.Pt=!0;for(let t of this.St)t instanceof f&&t.activate()}}At(){for(let t of this.St)t.C(this);this.St.clear()}get Wt(){return this.nt}}f._t=new Set,f.X=[];const d=Symbol("Observable Helper");class $ extends e{constructor(t,e){super(),this.qt=c.Z(t,d,this),this.Et=new Proxy(t,e),$.Ht.set(t,this.Et)}static zt(t){if(null==t||"object"!=typeof t)return t;if($.Ht.has(t))return $.Ht.get(t);if(!$.It(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new S(t).Bt;break;case Set.prototype:t=new g(t).Bt;break;case Map.prototype:t=new y(t).Bt;break;case Object.prototype:t=new m(t).Bt}return t}static It(t){return null!=t&&"object"==typeof t&&c.Y(t,d)}get Bt(){return this.Et}}$.Ht=new WeakMap;class p extends f{constructor(t,e){super(e.yt),this.Jt=Object.assign(this.Kt,e.S),this.ot=t}get Kt(){return{}}checkActive(){return!!this.Jt.active||super.checkActive()}Lt(){return this.Wt?this.Nt():(f.gt(this),k.O?this.Qt():this.Ut())}}class b{has(t,e){return f.gt(t[d]),Reflect.has(t,e)}get(t,e,s){return f.gt(t[d]),Reflect.get(t,e,s)}set(t,s,i,r){let n=t[d];if(e.p(n)){return i!==Reflect.get(t,s,r)&&(Reflect.set(t,s,$.zt(i),r),e._(n)),!0}return!0}deleteProperty(t,s){let i=t[d];if(e.p(i)){let r=Reflect.deleteProperty(t,s);return r&&e._(i),r}return!0}}class m extends ${constructor(t){for(let e in t)t[e]=$.zt(t[e]);super(t,m.Xt)}get Yt(){let t=[];for(let e in this.qt){let s=this.qt[e];"object"==typeof s&&t.push(s)}return t}}m.Xt=new b;class g extends ${constructor(t){for(let e of t)t.delete(e),t.add($.zt(e));super(t,g.Xt)}get Yt(){let t=[];for(let e of this.qt)"object"==typeof e&&t.push(e);return t}}g.Xt=new class extends u{ft(...t){return"add"==this.dt?(f.p(this.pt)&&!this.U.has(t[0])&&(this.U.add($.zt(t[0])),e._(this.pt)),this.bt):super.ft.apply(this,t)}};class y extends ${constructor(t){for(let[e,s]of t)t.set(e,$.zt(s));super(t,y.Xt)}get Yt(){let t=[];for(let[e,s]of this.qt)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}y.Xt=new class extends u{ft(...t){return"set"==this.dt?(f.p(this.pt)&&!this.U.has(t[0])&&(this.U.set(t[0],$.zt(t[1])),e._(this.pt)),this.bt):super.ft.apply(this,t)}};class w extends p{constructor(t,e){super(t,e),this.Zt=e.$t}T(){let t=this.Zt.apply(this.ot);t!=this.te&&(this.te=t,e._(this))}Ut(){return this.o,this.te}Qt(){return this.Ft(),this.te}Nt(){return this.te}}class j extends p{constructor(t,e){super(t,e),Object.defineProperty(t,e.ct,j.ee(e.ct)),this.Jt.renderer||this.Rt()}static ee(t){return j.se[t]=j.se[t]||{get(){return o.get(this).at(t).Lt()},set(e){o.get(this).at(t).ie(e)}}}static re(t){if(null!=t&&"object"==typeof t)if($.It(t)){if(!k.v(t[d])){k.re(t[d]);for(let e of t[d].Yt)j.re(e)}}else if(c.Y(t,h))for(let e of o.get(t).lt)k.v(e)||(k.re(e),j.re(e.ne))}Dt(){this.Jt.renderer&&super.Dt()}Ut(){return this.Vt!=l.jt?this.he:this.ne}Qt(){return this.Jt.renderer&&this.Ft(),this.ne}Nt(){return this.ne}ie(t){if(this.Wt)this.ne=t;else if(e.p(this)&&t!==this.he){if(this.Jt.validator&&!this.Jt.validator.apply(this.ot,[t]))return r.S.hook.write(this.l);this.he=$.zt(t),this.Jt.renderer?this.k():this._(this.he)}}T(){k.M({j:!0,oe:new Set});try{j.re(this.he);let t=this.Jt.renderer.apply(this.ot,[this.he]);t!==this.ne&&this._($.zt(t))}finally{k.W()}}_(t){this.ne=t,e._(this)}Mt(){delete this.he,delete this.Jt,super.Mt()}}j.se={};class v extends p{constructor(t,e){super(t,e),this.ft=e.$t}get Kt(){return{active:!0}}Ut(){return this.Vt==l.jt?()=>this.ce:()=>(this.k(),this.ce)}Qt(){return()=>(this.Ft(),this.ce)}Nt(){return()=>this.ce}T(){return this.ce=this.ft.apply(this.ot),e._(this),this.ce}}class S extends ${constructor(t){for(let e in t)t[e]=$.zt(t[e]);super(t,S.Xt)}get Yt(){let t=[];for(let e of this.qt)"object"==typeof e&&t.push(e);return this.qt}}S.Xt=new class extends b{get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&f.gt(t[d]),Reflect.get(t,e,s)}};const x={shrewd:n.tt,symbol:h,commit:r.D,construct:r.N,terminate:r.H,hook:{default:s,vue:i},option:r.S};"undefined"!=typeof window&&window.Vue&&(r.S.hook=new i);class O extends t{get it(){return{ct:this.o,yt:this.o,ut:w,$t:this.i.get}}rt(){var t=this.i,e=this.o;return t.get=function(){return o.get(this).at(e).Lt()},t}}class _ extends t{get it(){return{ct:this.o,yt:this.o,ut:v,$t:this.i.value,S:this.h}}rt(){let t=this.i,e=this.o;return delete t.value,delete t.writable,t.get=function(){return o.get(this).at(e).Lt()},t}}class k{static M(t){k.ue.push(k.Ot),k.Ot=Object.assign({},k.Ot,t)}static W(){k.Ot=k.ue.pop()}static get O(){return k.Ot.O}static get m(){return k.Ot.m}static get j(){return k.Ot.j}static get U(){return k.Ot.U}static v(t){return k.Ot.oe.has(t)}static re(t){k.Ot.oe.add(t)}}k.Ot={O:!1,m:!1,j:!1,U:null,oe:new Set},k.ue=[];const R=Symbol("Shrewd Decorators");return x});
//# sourceMappingURL=shrewd.min.js.map
