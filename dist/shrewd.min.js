/**
 * shrewd v0.0.0-beta.11
 * (c) 2019 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t{static t(){for(S.s({i:!0});t.o.size>0;)for(let e of t.o)a.h(e);a.l(),t.o.clear(),S.u()}static $(){t.t(),t.p=!1}static g(e){t.o.delete(e)}static m(e){if(e.j||t.o.add(e),!t.p){Promise.resolve().then(t.$),t.p=!0}}static v(t,...e){S.s({S:!0,i:!1,O:!1,C:null});let s=new t(...e);return S.u(),s}static R(t){o.A(t,i)&&t[i].R()}}t.o=new Set,t.p=!1;const e=Symbol("Shrewd Decorators");class s{static get(t){if(o.A(t,e))return t[e];{let s=[];return o._(t,e,s),s}}static k(t,e,i){if(void 0===e)return(e,i)=>s.P(e,i,t);if("string"==typeof e){let r=i||Object.getOwnPropertyDescriptor(t,e);if(!r)return s.P(t,e);if(r.get&&!r.set)return s.M(t,e,r);if("function"==typeof r.value)return s.D(t,e,r)}console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. `+"Decorated member must be one of the following: a field, a readonly get accessor, or a method.")}static P(t,e,i){Object.getOwnPropertyDescriptor(t,e)?console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. `+"Decorated property is not a field."):(s.get(t).push({W:e,q:t.constructor.name+"."+e.toString(),F:w,H:i}),Object.defineProperty(t,e,{get(){return r.get(this),this[e]},set(t){r.get(this),this[e]=t}}))}static M(t,e,i){let n=t.constructor.name+"."+e.toString();return s.get(t).push({W:n,q:n,F:m,I:i.get}),i.get=function(){return r.get(this).B(n).T()},i}static D(t,e,i){let n=t.constructor.name+"."+e.toString();return s.get(t).push({W:n,q:n,F:y,I:i.value}),delete i.value,delete i.writable,i.get=function(){return r.get(this).B(n).T()},i}}const i=Symbol("ShrewdObject");class r{constructor(t){this.G=!1,this.J=new Map,this.K=o._(t,i,this);let s=Object.getPrototypeOf(this.K);for(;s;){if(o.A(s,e)){let t=s[e];for(let e of t)this.J.set(e.W,new e.F(this.K,e))}s=Object.getPrototypeOf(s)}}static get(t){return o.A(t,i)?t[i]:new r(t)}R(){if(!this.G){for(let t of this.J.values())t.R();this.G=!0}}B(t){return this.J.get(t)}get L(){let t=[];for(let e of this.J.values())e instanceof w&&t.push(e);return t}}class n{constructor(){this.N=new Set}static U(t){return!(!S.S&&t.V)||(w.j&&!w.X(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),!1):!(!w.j&&S.i)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty. For constructing new Shrewd objects, use Shrewd.construct() method."),!1))}static Y(t){for(let e of t.N)e.Z()}tt(t){this.N.add(t)}et(t){this.N.delete(t)}get V(){return this.N.size>0}get st(){return this.N.values()}}class o{static A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static _(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class c{isExtensible(t){return!1}}var h;!function(t){t[t.it=0]="$outdated",t[t.rt=1]="$updated",t[t.nt=2]="$pending"}(h||(h={}));class a extends n{constructor(t){super(),this.ot=new Set,this.ct=!1,this.ht=h.it,this.G=!1,this.at=t}static l(){for(let t of a.lt)t.ht==h.nt&&t.ut();a.lt.clear()}static ft(t){let e=S.C;e&&e!=t&&!e.G&&e.ot.add(t)}static dt(e){if(e instanceof a&&!e.$t){let s=new Set(e.ot);e.bt(),t.g(e),e.ht=h.it;for(let t of s)a.dt(t)}}static h(e){S.s({S:!1,C:e,O:S.O||e.$t}),e.ct=!0,t.g(e);let s=new Set(e.ot);e.bt();let i=e.h();if(S.O&&e.ut(),!e.G)for(let t of e.ot)s.delete(t),S.O&&t.tt(e);for(let t of s)a.dt(t);return e.ct=!1,S.u(),i}get j(){return this.ct}Z(){this.pt(),this.ht=h.it,t.m(this)}R(){this.G||(this.bt(),this.ut(),this.G=!0)}pt(){if(this.ht==h.rt){this.ht=h.nt,a.lt.add(this);for(let t of this.st)t.pt()}}gt(){if(this.j){let t=a.wt.indexOf(this),e=[this,...a.wt.slice(t+1),this];e.forEach(t=>t.R());let s=e.map(t=>t.at).join(" => ");console.warn("Circular dependency detected: "+s+"\nAll these observers will be terminated.")}if(this.ht!=h.rt){a.wt.push(this);for(let t of this.ot)t instanceof a&&(t.ct?a.h(this):t.ht!=h.rt&&t.gt());this.ht==h.it?a.h(this):(a.lt.delete(this),this.ut()),a.wt.pop()}}ut(){this.ht=h.rt}get yt(){return this.ht==h.nt}get $t(){return this.V}bt(){for(let t of this.ot)t.et(this);this.ot.clear()}get jt(){return this.G}}a.lt=new Set,a.wt=[];const l=Symbol("Observable Helper");class u extends n{constructor(t,e){super(),this.vt=o._(t,l,this),this.St=new Proxy(t,e),u.xt.set(t,this.St)}static Ot(t){if("object"!=typeof t)return t;if(u.xt.has(t))return u.xt.get(t);if(!u.Ct(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new j(t).Rt;break;case Set.prototype:t=new p(t).Rt;break;case Map.prototype:t=new g(t).Rt;break;case Object.prototype:t=new b(t).Rt}return t}static Ct(t){return"object"==typeof t&&o.A(t,l)}get Rt(){return this.St}}u.xt=new WeakMap;class f extends c{get(t,e,s){let i=t[l],r=Reflect.get(t,e);return"function"==typeof r&&(r=this.At.bind({_t:e,C:t,I:r.bind(t),kt:i,Pt:s})),"size"==e&&a.ft(t[l]),r}At(...t){switch(this._t){case"clear":return void(a.U(this.kt)&&this.C.size>0&&(this.C.clear(),n.Y(this.kt)));case"delete":return void(a.U(this.kt)&&this.C.has(t[0])&&(this.C.delete(t[0]),n.Y(this.kt)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":a.ft(this.kt);default:return this.I(...t)}}}class d extends a{constructor(t,e){super(e.q),this.K=t}}class $ extends c{has(t,e){return a.ft(t[l]),Reflect.has(t,e)}get(t,e,s){return a.ft(t[l]),Reflect.get(t,e,s)}set(t,e,s,i){let r=t[l];if(n.U(r)){return s!==Reflect.get(t,e,i)&&(Reflect.set(t,e,u.Ot(s),i),n.Y(r)),!0}return!0}deleteProperty(t,e){let s=t[l];if(n.U(s)){let i=Reflect.deleteProperty(t,e);return i&&n.Y(s),i}return!0}}class b extends u{constructor(t){for(let e in t)t[e]=u.Ot(t[e]);super(t,b.Mt)}get Dt(){let t=[];for(let e in this.vt){let s=this.vt[e];"object"==typeof s&&t.push(s)}return t}}b.Mt=new $;class p extends u{constructor(t){for(let e of t)t.delete(e),t.add(u.Ot(e));super(t,p.Mt)}get Dt(){let t=[];for(let e of this.vt)"object"==typeof e&&t.push(e);return t}}p.Mt=new class extends f{At(...t){return"add"==this._t?(a.U(this.kt)&&!this.C.has(t[0])&&(this.C.add(u.Ot(t[0])),n.Y(this.kt)),this.Pt):super.At.apply(this,t)}};class g extends u{constructor(t){for(let[e,s]of t)t.set(e,u.Ot(s));super(t,g.Mt)}get Dt(){let t=[];for(let[e,s]of this.vt)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}g.Mt=new class extends f{At(...t){return"set"==this._t?(a.U(this.kt)&&!this.C.has(t[0])&&(this.C.set(t[0],u.Ot(t[1])),n.Y(this.kt)),this.Pt):super.At.apply(this,t)}};class m extends d{constructor(t,e){super(t,e),this.Et=e.I}h(){let t=this.Et.apply(this.K);t!=this.Wt&&(this.Wt=t,n.Y(this))}T(){return this.jt?this.Wt=this.Et.apply(this.K):(a.ft(this),this.gt()),this.Wt}}class w extends d{constructor(t,e){super(t,e),this.qt=e.H||{},Object.defineProperty(t,e.W,w.Ft(e.W)),this.qt.renderer||this.ut()}static Ft(t){return w.Ht[t]=w.Ht[t]||{get(){return r.get(this).B(t).T()},set(e){r.get(this).B(t).zt(e)}}}static get j(){return w.ct}static It(t){if("object"==typeof t)if(u.Ct(t)){if(!w.Tt.has(t[l])){w.Tt.add(t[l]);for(let e of t[l].Dt)w.It(e)}}else if(o.A(t,i))for(let e of r.get(t).L)w.Tt.has(e)||(w.Tt.add(e),w.It(e.Bt))}static X(t){return w.Tt.has(t)}T(){return this.jt||(a.ft(this),this.qt.renderer&&this.gt()),this.Bt}zt(t){if(this.jt)this.Bt=t;else if(n.U(this)&&t!=this.Gt){if(this.qt.validator&&!this.qt.validator.apply(this.K,[t]))return;this.Gt=u.Ot(t),this.qt.renderer?a.h(this):this.Y(this.Gt)}}h(){w.ct=!0,w.It(this.Gt);let t=this.qt.renderer.apply(this.K,[this.Gt]);w.Tt.clear(),w.ct=!1,t!==this.Bt&&this.Y(u.Ot(t))}Y(t){this.Bt=t,n.Y(this)}R(){this.jt||(delete this.Gt,delete this.qt,super.R())}}w.Ht={},w.ct=!1,w.Tt=new Set;class y extends d{constructor(t,e){super(t,e),this.At=e.I}get $t(){return!0}T(){return this.jt?()=>this.At.apply(this.K):(a.ft(this),S.i||this.yt?()=>(this.gt(),this.Jt):()=>a.h(this))}h(){return this.Jt=this.At.apply(this.K),n.Y(this),this.Jt}}class j extends u{constructor(t){for(let e in t)t[e]=u.Ot(t[e]);super(t,j.Mt)}get Dt(){let t=[];for(let e of this.vt)"object"==typeof e&&t.push(e);return this.vt}}j.Mt=new class extends ${get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&a.ft(t[l]),Reflect.get(t,e,s)}};const v={shrewd:s.k,decorate:null,commit:t.t,construct:t.v,terminate:t.R};class S{static s(t){S.Kt.push(S.ht),S.ht=Object.assign({},S.ht,t)}static u(){S.ht=S.Kt.pop()}static get i(){return S.ht.i}static get S(){return S.ht.S}static get O(){return S.ht.O}static get C(){return S.ht.C}}return S.ht={i:!1,S:!1,O:!1,C:null},S.Kt=[],v});