/**
 * shrewd v0.0.0-beta.13
 * (c) 2019-2020 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Shrewd=t()}(this,function(){"use strict";class Observable{constructor(){this.t=new Set,this.s=Observable.i++}static o(e){return!(!Global.l&&e.h)||(Global.u&&!Global.p(e)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),Core.$.debug,!1):!(!Global.u&&Global.O)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty. For constructing new Shrewd objects, use Shrewd.construct() method."),Core.$.debug,!1))}static v(e){Core.$.hook.write(e.s);for(let t of e.t)t.H()}g(e){this.t.add(e)}m(e){this.t.delete(e)}get h(){return this.t.size>0}get C(){return this.t.values()}}Observable.i=0;class DefaultHook{read(e){}write(e){}gc(){}sub(e){return!1}}class VueHook{constructor(){this.P=new Vue({data:{shrewd:{}}})}read(e){this.P.shrewd[e]}write(e){Vue.set(this.P.shrewd,e,{})}gc(){for(let e in this.P.shrewd)0==this.P.shrewd[e].S.dep.subs.length&&Vue.delete(this.P.shrewd,e)}sub(e){return e in this.P.shrewd&&this.P.shrewd[e].S.dep.subs.length>0}}class Core{static j(){Global.G({O:!0});try{for(let e of Core.D)Observer.A(e)}finally{Observer._(),Core.D.clear(),Global.M();for(let e of Core.k)e.R();Core.k.clear(),Core.$.hook.gc()}}static V(e){Core.q.add(e)}static F(){if(!Core.T){Core.T=!0;for(let e of Core.q)Core.q.delete(e),e.F();Core.T=!1}}static W(){Core.j(),Core.I=!1}static K(e){Core.D.delete(e)}static B(e){if(e.J||Core.D.add(e),Core.$.autoCommit&&!Core.I){Promise.resolve().then(Core.W),Core.I=!0}}static R(e,t=!1){if(HiddenProperty.L(e,$shrewdObject)){let r=e[$shrewdObject];t?Core.k.add(r):r.R()}}}Core.$={hook:new DefaultHook,autoCommit:!0,debug:!0},Core.D=new Set,Core.k=new Set,Core.q=new Set,Core.I=!1,Core.T=!1;class Decorators{static get(e){if(HiddenProperty.L(e,$shrewdDecorators))return e[$shrewdDecorators];{let t=[];return HiddenProperty.N(e,$shrewdDecorators,t),t}}static U(e,t,r,s){if(void 0===t)return"function"==typeof e?Decorators.X(e):(t,r,s)=>Decorators.U(t,r,s,e);if("string"==typeof t){let i=r||Object.getOwnPropertyDescriptor(e,t);if(!i)return Decorators.Y(ObservablePropertyAdapter,e,t,void 0,s);if(i.get&&!i.set)return Decorators.Y(ComputedPropertyAdapter,e,t,i,s);if("function"==typeof i.value)return Decorators.Y(ReactiveMethodAdapter,e,t,i,s)}console.warn(`Setup error at ${e.constructor.name}[${t.toString()}]. `+"Decorated member must be one of the following: a field, a readonly get accessor, or a method."),Core.$.debug}static X(constructor){let result,name=constructor.name;return eval(`result = class ${name} extends constructor {\n\t\t\tconstructor(...args) {\n\t\t\t\tGlobal.$pushState({\n\t\t\t\t\t$isConstructing: true,\n\t\t\t\t\t$isCommitting: false,\n\t\t\t\t\t$target: null\n\t\t\t\t});\n\t\t\t\tObserver.$trace.push("construct ${name}");\n\t\t\t\ttry {\n\t\t\t\t\tsuper(...args);\n\t\t\t\t\tif(this.constructor == result) {\n\t\t\t\t\t\tnew ShrewdObject(this);\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tObserver.$trace.pop();\n\t\t\t\t\tGlobal.$restore();\n\t\t\t\t}\n\t\t\t}\n\t\t}`),result}static Y(e,t,r,s,i){var o=new e(t,r,s,i);return Decorators.get(t).push(o.Z),o.ee()}}const $shrewdObject=Symbol("ShrewdObject");class ShrewdObject{constructor(e){this.te=!1,this.re=new Map,this.se=HiddenProperty.N(e,$shrewdObject,this);let t=Object.getPrototypeOf(this.se);for(;t;){if(HiddenProperty.L(t,$shrewdDecorators)){let e=t[$shrewdDecorators];for(let t of e){let e=new t.ie(this.se,t);this.re.set(e.oe,e)}}t=Object.getPrototypeOf(t)}for(let e of this.re.values())Core.V(e)}static get(e){return HiddenProperty.L(e,$shrewdObject)?e[$shrewdObject]:new ShrewdObject(e)}R(){if(!this.te){for(let e of this.re.values())e.R();this.te=!0}}le(e){return this.re.get(e)}get ne(){let e=[];for(let t of this.re.values())t instanceof ObservableProperty&&e.push(t);return e}}class HiddenProperty{static L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}static N(e,t,r){return Object.defineProperty(e,t,{enumerable:!1,writable:!1,configurable:!1,value:r}),e}}class CollectionProxyHandler{get(e,t,r){let s=e[$observableHelper],i=Reflect.get(e,t);return"function"==typeof i&&(i=this.ae.bind({he:t,ce:e,be:i.bind(e),ue:s,de:r})),"size"==t&&Observer.pe(e[$observableHelper]),i}ae(...e){switch(this.he){case"clear":return void(Observer.o(this.ue)&&this.ce.size>0&&(this.ce.clear(),Observable.v(this.ue)));case"delete":return void(Observer.o(this.ue)&&this.ce.has(e[0])&&(this.ce.delete(e[0]),Observable.v(this.ue)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":Observer.pe(this.ue);default:return this.be(...e)}}}var ObserverState;!function(e){e[e.fe=0]="$outdated",e[e.$e=1]="$updated",e[e.Oe=2]="$pending"}(ObserverState||(ObserverState={}));class Observer extends Observable{constructor(e){super(),this.ve=new Set,this.ye=!1,this.He=ObserverState.fe,this.te=!1,this.we=e}static _(){for(let e of Observer.ge)e.He==ObserverState.Oe&&e.me&&(e.Ce(),Observer.ge.delete(e))}static pe(e){if(e instanceof Observer&&e.te)return;Core.$.hook.read(e.s);let t=Global.ce;t&&t!=e&&!t.te&&t.ve.add(e)}static Pe(e){if(e instanceof Observer&&!e.te&&(e.Se=e.checkActive(),!e.me)){let t=new Set(e.ve);Core.K(e);for(let e of t)Observer.Pe(e)}}static A(e){Global.G({l:!1,ce:e}),e.ye=!0,Core.K(e);try{let t=new Set(e.ve);e.je();let r=e.A();if(e.Ce(),!e.te)for(let r of e.ve)t.delete(r),r.g(e),e.me&&r instanceof Observer&&r.activate();for(let e of t)Observer.Pe(e);return r}finally{e.ye=!1,Global.M()}}get J(){return this.ye}H(){this.Ge(),this.xe(),this.me&&Core.B(this)}R(){this.te||(Core.K(this),Observer.ge.delete(this),this.te=!0,this.De())}De(){this.je();for(let e of this.C)e.ve.delete(this),this.m(e);this.Ce(),this.ye=!1}Ge(){if(this.He==ObserverState.$e){this.He=ObserverState.Oe,Observer.ge.add(this);for(let e of this.C)e.Ge()}}Ae(e=!1){if(this.ye&&this._e(),this.He!=ObserverState.$e){Observer.Me.push(this);try{for(let e of this.ve)if(e instanceof Observer){if(e.ye){Observer.A(this);break}e.He!=ObserverState.$e&&e.Ae()}this.He==ObserverState.fe||e?Observer.A(this):(Observer.ge.delete(this),this.Ce())}finally{Observer.Me.pop()}}}_e(){Core.$.debug;let e=Observer.Me.indexOf(this),t=[this,...Observer.Me.slice(e+1)];t.forEach(e=>e instanceof Observer&&e.R()),t.push(this);let r=t.map(e=>"string"==typeof e?e:e.we).join(" => ");console.warn("Cyclic dependency detected: "+r+"\nAll these reactions will be terminated.")}Ce(){this.He=ObserverState.$e}xe(){this.He=ObserverState.fe}get ke(){return this.He}get me(){return this.Se=null!=this.Se?this.Se:this.checkActive()}checkActive(){if(Core.$.hook.sub(this.s))return!0;for(let e of this.C)if(e.me)return!0;return!1}activate(){if(!this.me){this.Se=!0;for(let e of this.ve)e instanceof Observer&&e.activate()}}je(){for(let e of this.ve)e.m(this);this.ve.clear()}get Re(){return this.te}}Observer.ge=new Set,Observer.Me=[];const $observableHelper=Symbol("Observable Helper");class Helper extends Observable{constructor(e,t){super(),this.Ve=HiddenProperty.N(e,$observableHelper,this),this.ze=new Proxy(e,t),Helper.qe.set(e,this.ze)}static Fe(e){if(null==e||"object"!=typeof e)return e;if(Helper.qe.has(e))return Helper.qe.get(e);if(!Helper.Te(e))switch(Object.getPrototypeOf(e)){case Array.prototype:e=new ArrayHelper(e).We;break;case Set.prototype:e=new SetHelper(e).We;break;case Map.prototype:e=new MapHelper(e).We;break;case Object.prototype:e=new ObjectHelper(e).We}return e}static Te(e){return null!=e&&"object"==typeof e&&HiddenProperty.L(e,$observableHelper)}get We(){return this.ze}}Helper.qe=new WeakMap;class DecoratedMemeber extends Observer{constructor(e,t){super(t.Ee+"."+t.Ie.toString()),this.Ke=t,this.Be=Object.assign(this.Je,t.$),this.se=e}get oe(){return this.Ke.Ee+"."+this.Ke.Ie.toString()}F(){this.Ae()}get Je(){return{}}checkActive(){return!!this.Be.active||super.checkActive()}Le(){return this.Re?this.Ne():(Observer.pe(this),this.Qe())}}class ObjectProxyHandler{has(e,t){return Observer.pe(e[$observableHelper]),Reflect.has(e,t)}get(e,t,r){return Observer.pe(e[$observableHelper]),Reflect.get(e,t,r)}set(e,t,r,s){let i=e[$observableHelper];if(Observable.o(i)){return r!==Reflect.get(e,t,s)&&(Reflect.set(e,t,Helper.Fe(r),s),Observable.v(i)),!0}return!0}deleteProperty(e,t){let r=e[$observableHelper];if(Observable.o(r)){let s=Reflect.deleteProperty(e,t);return s&&Observable.v(r),s}return!0}}class ObjectHelper extends Helper{constructor(e){for(let t in e)e[t]=Helper.Fe(e[t]);super(e,ObjectHelper.Ue)}get Xe(){let e=[];for(let t in this.Ve){let r=this.Ve[t];"object"==typeof r&&e.push(r)}return e}}ObjectHelper.Ue=new ObjectProxyHandler;class SetProxyHandler extends CollectionProxyHandler{ae(...e){return"add"==this.he?(Observer.o(this.ue)&&!this.ce.has(e[0])&&(this.ce.add(Helper.Fe(e[0])),Observable.v(this.ue)),this.de):super.ae.apply(this,e)}}class SetHelper extends Helper{constructor(e){for(let t of e)e.delete(t),e.add(Helper.Fe(t));super(e,SetHelper.Ue)}get Xe(){let e=[];for(let t of this.Ve)"object"==typeof t&&e.push(t);return e}}SetHelper.Ue=new SetProxyHandler;class MapProxyHandler extends CollectionProxyHandler{ae(...e){return"set"==this.he?(Observer.o(this.ue)&&!this.ce.has(e[0])&&(this.ce.set(e[0],Helper.Fe(e[1])),Observable.v(this.ue)),this.de):super.ae.apply(this,e)}}class MapHelper extends Helper{constructor(e){for(let[t,r]of e)e.set(t,Helper.Fe(r));super(e,MapHelper.Ue)}get Xe(){let e=[];for(let[t,r]of this.Ve)"object"==typeof t&&e.push(t),"object"==typeof r&&e.push(r);return e}}MapHelper.Ue=new MapProxyHandler;class ComputedProperty extends DecoratedMemeber{constructor(e,t){super(e,t),this.Ye=t.be,this.Be.active&&this.H()}A(){let e=this.Ye.apply(this.se);e!==this.Ze&&(this.Ze=e,Observable.v(this))}Qe(){return this.Ae(),this.Ze}Ne(){return this.Ze}}class ObservableProperty extends DecoratedMemeber{constructor(e,t){super(e,t),this.et=!1,this.tt=e[t.Ie],Object.defineProperty(e,t.Ie,ObservableProperty.rt(t.Ie)),this.Be.renderer||this.Ce()}static rt(e){return ObservableProperty.st[e]=ObservableProperty.st[e]||{get(){return ShrewdObject.get(this).le(e).Le()},set(t){ShrewdObject.get(this).le(e).it(t)}}}static ot(e){if(null!=e&&"object"==typeof e)if(Helper.Te(e)){if(!Global.p(e[$observableHelper])){Global.ot(e[$observableHelper]);for(let t of e[$observableHelper].Xe)ObservableProperty.ot(t)}}else if(HiddenProperty.L(e,$shrewdObject))for(let t of ShrewdObject.get(e).ne)Global.p(t)||(Global.ot(t),ObservableProperty.ot(t.lt))}get oe(){return this.Ke.Ie.toString()}F(){this.et||(this.Be.validator&&!this.Be.validator.apply(this.se,[this.tt])&&(this.tt=void 0),this.nt(this.tt),this.et=!0)}xe(){this.Be.renderer&&super.xe()}Qe(){return this.et?this.Be.renderer&&this.Ae():this.F(),this.lt}Ne(){return this.lt}it(e){if(this.Re)this.lt=e;else if(Observable.o(this)&&e!==this.tt){if(this.Be.validator&&!this.Be.validator.apply(this.se,[e]))return Core.$.hook.write(this.s);this.nt(e)}}nt(e){this.tt=Helper.Fe(e),this.Be.renderer?this.A():this.v(this.tt)}A(){Global.G({u:!0,at:new Set});try{ObservableProperty.ot(this.tt);let e=this.Be.renderer.apply(this.se,[this.tt]);e!==this.lt&&this.v(Helper.Fe(e))}finally{Global.M()}}v(e){this.lt=e,Observable.v(this)}De(){delete this.tt,delete this.Be,super.De()}}ObservableProperty.st={};class ReactiveMethod extends DecoratedMemeber{constructor(e,t){super(e,t),this.ae=t.be}get Je(){return{active:!0}}Qe(){return()=>(this.Ae(),this.ht)}Ne(){return()=>this.ht}A(){return this.ht=this.ae.apply(this.se),Observable.v(this),this.ht}}class ArrayProxyHandler extends ObjectProxyHandler{get(e,t,r){return("length"==t||"symbol"==typeof t||"number"==typeof t||"string"==typeof t&&t.match(/^\d+$/))&&Observer.pe(e[$observableHelper]),Reflect.get(e,t,r)}}class ArrayHelper extends Helper{constructor(e){for(let t in e)e[t]=Helper.Fe(e[t]);super(e,ArrayHelper.Ue)}get Xe(){let e=[];for(let t of this.Ve)"object"==typeof t&&e.push(t);return this.Ve}}ArrayHelper.Ue=new ArrayProxyHandler;const Shrewd={shrewd:Decorators.U,symbol:$shrewdObject,commit:Core.j,terminate:Core.R,hook:{default:DefaultHook,vue:VueHook},option:Core.$};"undefined"!=typeof window&&window.Vue&&(Core.$.hook=new VueHook);class Adapter{constructor(e,t,r,s){this.ct=e,this.bt=t,this.Ke=r,this.ut=s}get we(){return this.ct.constructor.name+"."+this.bt.toString()}get Z(){return{Ie:this.bt.toString(),Ee:this.ct.constructor.name,ie:this.dt,be:this.ae,$:this.ut}}get ae(){}ee(){}}class ComputedPropertyAdapter extends Adapter{get dt(){return ComputedProperty}get ae(){return this.Ke.get}ee(){let e=this.we,t=this.ae;return this.Ke.get=function(){if(HiddenProperty.L(this,$shrewdObject)){return this[$shrewdObject].le(e).Le()}return t.apply(this)},this.Ke}}class ObservablePropertyAdapter extends Adapter{get dt(){return ObservableProperty}}class ReactiveMethodAdapter extends Adapter{get dt(){return ReactiveMethod}get ae(){return this.Ke.value}ee(){let e=this.we,t=this.ae;return delete this.Ke.value,delete this.Ke.writable,this.Ke.get=function(){if(HiddenProperty.L(this,$shrewdObject)){return this[$shrewdObject].le(e).Le()}return t.bind(this)},this.Ke}}class Global{static G(e){Global.pt.push(Global.He),Global.He=Object.assign({},Global.He,e)}static M(){Global.He=Global.pt.pop(),0==Global.pt.length&&Core.F()}static get O(){return Global.He.O}static get l(){return Global.He.l}static get u(){return Global.He.u}static get ce(){return Global.He.ce}static p(e){return Global.He.at.has(e)}static ot(e){Global.He.at.add(e)}}Global.He={O:!1,l:!1,u:!1,ce:null,at:new Set},Global.pt=[];const $shrewdDecorators=Symbol("Shrewd Decorators");return Shrewd});
//# sourceMappingURL=shrewd.min.js.map
