/**
 * shrewd v0.0.0-beta.12
 * (c) 2019 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t{constructor(){this.t=new Set,this.s=t.i++}static o(t){return!(!x.h&&t.l)||(x.u&&!x.$(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),!1):!(!x.u&&x.p)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty. For constructing new Shrewd objects, use Shrewd.construct() method."),!1))}static g(t){i.m.hook.write(t.s);for(let e of t.t)e.j()}S(t){this.t.add(t)}v(t){this.t.delete(t)}get l(){return this.t.size>0}get O(){return this.t.values()}}t.i=0;class e{read(t){}write(t){}gc(){}sub(t){return!1}}class s{constructor(){this.k=new Vue({data:{shrewd:{}}})}read(t){this.k.shrewd[t]}write(t){Vue.set(this.k.shrewd,t,{})}gc(){for(let t in this.k.shrewd)0==this.k.shrewd[t].R.dep.subs.length&&Vue.delete(this.k.shrewd,t)}sub(t){return t in this.k.shrewd&&this.k.shrewd[t].R.dep.subs.length>0}}class i{static C(){x._({p:!0});try{for(let t of i.P)u.A(t)}finally{u.D(),i.P.clear(),x.M();for(let t of i.T)t.V();i.T.clear(),i.m.hook.gc()}}static W(){i.C(),i.q=!1}static F(t){i.P.delete(t)}static H(t){if(t.I||i.P.add(t),i.m.autoCommit&&!i.q){Promise.resolve().then(i.W),i.q=!0}}static B(t,...e){x._({h:!0,p:!1,G:null}),u.J.push("construct "+t.name);try{return new t(...e)}finally{u.J.pop(),x.M()}}static V(t,e=!1){if(c.K(t,o)){let s=t[o];e?i.T.add(s):s.V()}}}i.m={hook:new e,autoCommit:!0},i.P=new Set,i.T=new Set,i.q=!1;const r=Symbol("Shrewd Decorators");class n{static get(t){if(c.K(t,r))return t[r];{let e=[];return c.L(t,r,e),e}}static N(t,e,s,i){if(void 0===e)return(e,s,i)=>n.N(e,s,i,t);if("string"==typeof e){let r=s||Object.getOwnPropertyDescriptor(t,e);if(!r)return n.U(t,e,i);if(r.get&&!r.set)return n.X(t,e,r);if("function"==typeof r.value)return n.Y(t,e,r,i)}console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. `+"Decorated member must be one of the following: a field, a readonly get accessor, or a method.")}static U(t,e,s){Object.getOwnPropertyDescriptor(t,e)?console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. `+"Decorated property is not a field."):(n.get(t).push({Z:e,tt:t.constructor.name+"."+e.toString(),et:w,m:s}),Object.defineProperty(t,e,{get(){return h.get(this),this[e]},set(t){h.get(this),this[e]=t}}))}static X(t,e,s){let i=t.constructor.name+"."+e.toString();return n.get(t).push({Z:i,tt:i,et:m,st:s.get}),s.get=function(){return h.get(this).rt(i).it()},s}static Y(t,e,s,i){let r=t.constructor.name+"."+e.toString();return n.get(t).push({Z:r,tt:r,et:j,st:s.value,m:i}),delete s.value,delete s.writable,s.get=function(){return h.get(this).rt(r).it()},s}}const o=Symbol("ShrewdObject");class h{constructor(t){this.nt=!1,this.ot=new Map,this.ht=c.L(t,o,this);let e=Object.getPrototypeOf(this.ht);for(;e;){if(c.K(e,r)){let t=e[r];for(let e of t)this.setup(e)}e=Object.getPrototypeOf(e)}}static get(t){return c.K(t,o)?t[o]:new h(t)}setup(t){this.ot.set(t.Z,new t.et(this.ht,t))}V(){if(!this.nt){for(let t of this.ot.values())t.V();this.nt=!0}}rt(t){return this.ot.get(t)}get ct(){let t=[];for(let e of this.ot.values())e instanceof w&&t.push(e);return t}}class c{static K(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static L(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class a{get(t,e,s){let i=t[f],r=Reflect.get(t,e);return"function"==typeof r&&(r=this.at.bind({lt:e,G:t,st:r.bind(t),ut:i,ft:s})),"size"==e&&u.dt(t[f]),r}at(...e){switch(this.lt){case"clear":return void(u.o(this.ut)&&this.G.size>0&&(this.G.clear(),t.g(this.ut)));case"delete":return void(u.o(this.ut)&&this.G.has(e[0])&&(this.G.delete(e[0]),t.g(this.ut)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":u.dt(this.ut);default:return this.st(...e)}}}var l;!function(t){t[t.$t=0]="$outdated",t[t.bt=1]="$updated",t[t.pt=2]="$pending"}(l||(l={}));class u extends t{constructor(t){super(),this.gt=new Set,this.yt=!1,this.wt=l.$t,this.nt=!1,this.jt=this.checkActive(),this.St=t}static D(){for(let t of u.vt)t.wt==l.pt&&t.jt&&(t.xt(),u.vt.delete(t))}static dt(t){if(t instanceof u&&t.nt)return;i.m.hook.read(t.s);let e=x.G;e&&e!=t&&!e.nt&&e.gt.add(t)}static Ot(t){if(t instanceof u&&!t.nt&&(t.jt=t.checkActive(),!t.jt)){let e=new Set(t.gt);i.F(t);for(let t of e)u.Ot(t)}}static A(t){x._({h:!1,G:t}),t.yt=!0,i.F(t);try{let e=new Set(t.gt);t.kt();let s=t.A();if(t.xt(),!t.nt)for(let s of t.gt)e.delete(s),s.S(t),t.jt&&s instanceof u&&s.passDownActive();for(let t of e)u.Ot(t);return s}finally{t.yt=!1,x.M()}}get I(){return this.yt}j(){this.Rt(),this.Ct(),this.jt&&i.H(this)}V(){this.nt||(i.F(this),u.vt.delete(this),this.nt=!0,this._t())}_t(){this.kt();for(let t of this.O)t.gt.delete(this),this.v(t);this.xt(),this.yt=!1}Rt(){if(this.wt==l.bt){this.wt=l.pt,u.vt.add(this);for(let t of this.O)t.Rt()}}Pt(t=!1){if(this.yt){let t=u.J.indexOf(this),e=[this,...u.J.slice(t+1)];e.forEach(t=>t instanceof u&&t.V()),e.push(this);let s=e.map(t=>"string"==typeof t?t:t.St).join(" => ");console.warn("Circular dependency detected: "+s+"\nAll these reactions will be terminated.")}if(this.wt!=l.bt){u.J.push(this);try{for(let t of this.gt)if(t instanceof u){if(t.yt){u.A(this);break}t.wt!=l.bt&&t.Pt()}this.wt==l.$t||t?u.A(this):(u.vt.delete(this),this.xt())}finally{u.J.pop()}}}xt(){this.wt=l.bt}Ct(){this.wt=l.$t}get At(){return this.wt}checkActive(){if(i.m.hook.sub(this.s))return!0;for(let t of this.O)if(t.jt)return!0;return!1}passDownActive(){if(!this.jt){this.jt=!0;for(let t of this.gt)t instanceof u&&t.passDownActive()}}kt(){for(let t of this.gt)t.v(this);this.gt.clear()}get Dt(){return this.nt}}u.vt=new Set,u.J=[];const f=Symbol("Observable Helper");class d extends t{constructor(t,e){super(),this.Mt=c.L(t,f,this),this.Tt=new Proxy(t,e),d.Vt.set(t,this.Tt)}static Wt(t){if(null==t||"object"!=typeof t)return t;if(d.Vt.has(t))return d.Vt.get(t);if(!d.qt(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new S(t).Et;break;case Set.prototype:t=new g(t).Et;break;case Map.prototype:t=new y(t).Et;break;case Object.prototype:t=new p(t).Et}return t}static qt(t){return null!=t&&"object"==typeof t&&c.K(t,f)}get Et(){return this.Tt}}d.Vt=new WeakMap;class $ extends u{constructor(t,e){super(e.tt),this.ht=t}}class b{has(t,e){return u.dt(t[f]),Reflect.has(t,e)}get(t,e,s){return u.dt(t[f]),Reflect.get(t,e,s)}set(e,s,i,r){let n=e[f];if(t.o(n)){return i!==Reflect.get(e,s,r)&&(Reflect.set(e,s,d.Wt(i),r),t.g(n)),!0}return!0}deleteProperty(e,s){let i=e[f];if(t.o(i)){let r=Reflect.deleteProperty(e,s);return r&&t.g(i),r}return!0}}class p extends d{constructor(t){for(let e in t)t[e]=d.Wt(t[e]);super(t,p.Ft)}get Ht(){let t=[];for(let e in this.Mt){let s=this.Mt[e];"object"==typeof s&&t.push(s)}return t}}p.Ft=new b;class g extends d{constructor(t){for(let e of t)t.delete(e),t.add(d.Wt(e));super(t,g.Ft)}get Ht(){let t=[];for(let e of this.Mt)"object"==typeof e&&t.push(e);return t}}g.Ft=new class extends a{at(...e){return"add"==this.lt?(u.o(this.ut)&&!this.G.has(e[0])&&(this.G.add(d.Wt(e[0])),t.g(this.ut)),this.ft):super.at.apply(this,e)}};class y extends d{constructor(t){for(let[e,s]of t)t.set(e,d.Wt(s));super(t,y.Ft)}get Ht(){let t=[];for(let[e,s]of this.Mt)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}y.Ft=new class extends a{at(...e){return"set"==this.lt?(u.o(this.ut)&&!this.G.has(e[0])&&(this.G.set(e[0],d.Wt(e[1])),t.g(this.ut)),this.ft):super.at.apply(this,e)}};class m extends ${constructor(t,e){super(t,e),this.zt=e.st}A(){let e=this.zt.apply(this.ht);e!=this.It&&(this.It=e,t.g(this))}it(){return this.Dt||(u.dt(this),this.Pt()),this.It}}class w extends ${constructor(t,e){super(t,e),this.Bt=e.m||{},Object.defineProperty(t,e.Z,w.Gt(e.Z)),this.Bt.renderer||this.xt()}static Gt(t){return w.Jt[t]=w.Jt[t]||{get(){return h.get(this).rt(t).it()},set(e){h.get(this).rt(t).Kt(e)}}}static Lt(t){if(null!=t&&"object"==typeof t)if(d.qt(t)){if(!x.$(t[f])){x.Lt(t[f]);for(let e of t[f].Ht)w.Lt(e)}}else if(c.K(t,o))for(let e of h.get(t).ct)x.$(e)||(x.Lt(e),w.Lt(e.Nt))}Ct(){this.Bt.renderer&&super.Ct()}it(){return this.Dt||(u.dt(this),this.Bt.renderer&&this.Pt()),this.Nt}Kt(e){if(this.Dt)this.Nt=e;else if(t.o(this)&&e!==this.Qt){if(this.Bt.validator&&!this.Bt.validator.apply(this.ht,[e]))return i.m.hook.write(this.s);this.Qt=d.Wt(e),this.Bt.renderer?u.A(this):this.g(this.Qt)}}A(){x._({u:!0,Ut:new Set});try{w.Lt(this.Qt);let t=this.Bt.renderer.apply(this.ht,[this.Qt]);t!==this.Nt&&this.g(d.Wt(t))}finally{x.M()}}g(e){this.Nt=e,t.g(this)}_t(){delete this.Qt,delete this.Bt,super._t()}}w.Jt={};class j extends ${constructor(t,e){super(t,e),this.at=e.st,this.Bt=e.m||{}}checkActive(){return!0}it(){if(this.Dt)return()=>this.Xt;{u.dt(this);let t=!1;if(!x.p){if(this.Bt.lazy&&this.At!=l.bt)return()=>(this.j(),this.Xt);this.At!=l.pt&&(t=!0)}return()=>(this.Pt(t),this.Xt)}}A(){return this.Xt=this.at.apply(this.ht),t.g(this),this.Xt}}class S extends d{constructor(t){for(let e in t)t[e]=d.Wt(t[e]);super(t,S.Ft)}get Ht(){let t=[];for(let e of this.Mt)"object"==typeof e&&t.push(e);return this.Mt}}S.Ft=new class extends b{get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&u.dt(t[f]),Reflect.get(t,e,s)}};const v={shrewd:n.N,symbol:o,commit:i.C,construct:i.B,terminate:i.V,hook:{default:e,vue:s},option:i.m};"undefined"!=typeof window&&window.Vue&&(i.m.hook=new s);class x{static _(t){x.Yt.push(x.wt),x.wt=Object.assign({},x.wt,t)}static M(){x.wt=x.Yt.pop()}static get p(){return x.wt.p}static get h(){return x.wt.h}static get u(){return x.wt.u}static get G(){return x.wt.G}static $(t){return x.wt.Ut.has(t)}static Lt(t){x.wt.Ut.add(t)}}return x.wt={p:!1,h:!1,u:!1,G:null,Ut:new Set},x.Yt=[],v});
//# sourceMappingURL=shrewd.min.js.map
