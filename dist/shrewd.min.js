/**
 * shrewd v0.0.0-beta.12
 * (c) 2019 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t{constructor(){this.t=new Set,this.s=t.i++}static o(t){return!(!O.h&&t.u)||(j.l&&!j.$(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),!1):!(!j.l&&O.p)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty. For constructing new Shrewd objects, use Shrewd.construct() method."),!1))}static g(t){i.m.hook.write(t.s);for(let e of t.t)e.j()}S(t){this.t.add(t)}v(t){this.t.delete(t)}get u(){return this.t.size>0}get O(){return this.t.values()}}t.i=0;class e{read(t){}write(t){}gc(){}sub(t){return!1}}class s{constructor(){this.k=new Vue({data:{shrewd:{}}})}read(t){this.k.shrewd[t]}write(t){Vue.set(this.k.shrewd,t,{})}gc(){for(let t in this.k.shrewd)0==this.k.shrewd[t].C.dep.subs.length&&Vue.delete(this.k.shrewd,t)}sub(t){return t in this.k.shrewd&&this.k.shrewd[t].C.dep.subs.length>0}}class i{static _(){O.R({p:!0});for(let t of i.P)l.A(t);l.D(),i.P.clear(),O.M();for(let t of i.T)t.V();i.T.clear(),i.m.hook.gc()}static W(){i._(),i.q=!1}static F(t){i.P.delete(t)}static H(t){if(t.l||i.P.add(t),i.m.autoCommit&&!i.q){Promise.resolve().then(i.W),i.q=!0}}static I(t,...e){O.R({h:!0,p:!1,B:null}),l.G.push("construct "+t.name);let s=new t(...e);return l.G.pop(),O.M(),s}static V(t,e=!1){if(c.J(t,o)){let s=t[o];e?i.T.add(s):s.V()}}}i.m={hook:new e,autoCommit:!0},i.P=new Set,i.T=new Set,i.q=!1;const r=Symbol("Shrewd Decorators");class n{static get(t){if(c.J(t,r))return t[r];{let e=[];return c.K(t,r,e),e}}static L(t,e,s,i){if(void 0===e)return(e,s,i)=>n.L(e,s,i,t);if("string"==typeof e){let r=s||Object.getOwnPropertyDescriptor(t,e);if(!r)return n.N(t,e,i);if(r.get&&!r.set)return n.U(t,e,r);if("function"==typeof r.value)return n.X(t,e,r,i)}console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. `+"Decorated member must be one of the following: a field, a readonly get accessor, or a method.")}static N(t,e,s){Object.getOwnPropertyDescriptor(t,e)?console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. `+"Decorated property is not a field."):(n.get(t).push({Y:e,Z:t.constructor.name+"."+e.toString(),tt:j,m:s}),Object.defineProperty(t,e,{get(){return h.get(this),this[e]},set(t){h.get(this),this[e]=t}}))}static U(t,e,s){let i=t.constructor.name+"."+e.toString();return n.get(t).push({Y:i,Z:i,tt:y,et:s.get}),s.get=function(){return h.get(this).it(i).st()},s}static X(t,e,s,i){let r=t.constructor.name+"."+e.toString();return n.get(t).push({Y:r,Z:r,tt:S,et:s.value,m:i}),delete s.value,delete s.writable,s.get=function(){return h.get(this).it(r).st()},s}}const o=Symbol("ShrewdObject");class h{constructor(t){this.rt=!1,this.nt=new Map,this.ot=c.K(t,o,this);let e=Object.getPrototypeOf(this.ot);for(;e;){if(c.J(e,r)){let t=e[r];for(let e of t)this.setup(e)}e=Object.getPrototypeOf(e)}}static get(t){return c.J(t,o)?t[o]:new h(t)}setup(t){this.nt.set(t.Y,new t.tt(this.ot,t))}V(){if(!this.rt){for(let t of this.nt.values())t.V();this.rt=!0}}it(t){return this.nt.get(t)}get ht(){let t=[];for(let e of this.nt.values())e instanceof j&&t.push(e);return t}}class c{static J(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static K(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class u{}var a;!function(t){t[t.ct=0]="$outdated",t[t.ut=1]="$updated",t[t.at=2]="$pending"}(a||(a={}));class l extends t{constructor(t){super(),this.lt=new Set,this.ft=!1,this.dt=a.ct,this.rt=!1,this.$t=this.checkActive(),this.bt=t}static D(){for(let t of l.pt)t.dt==a.at&&t.$t&&(t.gt(),l.pt.delete(t))}static wt(t){if(t instanceof l&&t.rt)return;i.m.hook.read(t.s);let e=O.B;e&&e!=t&&!e.rt&&e.lt.add(t)}static yt(t){if(t instanceof l&&!t.rt&&(t.$t=t.checkActive(),!t.$t)){let e=new Set(t.lt);i.F(t);for(let t of e)l.yt(t)}}static A(t){O.R({h:!1,B:t}),t.ft=!0,i.F(t);let e=new Set(t.lt);t.jt();let s=t.A();if(t.gt(),!t.rt)for(let s of t.lt)e.delete(s),s.S(t),t.$t&&s instanceof l&&s.passDownActive();for(let t of e)l.yt(t);return t.ft=!1,O.M(),s}get l(){return this.ft}j(){this.St(),this.vt(),this.$t&&i.H(this)}V(){this.rt||(i.F(this),l.pt.delete(this),this.rt=!0,this.xt())}xt(){this.jt();for(let t of this.O)t.lt.delete(this),this.v(t);this.gt(),this.ft=!1}St(){if(this.dt==a.ut){this.dt=a.at,l.pt.add(this);for(let t of this.O)t.St()}}Ot(t=!1){if(this.l){let t=l.G.indexOf(this),e=[this,...l.G.slice(t+1),this];e.forEach(t=>t instanceof l&&t.V());let s=e.map(t=>"string"==typeof t?t:t.bt).join(" => ");console.warn("Circular dependency detected: "+s+"\nAll these reactions will be terminated.")}if(this.dt!=a.ut){l.G.push(this);for(let t of this.lt)t instanceof l&&(t.ft?l.A(this):t.dt!=a.ut&&t.Ot());this.dt==a.ct||t?l.A(this):(l.pt.delete(this),this.gt()),l.G.pop()}}gt(){this.dt=a.ut}vt(){this.dt=a.ct}get kt(){return this.dt==a.at}checkActive(){if(i.m.hook.sub(this.s))return!0;for(let t of this.O)if(t.$t)return!0;return!1}passDownActive(){if(!this.$t){this.$t=!0;for(let t of this.lt)t instanceof l&&t.passDownActive()}}jt(){for(let t of this.lt)t.v(this);this.lt.clear()}get Ct(){return this.rt}}l.pt=new Set,l.G=[];const f=Symbol("Observable Helper");class d extends t{constructor(t,e){super(),this._t=c.K(t,f,this),this.Rt=new Proxy(t,e),d.Pt.set(t,this.Rt)}static At(t){if(null==t||"object"!=typeof t)return t;if(d.Pt.has(t))return d.Pt.get(t);if(!d.Dt(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new v(t).Mt;break;case Set.prototype:t=new m(t).Mt;break;case Map.prototype:t=new w(t).Mt;break;case Object.prototype:t=new g(t).Mt}return t}static Dt(t){return null!=t&&"object"==typeof t&&c.J(t,f)}get Mt(){return this.Rt}}d.Pt=new WeakMap;class $ extends u{get(t,e,s){let i=t[f],r=Reflect.get(t,e);return"function"==typeof r&&(r=this.Tt.bind({Vt:e,B:t,et:r.bind(t),Wt:i,qt:s})),"size"==e&&l.wt(t[f]),r}Tt(...e){switch(this.Vt){case"clear":return void(l.o(this.Wt)&&this.B.size>0&&(this.B.clear(),t.g(this.Wt)));case"delete":return void(l.o(this.Wt)&&this.B.has(e[0])&&(this.B.delete(e[0]),t.g(this.Wt)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":l.wt(this.Wt);default:return this.et(...e)}}}class b extends l{constructor(t,e){super(e.Z),this.ot=t}}class p extends u{has(t,e){return l.wt(t[f]),Reflect.has(t,e)}get(t,e,s){return l.wt(t[f]),Reflect.get(t,e,s)}set(e,s,i,r){let n=e[f];if(t.o(n)){return i!==Reflect.get(e,s,r)&&(Reflect.set(e,s,d.At(i),r),t.g(n)),!0}return!0}deleteProperty(e,s){let i=e[f];if(t.o(i)){let r=Reflect.deleteProperty(e,s);return r&&t.g(i),r}return!0}}class g extends d{constructor(t){for(let e in t)t[e]=d.At(t[e]);super(t,g.Et)}get Ft(){let t=[];for(let e in this._t){let s=this._t[e];"object"==typeof s&&t.push(s)}return t}}g.Et=new p;class m extends d{constructor(t){for(let e of t)t.delete(e),t.add(d.At(e));super(t,m.Et)}get Ft(){let t=[];for(let e of this._t)"object"==typeof e&&t.push(e);return t}}m.Et=new class extends ${Tt(...e){return"add"==this.Vt?(l.o(this.Wt)&&!this.B.has(e[0])&&(this.B.add(d.At(e[0])),t.g(this.Wt)),this.qt):super.Tt.apply(this,e)}};class w extends d{constructor(t){for(let[e,s]of t)t.set(e,d.At(s));super(t,w.Et)}get Ft(){let t=[];for(let[e,s]of this._t)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}w.Et=new class extends ${Tt(...e){return"set"==this.Vt?(l.o(this.Wt)&&!this.B.has(e[0])&&(this.B.set(e[0],d.At(e[1])),t.g(this.Wt)),this.qt):super.Tt.apply(this,e)}};class y extends b{constructor(t,e){super(t,e),this.Ht=e.et}A(){let e=this.Ht.apply(this.ot);e!=this.zt&&(this.zt=e,t.g(this))}st(){return this.Ct||(l.wt(this),this.Ot()),this.zt}}class j extends b{constructor(t,e){super(t,e),this.It=e.m||{},Object.defineProperty(t,e.Y,j.Bt(e.Y)),this.It.renderer||this.gt()}static Bt(t){return j.Gt[t]=j.Gt[t]||{get(){return h.get(this).it(t).st()},set(e){h.get(this).it(t).Jt(e)}}}static get l(){return j.ft}static Kt(t){if(null!=t&&"object"==typeof t)if(d.Dt(t)){if(!j.Lt.has(t[f])){j.Lt.add(t[f]);for(let e of t[f].Ft)j.Kt(e)}}else if(c.J(t,o))for(let e of h.get(t).ht)j.Lt.has(e)||(j.Lt.add(e),j.Kt(e.Nt))}static $(t){return j.Lt.has(t)}vt(){this.It.renderer&&super.vt()}st(){return this.Ct||(l.wt(this),this.It.renderer&&this.Ot()),this.Nt}Jt(e){if(this.Ct)this.Nt=e;else if(t.o(this)&&e!==this.Qt){if(this.It.validator&&!this.It.validator.apply(this.ot,[e]))return i.m.hook.write(this.s);this.Qt=d.At(e),this.It.renderer?l.A(this):this.g(this.Qt)}}A(){j.ft=!0,j.Kt(this.Qt);let t=this.It.renderer.apply(this.ot,[this.Qt]);j.Lt.clear(),j.ft=!1,t!==this.Nt&&this.g(d.At(t))}g(e){this.Nt=e,t.g(this)}xt(){delete this.Qt,delete this.It,super.xt()}}j.Gt={},j.ft=!1,j.Lt=new Set;class S extends b{constructor(t,e){super(t,e),this.Tt=e.et,this.It=e.m||{}}checkActive(){return!0}st(){if(this.Ct)return()=>this.Ut;{l.wt(this);let t=!1;if(!O.p){if(this.It.lazy)return()=>(this.j(),this.Ut);this.kt||(t=!0)}return()=>(this.Ot(t),this.Ut)}}A(){return this.Ut=this.Tt.apply(this.ot),t.g(this),this.Ut}}class v extends d{constructor(t){for(let e in t)t[e]=d.At(t[e]);super(t,v.Et)}get Ft(){let t=[];for(let e of this._t)"object"==typeof e&&t.push(e);return this._t}}v.Et=new class extends p{get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&l.wt(t[f]),Reflect.get(t,e,s)}};const x={shrewd:n.L,symbol:o,commit:i._,construct:i.I,terminate:i.V,hook:{default:e,vue:s},option:i.m};"undefined"!=typeof window&&window.Vue&&(i.m.hook=new s);class O{static R(t){O.Xt.push(O.dt),O.dt=Object.assign({},O.dt,t)}static M(){O.dt=O.Xt.pop()}static get p(){return O.dt.p}static get h(){return O.dt.h}static get B(){return O.dt.B}}return O.dt={p:!1,h:!1,B:null},O.Xt=[],x});
//# sourceMappingURL=shrewd.min.js.map
