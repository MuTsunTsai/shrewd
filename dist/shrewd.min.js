/**
 * shrewd v1.0.0
 * (c) 2019 Mu-Tsun Tsai
 * Released under the MIT License.
 */

!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t extends Error{constructor(t,e,s){super(s),this.class=t.constructor.name,this.prop=e.toString(),this.name=`SetupError at ${this.class}[${this.prop}]`}}class e{static t(){e.s=!0;for(let t in e.i)for(let s of e.i[t])a.o(s);e.s=!1}static get h(){return e.s}static u(t){let s=t[c];e.i[s]=e.i[s]||new Set,e.i[s].add(t)}}e.i=[],e.s=!1;const s=Symbol("Shrewd Decorators");class r{static get(t){if(u.l(t,s))return t[s];{let e=[];return u.p(t,s,e),e}}static $(t,e){if("string"!=typeof e)return(e,s)=>r.m(e,s,t);r.m(t,e)}static m(e,s,i){if(Object.getOwnPropertyDescriptor(e,s))throw new t(e,s,"Decorated property is not a field.");r.get(e).push({key:s,type:d,validator:i}),Object.defineProperty(e,s,{get(){return o.get(this).g(),this[s]},set(t){o.get(this).g(),this[s]=t}})}static S(e,s,i){if(!i||!i.get)throw new t(e,s,"Decorated property has no getter.");if(i.set)throw new t(e,s,"Decorated property is not readonly.");let n=Symbol(s.toString());return r.get(e).push({key:n,type:f,method:i.get}),i.get=function(){let t=o.get(this);return t.g(),t.j(n).v()},i}static O(e,s,i){if(!i||"function"!=typeof i.value)throw new t(e,s,"Decorated member is not a method.");let n=Symbol(s.toString());return r.get(e).push({key:n,type:b,method:i.value}),delete i.value,i.get=function(){let t=o.get(this);return t.g(),t.j(n).v()},i}}const i=Symbol("ShrewdObject");class o{constructor(t){this.D=!1,this.k=new Map,this.M=t}static get(t){if(u.l(t,i))return t[i];{let e=new o(t);return u.p(t,i,e),e}}j(t){return this.k.get(t)}g(){if(this.D)return;let t=Object.getPrototypeOf(this.M);for(;t;){if(u.l(t,s)){let e=t[s];for(let t of e)this.k.set(t.key,new t.type(this.M,t))}t=Object.getPrototypeOf(t)}this.D=!0}}var n;const c=Symbol("Dependency Level");class h{constructor(){this[n]=0,this.q=new Set}static get F(){return!e.h||(console.warn("Writing into Observables during committing is forbidden; use computed property instead."),!1)}L(t){this.q.add(t)}W(t){this.q.delete(t)}A(){for(let t of this.q)e.u(t)}}n=c;class u{static l(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static p(t,e,s){Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s})}}class a extends h{constructor(){super(...arguments),this.B=new Set}static C(t){a.G&&a.G.B.add(t)}static o(t){let e=a.G;a.G=t;for(let e of t.B)e.W(t);t.B.clear(),t[c]=0,t.o();for(let e of t.B)e.L(t),e[c]>=t[c]&&(t[c]=e[c]+1);a.G=e}}a.G=null;class l extends a{constructor(t,e){super(),this.M=t,this.H=t.constructor.name+"."+e.key.toString()}get[Symbol.toStringTag](){return this.H}}class f extends l{constructor(t,e){super(t,e),this.D=!1,this.I=e.method}o(){let t=this.I.apply(this.M);t!=this.J&&(this.J=t,this.A())}v(){return this.D||(a.o(this),this.D=!0),this.J}}class d extends l{constructor(t,e){super(t,e),this.D=!1,this.K=e.validator||d.N,Object.defineProperty(t,e.key,d.interceptor(e.key))}static interceptor(t){return d.P[t]=d.P[t]||{get(){return o.get(this).j(t).v()},set(e){o.get(this).j(t).R(e)}}}g(){a.o(this),this.D=!0}v(){return this.D||this.g(),a.C(this),this.T}R(t){h.F&&t!=this.U&&(this.U=t,this.D?this.o():this.g())}o(){let t=this.K.apply(this.M,[this.U]);t!==this.T&&(this.T=t,this.A())}}d.P={},d.N=t=>t;class b extends l{constructor(t,e){super(t,e),this.V=e.method}v(){return this.V}o(){this.V()}}return{SetupError:t,observable:r.$,computed:r.S,reactive:r.O,commit:e.t}});