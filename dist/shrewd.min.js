/**
 * shrewd v0.0.15
 * (c) 2019-2022 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,(function(){return(()=>{var t=Object.defineProperty,e={};((e,s)=>{for(var i in(e=>{t(e,"__esModule",{value:!0})})(e),s)t(e,i,{get:s[i],enumerable:!0})})(e,{commit:()=>it,comparer:()=>ct,debug:()=>at,hook:()=>ht,initialize:()=>nt,option:()=>ot,shrewd:()=>et,symbol:()=>st,terminate:()=>rt});var s,i,r=Symbol("Shrewd Decorators"),n=class{constructor(t,e,s,i){this.t=t,this.i=e,this.h=s,this.o=i}get l(){return this.t.constructor.name+"."+this.i.toString()}get u(){return{$:this.i.toString(),p:this.t.constructor.name,g:this.m,v:this._,S:this.o}}get _(){}j(){}};(i=s||(s={})).array=function(t,e){if(!t!=!e)return!1;if(t==e)return!0;if(t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0},i.unorderedArray=function(t,e){if(!t!=!e)return!1;if(t==e)return!0;if(t.length!=e.length)return!1;for(let s of t)if(!e.includes(s))return!1;return!0};var h=class{static get(t){if(g.O(t,r))return t[r];{let e=[];return g.k(t,r,e),e}}static R(t,e,s,i){if(void 0===e)return"function"==typeof t?h.C(t):(e,s,i)=>h.R(e,s,i,t);if("string"==typeof e){let r=s||Object.getOwnPropertyDescriptor(t,e);if(!r)return h.P(V,t,e,void 0,i);if(r.get&&!r.set)return h.P(M,t,e,r,i);if("function"==typeof r.value)return h.P(G,t,e,r,i)}console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. Decorated member must be one of the following: a field, a readonly get accessor, or a method.`),C.S.debug}static C(t){var e=new Proxy(t,h.A);return h.M.add(e),e}static P(t,e,s,i,r){var n=new t(e,s,i,r);return h.get(e).push(n.u),n.j()}},o=h;o.M=new WeakSet,o.A={construct(t,e,s){h.M.has(s)||console.warn(`Class [${s.name}] is derived form @shrewd class [${t.name}], but it is not decorated with @shrewd.`),a.V({G:!0,q:!1,D:null}),D.T.push(`construct ${t.name}`);try{let i=Reflect.construct(t,e,s);return i.constructor==t&&new u(i),h.H.has(i)&&(h.H.delete(i),O.N(i)),i}finally{D.T.pop(),a.W()}}},o.H=new Set;var c=class{static V(t){c.F.push(c.K),c.K=Object.assign({},c.K,t)}static W(){c.K=c.F.pop(),0==c.F.length&&O.I()}static get q(){return c.K.q}static get G(){return c.K.G}static get B(){return c.K.B}static get D(){return c.K.D}static J(t){return c.K.L.has(t)}static U(t){c.K.L.add(t)}},a=c;a.K={q:!1,G:!1,B:!1,D:null,L:new Set},a.F=[];var l=Symbol("ShrewdObject"),u=class{constructor(t){this.X=!1,this.Y=new Map,this.Z=g.k(t,l,this);let e=Object.getPrototypeOf(this.Z);for(;e;){if(g.O(e,r)){let t=e[r];for(let e of t){let t=new e.g(this.Z,e);this.Y.has(t.tt)?t.et():this.Y.set(t.tt,t)}}e=Object.getPrototypeOf(e)}for(let t of this.Y.values())O.st(t)}et(){if(!this.X){for(let t of this.Y.values())t.et();delete this.Z,this.X=!0}}it(t){return t?this.Y.get(t):this.Y.values()}get rt(){let t=[];for(let e of this.Y.values())e instanceof U&&t.push(e);return t}},f=class{constructor(){this.nt=new Set,this.ht=f.ot++}static ct(t){return!(!a.G&&t.lt)||(a.B&&!a.J(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),C.S.debug,!1):!(!a.B&&a.q)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty."),C.S.debug,!1))}static ut(t){C.S.hook.write(t.ht);for(let e of t.nt)C.S.debug?e.ft(t):e.ft()}dt(t){this.nt.add(t)}$t(t){this.nt.delete(t)}get lt(){return this.nt.size>0}get gt(){return this.nt.values()}},d=f;d.ot=0;var $=class{read(t){return!1}write(t){}gc(){return[]}sub(t){return!1}},p=class{constructor(t){if(this.bt=new Set,this.wt=new Set,this.yt=t||"undefined"!=typeof window&&window.Vue,!this.yt)throw new Error("Global Vue not found; you need to pass a Vue constructor to VueHook.");let e=this.yt.version;if("string"!=typeof e||!e.startsWith("2."))throw new Error("Vue version 2.x is required.");this.vt=new this.yt({data:{shrewd:{}}})}read(t){let e=this.vt.shrewd[t];return a.q||e||(this.yt.set(this.vt.shrewd,t,{}),e=this.vt.shrewd[t]),e&&e.__ob__.dep.subs.length>0}write(t){C.S.autoCommit||a.q?this.yt.set(this.vt.shrewd,t,{}):this.bt.add(t)}precommit(){for(let t of this.bt)this.yt.set(this.vt.shrewd,t,{});this.bt.clear()}gc(){let t=[];for(let e in this.vt.shrewd){let s=Number(e);C.S.autoCommit||this.wt.has(s)?0==this.vt.shrewd[e].__ob__.dep.subs.length&&(C.S.autoCommit||this.wt.delete(s),this.yt.delete(this.vt.shrewd,e),t.push(Number(e))):this.wt.add(s)}return t}sub(t){return t in this.vt.shrewd&&this.vt.shrewd[t].__ob__.dep.subs.length>0}},g=class{static O(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static k(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}},b=class{get(t,e,s){let i=t[E],r=Reflect.get(t,e);return"function"==typeof r&&(r=this._.bind({_t:e,D:t,v:r.bind(t),St:i,jt:s})),"size"==e&&D.Ot(t[E]),r}_(...t){switch(this._t){case"clear":return void(D.ct(this.St)&&this.D.size>0&&(this.D.clear(),d.ut(this.St)));case"delete":return void(D.ct(this.St)&&this.D.has(t[0])&&(this.D.delete(t[0]),d.ut(this.St)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":D.Ot(this.St);default:return this.v(...t)}}},w=class{static xt(){C.kt(),w.Rt=!1}static j(){C.S.autoCommit&&!w.Rt&&(w.Rt=!0,Promise.resolve().then(w.xt))}},m=w;m.Rt=!1;var y=class{static I(){for(a.V({q:!0});y.bt.size>0;)for(let t of y.bt)t.Ct(),t.Pt||t.At();D.Mt(),a.W()}static Vt(t){y.bt.delete(t)}static st(t){t.Gt||y.bt.add(t),m.j()}},v=y;v.bt=new Set;var _=class{static st(t){t instanceof D&&_.bt.add(t)}static I(){for(let t of _.bt)D.qt(t);_.bt.clear();for(let t of C.S.hook.gc()){let e=D.Dt.get(t);e&&D.qt(e)}_.Et.clear()}static Tt(t){return!_.Et.has(t)&&(_.Et.add(t),!0)}},S=_;S.bt=new Set,S.Et=new Set;var j=class{static st(t){j.bt.add(t)}static I(){if(!j.zt){j.zt=!0;for(let t of j.bt)j.bt.delete(t),t.N();j.zt=!1}}static N(t){if(t[l]){if(!j.zt){j.zt=!0;for(let e of t[l].it())j.bt.delete(e),e.N();j.zt=!1}}else o.H.add(t)}},O=j;O.bt=new Set,O.zt=!1;var x=class{static I(){for(let t of x.bt)t.et();x.bt.clear()}static et(t,e=!1){if(t instanceof Object&&g.O(t,l)){let s=t[l];e?x.bt.add(s):s.et()}}},k=x;k.bt=new Set;var R=class{static kt(){R.S.hook.precommit&&R.S.hook.precommit(),v.I(),k.I(),R.S.debug&&D.Ht(),S.I(),R.S.hook.postcommit&&R.S.hook.postcommit()}},C=R;C.S={hook:new $,autoCommit:!0,debug:!1};var P,A,M=class extends n{get m(){return L}get _(){return this.h.get}j(){let t=this.l,e=this._;return this.h.get=function(){if(g.O(this,l)){return this[l].it(t).Nt()}return e.apply(this)},this.h}},V=class extends n{get m(){return U}},G=class extends n{get m(){return X}get _(){return this.h.value}j(){let t=this.l,e=this._;return delete this.h.value,delete this.h.writable,this.h.get=function(){if(g.O(this,l)){return this[l].it(t).Nt()}return e.bind(this)},this.h}};(A=P||(P={}))[A.Wt=0]="$outdated",A[A.Ft=1]="$updated",A[A.Kt=2]="$pending";var q=class extends d{constructor(t){super(),this.It=[],this.Bt=!1,this.K=0,this.X=!1,this.Jt=!1,this.Lt=!0,this.trigger=new Set,q.Dt.set(this.ht,this),this.l=t}static Mt(){for(let t of q.Qt)2==t.K&&t.Ut&&(t.Xt(),q.Qt.delete(t))}static Ht(){for(let t of q.Yt)t.trigger.clear();q.Yt.clear()}static Zt(t){let e=[t.l];for(;t.trigger.size;){let s=t.trigger.values().next().value;if(!(s instanceof q))break;let i=s.l;s instanceof H&&(i+="("+H.te(s)+")"),e.push(i),t=s}console.log(e)}static Ot(t){if(t instanceof q&&t.X)return;C.S.hook.read(t.ht)&&t instanceof q&&t.ee();let e=a.D;!e||e==t||e.X||e.Jt&&!e.Lt||e.It.push(t)}static qt(t){if(S.Tt(t)&&!t.X&&!(t.se=t.ie()))for(let e of t.It)e instanceof q&&q.qt(e)}get Gt(){return!!this.Bt}At(){a.V({G:!1,D:this}),this.Bt=!0,v.Vt(this);try{let t;this.Jt||(t=this.It,this.re()),this.ne();try{let t=this.he();this.oe(t)}finally{this.ce()}if(this.Xt(),this.Jt){if(this.Lt){for(let t of this.It)t.dt(this),this.Ut&&t instanceof q&&t.ee();this.Lt=!1}}else{let e={};if(!this.X)for(let t of this.It)e[t.ht]=!0,t.dt(this),this.Ut&&t instanceof q&&t.ee();for(let s of t)s.ht in e||S.st(s)}}finally{this.Bt=!1,a.W()}}ft(t){this.ae(),this.le(t),this.Ut&&v.st(this)}et(t=!1){if(!this.X&&(v.Vt(this),q.Dt.delete(this.ht),q.Qt.delete(this),this.ue(),this.X=!0,this.re(),t))for(let t of this.gt){let e=t.It.indexOf(this),s=t.It.pop();s!=this&&(t.It[e]=s),this.$t(t)}}ue(){this.Xt(),this.Bt=!1}ae(){if(1==this.K){this.K=2,q.Qt.add(this);for(let t of this.gt)t.ae()}}fe(){if(this.Bt&&this.de(),1!=this.K){q.T.push(this);try{this.Ct(),0==this.K?this.At():(q.Qt.delete(this),this.Xt())}finally{q.T.pop()}}}Ct(){for(let t of this.It)if(t instanceof q){if(t.Bt){this.At();break}1!=t.K&&t.fe()}}de(){C.S.debug;let t=q.T.indexOf(this),e=[this,...q.T.slice(t+1)];e.forEach((t=>t instanceof q&&t.et(!0))),e.push(this);let s=e.map((t=>"string"==typeof t?t:t.l)).join(" => ");console.warn("Cyclic dependency detected: "+s+"\nAll these reactions will be terminated.")}Xt(){this.K=1}le(t){t&&(q.Yt.add(this),this.trigger.add(t)),this.K=0}get $e(){return this.K}get Ut(){return this.se=null!=this.se?this.se:this.ie()}ie(){if(C.S.hook.sub(this.ht))return!0;for(let t of this.gt)if(t.Ut)return!0;return!1}ee(){if(!this.Ut){this.se=!0;for(let t of this.It)t instanceof q&&t.ee()}}ne(){}oe(t){}ce(){}re(){for(let t of this.It)t.$t(this);this.It=[]}get pe(){return this.It.length>0}get Pt(){return this.X}},D=q;D.Qt=new Set,D.Yt=new Set,D.Dt=new Map,D.T=[];var E=Symbol("Observable Helper"),T=class extends d{static ge(t){if(!(t instanceof Object))return t;if(T.be.has(t))return T.be.get(t);if(!T.we(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new Z(t).me;break;case Set.prototype:t=new J(t).me;break;case Map.prototype:t=new I(t).me;break;case Object.prototype:t=new F(t).me}return t}static ye(t){T.we(t)&&(t=t[E].ve),t instanceof Object&&T.be.has(t)&&T.be.delete(t)}static we(t){return t instanceof Object&&g.O(t,E)}constructor(t,e){super(),this.ve=g.k(t,E,this),this._e=new Proxy(t,e),T.be.set(t,this._e)}get me(){return this._e}},z=T;z.be=new WeakMap;var H=class extends D{static te(t){return t.Z.constructor.name}constructor(t,e){var s,i;super(e.p+"."+e.$.toString()),this.h=e,this.Se=Object.assign(this.je,e.S),this.Jt=null!=(i=null==(s=e.S)?void 0:s.static)&&i,this.Z=t}get tt(){return this.h.p+"."+this.h.$.toString()}N(){this.fe()}get je(){return{}}ie(){return!!this.Se.active||super.ie()}Nt(){return this.Pt?this.Oe():(D.Ot(this),this.xe())}},N=class{has(t,e){return D.Ot(t[E]),Reflect.has(t,e)}get(t,e,s){return D.Ot(t[E]),Reflect.get(t,e,s)}set(t,e,s,i){let r=t[E];if(d.ct(r)){return s!==Reflect.get(t,e,i)&&(Reflect.set(t,e,z.ge(s),i),d.ut(r)),!0}return!0}deleteProperty(t,e){let s=t[E];if(d.ct(s)){let i=Reflect.deleteProperty(t,e);return i&&d.ut(s),i}return!0}},W=class extends z{constructor(t){for(let e in t)t[e]=z.ge(t[e]);super(t,W.ke)}get Re(){let t=[];for(let e in this.ve){let s=this.ve[e];"object"==typeof s&&t.push(s)}return t}},F=W;F.ke=new N;var K=class extends z{constructor(t){for(let[e,s]of t)t.set(e,z.ge(s));super(t,K.ke)}get Re(){let t=[];for(let[e,s]of this.ve)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}},I=K;I.ke=new class extends b{_(...t){return"set"==this._t?(D.ct(this.St)&&!this.D.has(t[0])&&(this.D.set(t[0],z.ge(t[1])),d.ut(this.St)),this.jt):super._.apply(this,t)}};var B=class extends z{constructor(t){for(let e of t)t.delete(e),t.add(z.ge(e));super(t,B.ke)}get Re(){let t=[];for(let e of this.ve)"object"==typeof e&&t.push(e);return t}},J=B;J.ke=new class extends b{_(...t){return"add"==this._t?(D.ct(this.St)&&!this.D.has(t[0])&&(this.D.add(z.ge(t[0])),d.ut(this.St)),this.jt):super._.apply(this,t)}};var L=class extends H{constructor(t,e){var s;super(t,e),this.Ce=e.v,this.Se.active&&this.ft(),null!=(s=this.Se).comparer||(s.comparer=(t,e)=>t===e)}get he(){return this.Ce.bind(this.Z)}oe(t){this.Se.comparer.apply(this.Z,[this.Pe,t,this])||(this.Pe=t,d.ut(this)),this.pe||this.et()}xe(){return this.fe(),this.pe||this.et(),this.Pe}Oe(){return this.Pe}ue(){z.ye(this.Pe),super.ue()}},Q=class extends H{constructor(t,e){super(t,e),this.Ae=!1,this.Me=this.Ve=Reflect.get(t,e.$),Object.defineProperty(t,e.$,Q.Ge(e.$)),this.Se.renderer||this.Xt()}static Ge(t){return Q.qe[t]=Q.qe[t]||{get(){return this[l].it(t).Nt()},set(e){this[l].it(t).De(e)}}}static U(t){if(t instanceof Object)if(z.we(t)){if(!a.J(t[E])){a.U(t[E]);for(let e of t[E].Re)Q.U(e)}}else if(g.O(t,l))for(let e of t[l].rt)a.J(e)||(a.U(e),Q.U(e.Me))}get tt(){return this.h.$.toString()}N(){this.Ae||(this.Ee(),this.Se.renderer?this.fe():this.Me=this.Ve,this.Ae=!0)}le(t){this.Se.renderer&&super.le(t)}Ee(){var t,e;null==(e=null==(t=this.Se.validator)?void 0:t.apply(this.Z,[this.Ve]))||e||(this.Ve=void 0),this.Ve=z.ge(this.Ve)}xe(){return this.Ae?(this.Se.renderer&&this.fe(),this.Me):(this.Ee(),this.Ve)}Oe(){return this.Me}De(t){var e,s;if(this.Pt)this.Me=t;else if(d.ct(this)&&t!==this.Ve){if(null!=(s=null==(e=this.Se.validator)?void 0:e.apply(this.Z,[t]))&&!s)return C.S.hook.write(this.ht);if(this.Ve=z.ge(t),this.Se.renderer){this.ne();try{this.oe(this.he())}finally{this.ce()}}else this.ut(this.Ve)}}ne(){a.V({B:!0,L:new Set}),Q.U(this.Ve)}get he(){return this.Se.renderer.bind(this.Z,this.Ve)}oe(t){t!==this.Me&&this.ut(z.ge(t))}ce(){a.W()}ut(t){this.Me=t,d.ut(this)}ue(){z.ye(this.Ve),z.ye(this.Me),delete this.Ve,delete this.Se,super.ue()}},U=Q;U.qe={};var X=class extends H{constructor(t,e){super(t,e),this._=e.v}get je(){return{active:!0}}get he(){return this._.bind(this.Z)}xe(){return()=>(this.fe(),this.Te)}Oe(){return()=>this.Te}oe(t){this.Te=t,d.ut(this)}ue(){z.ye(this.Te),super.ue()}},Y=class extends z{constructor(t){for(let e in t)t[e]=z.ge(t[e]);super(t,Y.ke)}get Re(){let t=[];for(let e of this.ve)"object"==typeof e&&t.push(e);return this.ve}},Z=Y;Z.ke=new class extends N{get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&D.Ot(t[E]),Reflect.get(t,e,s)}};var tt=class{constructor(t){if(this.ze={},this.bt=new Set,this.wt=new Set,this.vt=t||"undefined"!=typeof window&&window.Vue,!this.vt)throw new Error("Global Vue not found; you need to pass a Vue module to VueHook.");let e=this.vt.version;if("string"!=typeof e||!e.startsWith("3."))throw new Error("Vue version 3.x is required.")}read(t){let e=this.ze[t];return null==e||e.value,a.q||e||(e=this.Xt(t)),e&&this.He(t)}write(t){C.S.autoCommit||a.q?this.Xt(t):this.bt.add(t)}precommit(){for(let t of this.bt)this.Xt(t);this.bt.clear()}Xt(t){return t in this.ze?this.ze[t].value={}:this.ze[t]=this.vt.ref({}),this.ze[t].value,this.ze[t]}gc(){let t=[];for(let e in this.ze){let s=Number(e);C.S.autoCommit||this.wt.has(s)?this.He(s)||(C.S.autoCommit||this.wt.delete(s),delete this.ze[e],t.push(Number(e))):this.wt.add(s)}return t}He(t){var e,s;return(null!=(s=null==(e=this.ze[t].dep)?void 0:e.size)?s:0)>0}sub(t){return t in this.ze&&this.He(t)}};"undefined"!=typeof window&&window.Vue&&(window.Vue.version.startsWith("2")?C.S.hook=new p:C.S.hook=new tt);var et=o.R,st=l,it=C.kt,rt=k.et,nt=O.N,ht={default:$,vue:p,vue3:tt},ot=C.S,ct=s,at={trigger(t,e){if(t instanceof Object)if(g.O(t,l)){let s=t[l].it(e);s?D.Zt(s):console.log("Member not found")}else t instanceof D&&D.Zt(t)}};return e})()}));
//# sourceMappingURL=shrewd.min.js.map
