/**
 * shrewd v0.0.3
 * (c) 2019-2020 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t{constructor(){this.t=new Set,this.s=t.i++}static h(t){return!(!R.o&&t.u)||(R.l&&!R.$(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),i.p.debug,!1):!(!R.l&&R.g)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty. For constructing new Shrewd objects, use Shrewd.construct() method."),i.p.debug,!1))}static m(t){i.p.hook.write(t.s);for(let e of t.t)e.v()}_(t){this.t.add(t)}S(t){this.t.delete(t)}get u(){return this.t.size>0}get j(){return this.t.values()}}t.i=0;class e{read(t){}write(t){}gc(){}sub(t){return!1}}class s{constructor(){this.O=new Vue({data:{shrewd:{}}})}read(t){this.O.shrewd[t]}write(t){Vue.set(this.O.shrewd,t,{})}gc(){for(let t in this.O.shrewd)0==this.O.shrewd[t].R.dep.subs.length&&Vue.delete(this.O.shrewd,t)}sub(t){return t in this.O.shrewd&&this.O.shrewd[t].R.dep.subs.length>0}}class i{static C(){R.k({g:!0});try{for(let t of i.P)l.A(t)}finally{l.G(),i.P.clear(),R.D();for(let t of i.M)t.W();i.M.clear(),i.p.hook.gc()}}static q(t){i.F.add(t)}static T(){if(!i.V){i.V=!0;for(let t of i.F)i.F.delete(t),t.T();i.V=!1}}static H(){i.C(),i.I=!1}static K(t){i.P.delete(t)}static B(t){if(t.J||i.P.add(t),i.p.autoCommit&&!i.I){Promise.resolve().then(i.H),i.I=!0}}static W(t,e=!1){if(o.L(t,n)){let s=t[n];e?i.M.add(s):s.W()}}}i.p={hook:new e,autoCommit:!0,debug:!0},i.P=new Set,i.M=new Set,i.F=new Set,i.I=!1,i.V=!1;class r{static get(t){if(o.L(t,C))return t[C];{let e=[];return o.N(t,C,e),e}}static U(t,e,s,n){if(void 0===e)return"function"==typeof t?r.X(t):(e,s,i)=>r.U(e,s,i,t);if("string"==typeof e){let i=s||Object.getOwnPropertyDescriptor(t,e);if(!i)return r.Y(x,t,e,void 0,n);if(i.get&&!i.set)return r.Y(j,t,e,i,n);if("function"==typeof i.value)return r.Y(O,t,e,i,n)}console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. `+"Decorated member must be one of the following: a field, a readonly get accessor, or a method."),i.p.debug}static X(t){var e=new Proxy(t,r.Z);return r.tt.add(e),e}static Y(t,e,s,i,n){var h=new t(e,s,i,n);return r.get(e).push(h.et),h.st()}}r.tt=new WeakSet,r.Z={construct(t,e,s){r.tt.has(s)||console.warn(`Class [${s.name}] is derived form @shrewd class [${t.name}], but it is not decorated with @shrewd.`),R.k({o:!0,g:!1,it:null}),l.rt.push(`construct ${t.name}`);try{let i=Reflect.construct(t,e,s);return i.constructor==t&&new h(i),i}finally{l.rt.pop(),R.D()}}};const n=Symbol("ShrewdObject");class h{constructor(t){this.nt=!1,this.ht=new Map,this.ot=o.N(t,n,this);let e=Object.getPrototypeOf(this.ot);for(;e;){if(o.L(e,C)){let t=e[C];for(let e of t){let t=new e.ct(this.ot,e);this.ht.set(t.ut,t)}}e=Object.getPrototypeOf(e)}for(let t of this.ht.values())i.q(t)}W(){if(!this.nt){for(let t of this.ht.values())t.W();this.nt=!0}}lt(t){return this.ht.get(t)}get at(){let t=[];for(let e of this.ht.values())e instanceof m&&t.push(e);return t}}class o{static L(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static N(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class c{get(t,e,s){let i=t[a],r=Reflect.get(t,e);return"function"==typeof r&&(r=this.ft.bind({dt:e,it:t,$t:r.bind(t),pt:i,bt:s})),"size"==e&&l.gt(t[a]),r}ft(...e){switch(this.dt){case"clear":return void(l.h(this.pt)&&this.it.size>0&&(this.it.clear(),t.m(this.pt)));case"delete":return void(l.h(this.pt)&&this.it.has(e[0])&&(this.it.delete(e[0]),t.m(this.pt)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":l.gt(this.pt);default:return this.$t(...e)}}}var u;!function(t){t[t.yt=0]="$outdated",t[t.wt=1]="$updated",t[t.vt=2]="$pending"}(u||(u={}));class l extends t{constructor(t){super(),this._t=new Set,this.St=!1,this.jt=u.yt,this.nt=!1,this.xt=t}static G(){for(let t of l.Ot)t.jt==u.vt&&t.Rt&&(t.Ct(),l.Ot.delete(t))}static gt(t){if(t instanceof l&&t.nt)return;i.p.hook.read(t.s);let e=R.it;e&&e!=t&&!e.nt&&e._t.add(t)}static kt(t){if(t instanceof l&&!t.nt&&(t.Pt=t.checkActive(),!t.Rt)){let e=new Set(t._t);i.K(t);for(let t of e)l.kt(t)}}static A(t){R.k({o:!1,it:t}),t.St=!0,i.K(t);try{let e=new Set(t._t);t.At();let s=t.A();if(t.Ct(),!t.nt)for(let s of t._t)e.delete(s),s._(t),t.Rt&&s instanceof l&&s.activate();for(let t of e)l.kt(t);return s}finally{t.St=!1,R.D()}}get J(){return this.St}v(){this.Gt(),this.zt(),this.Rt&&i.B(this)}W(){this.nt||(i.K(this),l.Ot.delete(this),this.nt=!0,this.Dt())}Dt(){this.At();for(let t of this.j)t._t.delete(this),this.S(t);this.Ct(),this.St=!1}Gt(){if(this.jt==u.wt){this.jt=u.vt,l.Ot.add(this);for(let t of this.j)t.Gt()}}Mt(t=!1){if(this.St&&this.Wt(),this.jt!=u.wt){l.rt.push(this);try{for(let t of this._t)if(t instanceof l){if(t.St){l.A(this);break}t.jt!=u.wt&&t.Mt()}this.jt==u.yt||t?l.A(this):(l.Ot.delete(this),this.Ct())}finally{l.rt.pop()}}}Wt(){i.p.debug;let t=l.rt.indexOf(this),e=[this,...l.rt.slice(t+1)];e.forEach(t=>t instanceof l&&t.W()),e.push(this);let s=e.map(t=>"string"==typeof t?t:t.xt).join(" => ");console.warn("Cyclic dependency detected: "+s+"\nAll these reactions will be terminated.")}Ct(){this.jt=u.wt}zt(){this.jt=u.yt}get qt(){return this.jt}get Rt(){return this.Pt=null!=this.Pt?this.Pt:this.checkActive()}checkActive(){if(i.p.hook.sub(this.s))return!0;for(let t of this.j)if(t.Rt)return!0;return!1}activate(){if(!this.Rt){this.Pt=!0;for(let t of this._t)t instanceof l&&t.activate()}}At(){for(let t of this._t)t.S(this);this._t.clear()}get Ft(){return this._t.size>0}get Tt(){return this.nt}}l.Ot=new Set,l.rt=[];const a=Symbol("Observable Helper");class f extends t{constructor(t,e){super(),this.Vt=o.N(t,a,this),this.Et=new Proxy(t,e),f.Ht.set(t,this.Et)}static It(t){if(null==t||"object"!=typeof t)return t;if(f.Ht.has(t))return f.Ht.get(t);if(!f.Kt(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new v(t).Bt;break;case Set.prototype:t=new b(t).Bt;break;case Map.prototype:t=new g(t).Bt;break;case Object.prototype:t=new p(t).Bt}return t}static Kt(t){return null!=t&&"object"==typeof t&&o.L(t,a)}get Bt(){return this.Et}}f.Ht=new WeakMap;class d extends l{constructor(t,e){super(e.Jt+"."+e.Lt.toString()),this.Nt=e,this.Qt=Object.assign(this.Ut,e.p),this.ot=t}get ut(){return this.Nt.Jt+"."+this.Nt.Lt.toString()}T(){this.Mt()}get Ut(){return{}}checkActive(){return!!this.Qt.active||super.checkActive()}Xt(){return this.Tt?this.Yt():(l.gt(this),this.Zt())}}class ${has(t,e){return l.gt(t[a]),Reflect.has(t,e)}get(t,e,s){return l.gt(t[a]),Reflect.get(t,e,s)}set(e,s,i,r){let n=e[a];if(t.h(n)){return i!==Reflect.get(e,s,r)&&(Reflect.set(e,s,f.It(i),r),t.m(n)),!0}return!0}deleteProperty(e,s){let i=e[a];if(t.h(i)){let r=Reflect.deleteProperty(e,s);return r&&t.m(i),r}return!0}}class p extends f{constructor(t){for(let e in t)t[e]=f.It(t[e]);super(t,p.te)}get ee(){let t=[];for(let e in this.Vt){let s=this.Vt[e];"object"==typeof s&&t.push(s)}return t}}p.te=new $;class b extends f{constructor(t){for(let e of t)t.delete(e),t.add(f.It(e));super(t,b.te)}get ee(){let t=[];for(let e of this.Vt)"object"==typeof e&&t.push(e);return t}}b.te=new class extends c{ft(...e){return"add"==this.dt?(l.h(this.pt)&&!this.it.has(e[0])&&(this.it.add(f.It(e[0])),t.m(this.pt)),this.bt):super.ft.apply(this,e)}};class g extends f{constructor(t){for(let[e,s]of t)t.set(e,f.It(s));super(t,g.te)}get ee(){let t=[];for(let[e,s]of this.Vt)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}g.te=new class extends c{ft(...e){return"set"==this.dt?(l.h(this.pt)&&!this.it.has(e[0])&&(this.it.set(e[0],f.It(e[1])),t.m(this.pt)),this.bt):super.ft.apply(this,e)}};class y extends d{constructor(t,e){super(t,e),this.se=e.$t,this.Qt.active&&this.v()}A(){let e=this.se.apply(this.ot);e!==this.ie&&(this.ie=e,t.m(this)),this.Ft||this.W()}Zt(){return this.Mt(),this.Ft||this.W(),this.ie}Yt(){return this.ie}}class m extends d{constructor(t,e){super(t,e),this.re=!1,this.ne=t[e.Lt],Object.defineProperty(t,e.Lt,m.he(e.Lt)),this.Qt.renderer||this.Ct()}static he(t){return m.oe[t]=m.oe[t]||{get(){return this[n].lt(t).Xt()},set(e){this[n].lt(t).ce(e)}}}static ue(t){if(null!=t&&"object"==typeof t)if(f.Kt(t)){if(!R.$(t[a])){R.ue(t[a]);for(let e of t[a].ee)m.ue(e)}}else if(o.L(t,n))for(let e of t[n].at)R.$(e)||(R.ue(e),m.ue(e.le))}get ut(){return this.Nt.Lt.toString()}T(){this.re||(this.Qt.validator&&!this.Qt.validator.apply(this.ot,[this.ne])&&(this.ne=void 0),this.ae(this.ne),this.re=!0)}zt(){this.Qt.renderer&&super.zt()}Zt(){return this.re?this.Qt.renderer&&this.Mt():this.T(),this.le}Yt(){return this.le}ce(e){if(this.Tt)this.le=e;else if(t.h(this)&&e!==this.ne){if(this.Qt.validator&&!this.Qt.validator.apply(this.ot,[e]))return i.p.hook.write(this.s);this.ae(e)}}ae(t){this.ne=f.It(t),this.Qt.renderer?this.A():this.m(this.ne)}A(){R.k({l:!0,fe:new Set});try{m.ue(this.ne);let t=this.Qt.renderer.apply(this.ot,[this.ne]);t!==this.le&&this.m(f.It(t))}finally{R.D()}}m(e){this.le=e,t.m(this)}Dt(){delete this.ne,delete this.Qt,super.Dt()}}m.oe={};class w extends d{constructor(t,e){super(t,e),this.ft=e.$t}get Ut(){return{active:!0}}Zt(){return()=>(this.Mt(),this.de)}Yt(){return()=>this.de}A(){return this.de=this.ft.apply(this.ot),t.m(this),this.de}}class v extends f{constructor(t){for(let e in t)t[e]=f.It(t[e]);super(t,v.te)}get ee(){let t=[];for(let e of this.Vt)"object"==typeof e&&t.push(e);return this.Vt}}v.te=new class extends ${get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&l.gt(t[a]),Reflect.get(t,e,s)}};const _={shrewd:r.U,symbol:n,commit:i.C,terminate:i.W,hook:{default:e,vue:s},option:i.p};"undefined"!=typeof window&&window.Vue&&(i.p.hook=new s);class S{constructor(t,e,s,i){this.$e=t,this.pe=e,this.Nt=s,this.be=i}get xt(){return this.$e.constructor.name+"."+this.pe.toString()}get et(){return{Lt:this.pe.toString(),Jt:this.$e.constructor.name,ct:this.ge,$t:this.ft,p:this.be}}get ft(){}st(){}}class j extends S{get ge(){return y}get ft(){return this.Nt.get}st(){let t=this.xt,e=this.ft;return this.Nt.get=function(){if(o.L(this,n)){return this[n].lt(t).Xt()}return e.apply(this)},this.Nt}}class x extends S{get ge(){return m}}class O extends S{get ge(){return w}get ft(){return this.Nt.value}st(){let t=this.xt,e=this.ft;return delete this.Nt.value,delete this.Nt.writable,this.Nt.get=function(){if(o.L(this,n)){return this[n].lt(t).Xt()}return e.bind(this)},this.Nt}}class R{static k(t){R.ye.push(R.jt),R.jt=Object.assign({},R.jt,t)}static D(){R.jt=R.ye.pop(),0==R.ye.length&&i.T()}static get g(){return R.jt.g}static get o(){return R.jt.o}static get l(){return R.jt.l}static get it(){return R.jt.it}static $(t){return R.jt.fe.has(t)}static ue(t){R.jt.fe.add(t)}}R.jt={g:!1,o:!1,l:!1,it:null,fe:new Set},R.ye=[];const C=Symbol("Shrewd Decorators");return _});
//# sourceMappingURL=shrewd.min.js.map
