/**
 * shrewd v0.0.0-beta.11
 * (c) 2019 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t{constructor(){this.t=new Set,this.s=t.nextId}static get nextId(){return t.i++}static o(t){return!(!O.h&&t.u)||(v.l&&!v.$(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),!1):!(!v.l&&O.p)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty. For constructing new Shrewd objects, use Shrewd.construct() method."),!1))}static g(t){i.m.hook.write(t.s);for(let e of t.t)e.v()}j(t){this.t.add(t)}S(t){this.t.delete(t)}get u(){return this.t.size>0||i.m.hook.sub(this.s)}get O(){return this.t.values()}}t.i=0;class e{read(t){}write(t){}gc(){}sub(t){return!1}}class s{constructor(){this._=new Vue({data:{shrewd:{}}})}read(t){this._.shrewd[t]}write(t){Vue.set(this._.shrewd,t,{})}gc(){for(let t in this._.shrewd)0==this._.shrewd[t].C.dep.subs.length&&Vue.delete(this._.shrewd,t)}sub(t){return t in this._.shrewd&&this._.shrewd[t].C.dep.subs.length>0}}class i{static k(){O.R({p:!0});for(let t of i.A)l.P(t);l.M(),i.A.clear(),O.D();for(let t of i.T)t.V();i.T.clear(),i.m.hook.gc()}static W(){i.k(),i.q=!1}static F(t){i.A.delete(t)}static H(t){if(t.l||i.A.add(t),i.m.autoCommit&&!i.q){Promise.resolve().then(i.W),i.q=!0}}static I(t,...e){O.R({h:!0,p:!1,B:!1,G:null}),l.J.push("construct "+t.name);let s=new t(...e);return l.J.pop(),O.D(),s}static V(t){c.K(t,o)&&i.T.add(t[o])}}i.m={hook:new e,autoCommit:!0},i.A=new Set,i.T=new Set,i.q=!1;const r=Symbol("Shrewd Decorators");class n{static get(t){if(c.K(t,r))return t[r];{let e=[];return c.L(t,r,e),e}}static N(t,e,s,i){if(void 0===e)return(e,s,i)=>n.N(e,s,i,t);if("string"==typeof e){let r=s||Object.getOwnPropertyDescriptor(t,e);if(!r)return n.U(t,e,i);if(r.get&&!r.set)return n.X(t,e,r);if("function"==typeof r.value)return n.Y(t,e,r,i)}console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. `+"Decorated member must be one of the following: a field, a readonly get accessor, or a method.")}static U(t,e,s){Object.getOwnPropertyDescriptor(t,e)?console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. `+"Decorated property is not a field."):(n.get(t).push({Z:e,tt:t.constructor.name+"."+e.toString(),et:v,m:s}),Object.defineProperty(t,e,{get(){return h.get(this),this[e]},set(t){h.get(this),this[e]=t}}))}static X(t,e,s){let i=t.constructor.name+"."+e.toString();return n.get(t).push({Z:i,tt:i,et:y,st:s.get}),s.get=function(){return h.get(this).rt(i).it()},s}static Y(t,e,s,i){let r=t.constructor.name+"."+e.toString();return n.get(t).push({Z:r,tt:r,et:j,st:s.value,m:i}),delete s.value,delete s.writable,s.get=function(){return h.get(this).rt(r).it()},s}}const o=Symbol("ShrewdObject");class h{constructor(t){this.nt=!1,this.ot=new Map,this.ht=c.L(t,o,this);let e=Object.getPrototypeOf(this.ht);for(;e;){if(c.K(e,r)){let t=e[r];for(let e of t)this.setup(e)}e=Object.getPrototypeOf(e)}}static get(t){return c.K(t,o)?t[o]:new h(t)}setup(t){this.ot.set(t.Z,new t.et(this.ht,t))}V(){if(!this.nt){for(let t of this.ot.values())t.V();this.nt=!0}}rt(t){return this.ot.get(t)}get ct(){let t=[];for(let e of this.ot.values())e instanceof v&&t.push(e);return t}}class c{static K(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static L(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class u{}var a;!function(t){t[t.ut=0]="$outdated",t[t.at=1]="$updated",t[t.lt=2]="$pending"}(a||(a={}));class l extends t{constructor(t){super(),this.ft=new Set,this.dt=!1,this.$t=a.ut,this.nt=!1,this.bt=t}static M(){for(let t of l.pt)t.$t==a.lt&&t.gt();l.pt.clear()}static wt(t){if(t instanceof l&&t.nt)return;i.m.hook.read(t.s);let e=O.G;e&&e!=t&&!e.nt&&e.ft.add(t)}static yt(t){if(t instanceof l&&!t.vt&&!t.nt){let e=new Set(t.ft);t.jt(),i.F(t),t.St();for(let t of e)l.yt(t)}}static P(t){O.R({h:!1,G:t,B:O.B||t.vt}),t.dt=!0,i.F(t);let e=new Set(t.ft);t.jt();let s=t.P();if(O.B&&t.gt(),!t.nt)for(let s of t.ft)e.delete(s),O.B&&s.j(t);for(let t of e)l.yt(t);return t.dt=!1,O.D(),s}get l(){return this.dt}v(){this.xt(),this.St(),i.H(this)}V(){this.nt||(this.nt=!0,this.Ot())}Ot(){this.jt();for(let t of this.O)t.ft.delete(this),this.S(t);this.gt(),this.dt=!1}xt(){if(this.$t==a.at){this.$t=a.lt,l.pt.add(this);for(let t of this.O)t.xt()}}_t(t=!1){if(this.l){let t=l.J.indexOf(this),e=[this,...l.J.slice(t+1),this];e.forEach(t=>t instanceof l&&t.V());let s=e.map(t=>"string"==typeof t?t:t.bt).join(" => ");console.warn("Circular dependency detected: "+s+"\nAll these observers will be terminated.")}if(this.$t!=a.at){l.J.push(this);for(let t of this.ft)t instanceof l&&(t.dt?l.P(this):t.$t!=a.at&&t._t());this.$t==a.ut||t?l.P(this):(l.pt.delete(this),this.gt()),l.J.pop()}}gt(){this.$t=a.at}St(){this.$t=a.ut}get Ct(){return this.$t==a.lt}get vt(){return this.u}jt(){for(let t of this.ft)t.S(this);this.ft.clear()}get kt(){return this.nt}}l.pt=new Set,l.J=[];const f=Symbol("Observable Helper");class d extends t{constructor(t,e){super(),this.Rt=c.L(t,f,this),this.At=new Proxy(t,e),d.Pt.set(t,this.At)}static Mt(t){if(null==t||"object"!=typeof t)return t;if(d.Pt.has(t))return d.Pt.get(t);if(!d.Dt(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new S(t).Tt;break;case Set.prototype:t=new m(t).Tt;break;case Map.prototype:t=new w(t).Tt;break;case Object.prototype:t=new g(t).Tt}return t}static Dt(t){return null!=t&&"object"==typeof t&&c.K(t,f)}get Tt(){return this.At}}d.Pt=new WeakMap;class $ extends u{get(t,e,s){let i=t[f],r=Reflect.get(t,e);return"function"==typeof r&&(r=this.Vt.bind({Wt:e,G:t,st:r.bind(t),qt:i,Et:s})),"size"==e&&l.wt(t[f]),r}Vt(...e){switch(this.Wt){case"clear":return void(l.o(this.qt)&&this.G.size>0&&(this.G.clear(),t.g(this.qt)));case"delete":return void(l.o(this.qt)&&this.G.has(e[0])&&(this.G.delete(e[0]),t.g(this.qt)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":l.wt(this.qt);default:return this.st(...e)}}}class b extends l{constructor(t,e){super(e.tt),this.ht=t}}class p extends u{has(t,e){return l.wt(t[f]),Reflect.has(t,e)}get(t,e,s){return l.wt(t[f]),Reflect.get(t,e,s)}set(e,s,i,r){let n=e[f];if(t.o(n)){return i!==Reflect.get(e,s,r)&&(Reflect.set(e,s,d.Mt(i),r),t.g(n)),!0}return!0}deleteProperty(e,s){let i=e[f];if(t.o(i)){let r=Reflect.deleteProperty(e,s);return r&&t.g(i),r}return!0}}class g extends d{constructor(t){for(let e in t)t[e]=d.Mt(t[e]);super(t,g.Ft)}get Ht(){let t=[];for(let e in this.Rt){let s=this.Rt[e];"object"==typeof s&&t.push(s)}return t}}g.Ft=new p;class m extends d{constructor(t){for(let e of t)t.delete(e),t.add(d.Mt(e));super(t,m.Ft)}get Ht(){let t=[];for(let e of this.Rt)"object"==typeof e&&t.push(e);return t}}m.Ft=new class extends ${Vt(...e){return"add"==this.Wt?(l.o(this.qt)&&!this.G.has(e[0])&&(this.G.add(d.Mt(e[0])),t.g(this.qt)),this.Et):super.Vt.apply(this,e)}};class w extends d{constructor(t){for(let[e,s]of t)t.set(e,d.Mt(s));super(t,w.Ft)}get Ht(){let t=[];for(let[e,s]of this.Rt)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}w.Ft=new class extends ${Vt(...e){return"set"==this.Wt?(l.o(this.qt)&&!this.G.has(e[0])&&(this.G.set(e[0],d.Mt(e[1])),t.g(this.qt)),this.Et):super.Vt.apply(this,e)}};class y extends b{constructor(t,e){super(t,e),this.It=e.st}P(){let e=this.It.apply(this.ht);e!=this.zt&&(this.zt=e,t.g(this))}it(){return this.kt?this.zt=this.It.apply(this.ht):(l.wt(this),this._t()),this.zt}}class v extends b{constructor(t,e){super(t,e),this.Bt=e.m||{},Object.defineProperty(t,e.Z,v.Gt(e.Z)),this.Bt.renderer||this.gt()}static Gt(t){return v.Jt[t]=v.Jt[t]||{get(){return h.get(this).rt(t).it()},set(e){h.get(this).rt(t).Kt(e)}}}static get l(){return v.dt}static Lt(t){if(null!=t&&"object"==typeof t)if(d.Dt(t)){if(!v.Nt.has(t[f])){v.Nt.add(t[f]);for(let e of t[f].Ht)v.Lt(e)}}else if(c.K(t,o))for(let e of h.get(t).ct)v.Nt.has(e)||(v.Nt.add(e),v.Lt(e.Qt))}static $(t){return v.Nt.has(t)}St(){this.Bt.renderer&&super.St()}it(){return this.kt||(l.wt(this),this.Bt.renderer&&this._t()),this.Qt}Kt(e){if(this.kt)this.Qt=e;else if(t.o(this)&&e!=this.Ut){if(this.Bt.validator&&!this.Bt.validator.apply(this.ht,[e]))return i.m.hook.write(this.s);this.Ut=d.Mt(e),this.Bt.renderer?l.P(this):this.g(this.Ut)}}P(){v.dt=!0,v.Lt(this.Ut);let t=this.Bt.renderer.apply(this.ht,[this.Ut]);v.Nt.clear(),v.dt=!1,t!==this.Qt&&this.g(d.Mt(t))}g(e){this.Qt=e,t.g(this)}Ot(){delete this.Ut,delete this.Bt,super.Ot()}}v.Jt={},v.dt=!1,v.Nt=new Set;class j extends b{constructor(t,e){super(t,e),this.Vt=e.st,this.Bt=e.m||{}}get vt(){return!0}it(){if(this.kt)return()=>this.Vt.apply(this.ht);{l.wt(this);let t=!1;if(!O.p){if(this.Bt.lazy)return()=>(this.v(),this.Xt);this.Ct||(t=!0)}return()=>(this._t(t),this.Xt)}}P(){return this.Xt=this.Vt.apply(this.ht),t.g(this),this.Xt}}class S extends d{constructor(t){for(let e in t)t[e]=d.Mt(t[e]);super(t,S.Ft)}get Ht(){let t=[];for(let e of this.Rt)"object"==typeof e&&t.push(e);return this.Rt}}S.Ft=new class extends p{get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&l.wt(t[f]),Reflect.get(t,e,s)}};const x={shrewd:n.N,decorate:null,commit:i.k,construct:i.I,terminate:i.V,hook:{default:e,vue:s},option:i.m};"undefined"!=typeof window&&window.Vue&&(i.m.hook=new s);class O{static R(t){O.Yt.push(O.$t),O.$t=Object.assign({},O.$t,t)}static D(){O.$t=O.Yt.pop()}static get p(){return O.$t.p}static get h(){return O.$t.h}static get B(){return O.$t.B}static get G(){return O.$t.G}}return O.$t={p:!1,h:!1,B:!1,G:null},O.Yt=[],x});
//# sourceMappingURL=shrewd.min.js.map
