/**
 * shrewd v0.0.6
 * (c) 2019-2020 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,(function(){"use strict";class t{constructor(){this.t=new Set,this.s=t.i++}static h(t){return!(!R.o&&t.u)||(R.l&&!R.$(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),i.p.debug,!1):!(!R.l&&R.g)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty."),i.p.debug,!1))}static m(t){i.p.hook.write(t.s);for(let e of t.t)e.v()}_(t){this.t.add(t)}S(t){this.t.delete(t)}get u(){return this.t.size>0}get j(){return this.t.values()}}t.i=0;class e{read(t){return!1}write(t){}gc(){return[]}sub(t){return!1}}class s{constructor(t){if(this.O=new Set,this.R=t||"undefined"!=typeof window&&window.Vue,!this.R)throw new Error("Global Vue not found; you need to pass a Vue constructor to VueHook.");this.C=new this.R({data:{shrewd:{}}})}read(t){let e=this.C.shrewd[t];return e&&e.k.dep.subs.length>0}write(t){i.p.autoCommit?this.R.set(this.C.shrewd,t,{}):this.O.add(t)}precommit(){for(let t of this.O)this.R.set(this.C.shrewd,t,{});this.O.clear()}gc(){let t=[];for(let e in this.C.shrewd)0==this.C.shrewd[e].k.dep.subs.length&&(this.R.delete(this.C.shrewd,e),t.push(Number(e)));return t}sub(t){return t in this.C.shrewd&&this.C.shrewd[t].k.dep.subs.length>0}}class i{static P(){i.p.hook.precommit&&i.p.hook.precommit(),R.A({g:!0});try{for(let t of i.G)l.M(t)}finally{l.D(),i.G.clear(),R.W();for(let t of i.q)t.H();i.q.clear();for(let t of i.p.hook.gc()){let e=l.T.get(t);e&&l.V(e)}}i.p.hook.postcommit&&i.p.hook.postcommit()}static F(t){i.I.add(t)}static K(){if(!i.N){i.N=!0;for(let t of i.I)i.I.delete(t),t.K();i.N=!1}}static B(){i.P(),i.J=!1}static L(t){i.G.delete(t)}static U(t){t.X||i.G.add(t),i.p.autoCommit&&!i.J&&(Promise.resolve().then(i.B),i.J=!0)}static H(t,e=!1){if(o.Y(t,n)){let s=t[n];e?i.q.add(s):s.H()}}}i.p={hook:new e,autoCommit:!0,debug:!0},i.G=new Set,i.q=new Set,i.I=new Set,i.J=!1,i.N=!1;class r{static get(t){if(o.Y(t,C))return t[C];{let e=[];return o.Z(t,C,e),e}}static tt(t,e,s,n){if(void 0===e)return"function"==typeof t?r.et(t):(e,s,i)=>r.tt(e,s,i,t);if("string"==typeof e){let i=s||Object.getOwnPropertyDescriptor(t,e);if(!i)return r.st(x,t,e,void 0,n);if(i.get&&!i.set)return r.st(j,t,e,i,n);if("function"==typeof i.value)return r.st(O,t,e,i,n)}console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. Decorated member must be one of the following: a field, a readonly get accessor, or a method.`),i.p.debug}static et(t){var e=new Proxy(t,r.it);return r.rt.add(e),e}static st(t,e,s,i,n){var h=new t(e,s,i,n);return r.get(e).push(h.nt),h.ht()}}r.rt=new WeakSet,r.it={construct(t,e,s){r.rt.has(s)||console.warn(`Class [${s.name}] is derived form @shrewd class [${t.name}], but it is not decorated with @shrewd.`),R.A({o:!0,g:!1,ot:null}),l.ct.push("construct "+t.name);try{let i=Reflect.construct(t,e,s);return i.constructor==t&&new h(i),i}finally{l.ct.pop(),R.W()}}};const n=Symbol("ShrewdObject");class h{constructor(t){this.ut=!1,this.lt=new Map,this.at=o.Z(t,n,this);let e=Object.getPrototypeOf(this.at);for(;e;){if(o.Y(e,C)){let t=e[C];for(let e of t){let t=new e.ft(this.at,e);this.lt.has(t.dt)||this.lt.set(t.dt,t)}}e=Object.getPrototypeOf(e)}for(let t of this.lt.values())i.F(t)}H(){if(!this.ut){for(let t of this.lt.values())t.H();this.ut=!0}}$t(t){return this.lt.get(t)}get pt(){let t=[];for(let e of this.lt.values())e instanceof y&&t.push(e);return t}}class o{static Y(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static Z(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class c{get(t,e,s){let i=t[a],r=Reflect.get(t,e);return"function"==typeof r&&(r=this.gt.bind({bt:e,ot:t,wt:r.bind(t),yt:i,vt:s})),"size"==e&&l._t(t[a]),r}gt(...e){switch(this.bt){case"clear":return void(l.h(this.yt)&&this.ot.size>0&&(this.ot.clear(),t.m(this.yt)));case"delete":return void(l.h(this.yt)&&this.ot.has(e[0])&&(this.ot.delete(e[0]),t.m(this.yt)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":l._t(this.yt);default:return this.wt(...e)}}}var u;!function(t){t[t.St=0]="$outdated",t[t.jt=1]="$updated",t[t.xt=2]="$pending"}(u||(u={}));class l extends t{constructor(t){super(),this.Ot=new Set,this.Rt=!1,this.Ct=u.St,this.ut=!1,l.T.set(this.s,this),this.kt=t}static D(){for(let t of l.Pt)t.Ct==u.xt&&t.At&&(t.Gt(),l.Pt.delete(t))}static _t(t){if(t instanceof l&&t.ut)return;i.p.hook.read(t.s)&&t instanceof l&&t.Mt();let e=R.ot;e&&e!=t&&!e.ut&&e.Ot.add(t)}static V(t){if(t instanceof l&&!t.ut&&!(t.zt=t.Dt())){let e=new Set(t.Ot);i.L(t);for(let t of e)l.V(t)}}static M(t){R.A({o:!1,ot:t}),t.Rt=!0,i.L(t);try{let e=new Set(t.Ot);t.Wt(),t.qt();try{let e=t.Et();t.Ht(e)}finally{t.Tt()}if(t.Gt(),!t.ut)for(let s of t.Ot)e.delete(s),s._(t),t.At&&s instanceof l&&s.Mt();for(let t of e)l.V(t)}finally{t.Rt=!1,R.W()}}get X(){return this.Rt}v(){this.Vt(),this.Ft(),this.At&&i.U(this)}H(){this.ut||(i.L(this),l.T.delete(this.s),l.Pt.delete(this),this.ut=!0,this.It())}It(){this.Wt();for(let t of this.j)t.Ot.delete(this),this.S(t);this.Gt(),this.Rt=!1}Vt(){if(this.Ct==u.jt){this.Ct=u.xt,l.Pt.add(this);for(let t of this.j)t.Vt()}}Kt(){if(this.Rt&&this.Nt(),this.Ct!=u.jt){l.ct.push(this);try{for(let t of this.Ot)if(t instanceof l){if(t.Rt){l.M(this);break}t.Ct!=u.jt&&t.Kt()}this.Ct==u.St?l.M(this):(l.Pt.delete(this),this.Gt())}finally{l.ct.pop()}}}Nt(){i.p.debug;let t=l.ct.indexOf(this),e=[this,...l.ct.slice(t+1)];e.forEach(t=>t instanceof l&&t.H()),e.push(this);let s=e.map(t=>"string"==typeof t?t:t.kt).join(" => ");console.warn("Cyclic dependency detected: "+s+"\nAll these reactions will be terminated.")}Gt(){this.Ct=u.jt}Ft(){this.Ct=u.St}get Bt(){return this.Ct}get At(){return this.zt=null!=this.zt?this.zt:this.Dt()}Dt(){if(i.p.hook.sub(this.s))return!0;for(let t of this.j)if(t.At)return!0;return!1}Mt(){if(!this.At){this.zt=!0;for(let t of this.Ot)t instanceof l&&t.Mt()}}qt(){}Ht(t){}Tt(){}Wt(){for(let t of this.Ot)t.S(this);this.Ot.clear()}get Jt(){return this.Ot.size>0}get Lt(){return this.ut}}l.Pt=new Set,l.T=new Map,l.ct=[];const a=Symbol("Observable Helper");class f extends t{constructor(t,e){super(),this.Qt=o.Z(t,a,this),this.Ut=new Proxy(t,e),f.Xt.set(t,this.Ut)}static Yt(t){if(null==t||"object"!=typeof t)return t;if(f.Xt.has(t))return f.Xt.get(t);if(!f.Zt(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new v(t).te;break;case Set.prototype:t=new g(t).te;break;case Map.prototype:t=new b(t).te;break;case Object.prototype:t=new p(t).te}return t}static Zt(t){return null!=t&&"object"==typeof t&&o.Y(t,a)}get te(){return this.Ut}}f.Xt=new WeakMap;class d extends l{constructor(t,e){super(e.ee+"."+e.se.toString()),this.ie=e,this.re=Object.assign(this.ne,e.p),this.at=t}get dt(){return this.ie.ee+"."+this.ie.se.toString()}K(){this.Kt()}get ne(){return{}}Dt(){return!!this.re.active||super.Dt()}he(){return this.Lt?this.oe():(l._t(this),this.ce())}}class ${has(t,e){return l._t(t[a]),Reflect.has(t,e)}get(t,e,s){return l._t(t[a]),Reflect.get(t,e,s)}set(e,s,i,r){let n=e[a];if(t.h(n)){return i!==Reflect.get(e,s,r)&&(Reflect.set(e,s,f.Yt(i),r),t.m(n)),!0}return!0}deleteProperty(e,s){let i=e[a];if(t.h(i)){let r=Reflect.deleteProperty(e,s);return r&&t.m(i),r}return!0}}class p extends f{constructor(t){for(let e in t)t[e]=f.Yt(t[e]);super(t,p.ue)}get le(){let t=[];for(let e in this.Qt){let s=this.Qt[e];"object"==typeof s&&t.push(s)}return t}}p.ue=new $;class g extends f{constructor(t){for(let e of t)t.delete(e),t.add(f.Yt(e));super(t,g.ue)}get le(){let t=[];for(let e of this.Qt)"object"==typeof e&&t.push(e);return t}}g.ue=new class extends c{gt(...e){return"add"==this.bt?(l.h(this.yt)&&!this.ot.has(e[0])&&(this.ot.add(f.Yt(e[0])),t.m(this.yt)),this.vt):super.gt.apply(this,e)}};class b extends f{constructor(t){for(let[e,s]of t)t.set(e,f.Yt(s));super(t,b.ue)}get le(){let t=[];for(let[e,s]of this.Qt)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}b.ue=new class extends c{gt(...e){return"set"==this.bt?(l.h(this.yt)&&!this.ot.has(e[0])&&(this.ot.set(e[0],f.Yt(e[1])),t.m(this.yt)),this.vt):super.gt.apply(this,e)}};class w extends d{constructor(t,e){super(t,e),this.ae=e.wt,this.re.active&&this.v()}get Et(){return this.ae.bind(this.at)}Ht(e){e!==this.fe&&(this.fe=e,t.m(this)),this.Jt||this.H()}ce(){return this.Kt(),this.Jt||this.H(),this.fe}oe(){return this.fe}}class y extends d{constructor(t,e){super(t,e),this.de=!1,this.$e=t[e.se],Object.defineProperty(t,e.se,y.pe(e.se)),this.re.renderer||this.Gt()}static pe(t){return y.ge[t]=y.ge[t]||{get(){return this[n].$t(t).he()},set(e){this[n].$t(t).be(e)}}}static we(t){if(null!=t&&"object"==typeof t)if(f.Zt(t)){if(!R.$(t[a])){R.we(t[a]);for(let e of t[a].le)y.we(e)}}else if(o.Y(t,n))for(let e of t[n].pt)R.$(e)||(R.we(e),y.we(e.ye))}get dt(){return this.ie.se.toString()}K(){this.de||(this.re.validator&&!this.re.validator.apply(this.at,[this.$e])&&(this.$e=void 0),this.me(this.$e),this.de=!0)}Ft(){this.re.renderer&&super.Ft()}ce(){return this.de?this.re.renderer&&this.Kt():this.K(),this.ye}oe(){return this.ye}be(e){if(this.Lt)this.ye=e;else if(t.h(this)&&e!==this.$e){if(this.re.validator&&!this.re.validator.apply(this.at,[e]))return i.p.hook.write(this.s);this.me(e)}}me(t){if(this.$e=f.Yt(t),this.re.renderer){this.qt();try{this.Ht(this.Et())}finally{this.Tt()}}else this.m(this.$e)}qt(){R.A({l:!0,ve:new Set}),y.we(this.$e)}get Et(){return this.re.renderer.bind(this.at,this.$e)}Ht(t){t!==this.ye&&this.m(f.Yt(t))}Tt(){R.W()}m(e){this.ye=e,t.m(this)}It(){delete this.$e,delete this.re,super.It()}}y.ge={};class m extends d{constructor(t,e){super(t,e),this.gt=e.wt}get ne(){return{active:!0}}get Et(){return this.gt.bind(this.at)}ce(){return()=>(this.Kt(),this._e)}oe(){return()=>this._e}Ht(e){this._e=e,t.m(this)}}class v extends f{constructor(t){for(let e in t)t[e]=f.Yt(t[e]);super(t,v.ue)}get le(){let t=[];for(let e of this.Qt)"object"==typeof e&&t.push(e);return this.Qt}}var _;v.ue=new class extends ${get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&l._t(t[a]),Reflect.get(t,e,s)}},function(t){t.shrewd=r.tt,t.symbol=n,t.commit=i.P,t.terminate=i.H,t.hook={default:e,vue:s},t.option=i.p}(_||(_={})),"undefined"!=typeof window&&window.Vue&&(i.p.hook=new s);class S{constructor(t,e,s,i){this.Se=t,this.je=e,this.ie=s,this.xe=i}get kt(){return this.Se.constructor.name+"."+this.je.toString()}get nt(){return{se:this.je.toString(),ee:this.Se.constructor.name,ft:this.Oe,wt:this.gt,p:this.xe}}get gt(){}ht(){}}class j extends S{get Oe(){return w}get gt(){return this.ie.get}ht(){let t=this.kt,e=this.gt;return this.ie.get=function(){if(o.Y(this,n)){return this[n].$t(t).he()}return e.apply(this)},this.ie}}class x extends S{get Oe(){return y}}class O extends S{get Oe(){return m}get gt(){return this.ie.value}ht(){let t=this.kt,e=this.gt;return delete this.ie.value,delete this.ie.writable,this.ie.get=function(){if(o.Y(this,n)){return this[n].$t(t).he()}return e.bind(this)},this.ie}}class R{static A(t){R.Re.push(R.Ct),R.Ct=Object.assign({},R.Ct,t)}static W(){R.Ct=R.Re.pop(),0==R.Re.length&&i.K()}static get g(){return R.Ct.g}static get o(){return R.Ct.o}static get l(){return R.Ct.l}static get ot(){return R.Ct.ot}static $(t){return R.Ct.ve.has(t)}static we(t){R.Ct.ve.add(t)}}R.Ct={g:!1,o:!1,l:!1,ot:null,ve:new Set},R.Re=[];const C=Symbol("Shrewd Decorators");return _}));
//# sourceMappingURL=shrewd.min.js.map
