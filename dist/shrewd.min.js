/**
 * shrewd v0.0.0-beta.7
 * (c) 2019 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t extends Error{constructor(t,e,s){super(s),this.class=t.constructor.name,this.prop=e.toString(),this.name=`SetupError at ${this.class}[${this.prop}]`}}class e{static t(){e.s++,e.i=!0;for(let t=0;t<e.o.length;t++)if(e.o[t])for(let s of e.o[t])a.h(s);e.o=[],e.i=!1}static get u(){return e.i?e.s:-1}static get l(){return e.i}static m(){e.t(),e.p=!1}static $(t){let s=t[h];if(e.o[s]=e.o[s]||new Set,e.o[s].add(t),!e.p){Promise.resolve().then(e.m),e.p=!0}}}e.s=0,e.o=[],e.i=!1,e.p=!1;const s=Symbol("Shrewd Decorators");class i{static get(t){if(u.g(t,s))return t[s];{let e=[];return u.S(t,s,e),e}}static v(t,e){if("string"!=typeof e)return(e,s)=>i.j(e,s,t);i.j(t,e)}static j(e,s,r){if(Object.getOwnPropertyDescriptor(e,s))throw new t(e,s,"Decorated property is not a field.");i.get(e).push({key:s,name:e.constructor.name+"."+s.toString(),type:d,validator:r}),Object.defineProperty(e,s,{get(){return n.get(this).O(),this[s]},set(t){n.get(this).O(),this[s]=t}})}static D(e,s,r){if(!r||!r.get)throw new t(e,s,"Decorated property has no getter.");if(r.set)throw new t(e,s,"Decorated property is not readonly.");let o=Symbol(s.toString());return i.get(e).push({key:o,name:e.constructor.name+"."+s.toString(),type:f,method:r.get}),r.get=function(){let t=n.get(this);return t.O(),t.M(o).k()},r}static q(e,s,r){if(!r||"function"!=typeof r.value)throw new t(e,s,"Decorated member is not a method.");let o=Symbol(s.toString());return i.get(e).push({key:o,name:e.constructor.name+"."+s.toString(),type:b,method:r.value}),delete r.value,delete r.writable,r.get=function(){let t=n.get(this);return t.O(),t.M(o).k()},r}}const r=Symbol("ShrewdObject");class n{constructor(t){this.C=!1,this.F=new Map,this.L=t}static get(t){if(u.g(t,r))return t[r];{let e=new n(t);return u.S(t,r,e),e}}M(t){return this.F.get(t)}O(){if(this.C)return;let t=Object.getPrototypeOf(this.L);for(;t;){if(u.g(t,s)){let e=t[s];for(let t of e)this.F.set(t.key,new t.type(this.L,t))}t=Object.getPrototypeOf(t)}this.C=!0}}var o;const h=Symbol("Dependency Level");class c{constructor(){this[o]=0,this.P=new Set}static get W(){return!e.l||(console.warn("Writing into Observables during committing is forbidden; use computed property instead."),!1)}_(t){this.P.add(t)}A(t){this.P.delete(t)}B(){for(let t of this.P)e.$(t)}}o=h;class u{static g(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static S(t,e,s){Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s})}}class a extends c{constructor(){super(...arguments),this.G=new Set}static H(t){a.I&&a.I.G.add(t)}static h(t){let e=a.I;a.I=t;for(let e of t.G)e.A(t);t.G.clear(),t[h]=0;let s=t.h();for(let e of t.G)e._(t),e[h]>=t[h]&&(t[h]=e[h]+1);return a.I=e,s}}a.I=null;class l extends a{constructor(t,e){super(),this.L=t,this.J=e.name}get[Symbol.toStringTag](){return this.J}}class f extends l{constructor(t,e){super(t,e),this.C=!1,this.K=e.method}h(){let t=this.K.apply(this.L);t!=this.N&&(this.N=t,this.B())}k(){return a.H(this),this.C||(a.h(this),this.C=!0),this.N}}class d extends l{constructor(t,e){super(t,e),this.C=!1,this.R=e.validator||d.T,Object.defineProperty(t,e.key,d.interceptor(e.key))}static interceptor(t){return d.U[t]=d.U[t]||{get(){return n.get(this).M(t).k()},set(e){n.get(this).M(t).V(e)}}}O(){a.h(this),this.C=!0}k(){return this.C||this.O(),a.H(this),this.X}V(t){c.W&&t!=this.Y&&(this.Y=t,this.C?this.h():this.O())}h(){let t=this.R.apply(this.L,[this.Y]);t!==this.X&&(this.X=t,this.B())}}d.U={},d.T=t=>t;class b extends l{constructor(t,e){super(t,e),this.s=0,this.Z=e.method}k(){return a.H(this),this.s==e.u?()=>this.tt:()=>a.h(this)}h(){return this.tt=this.Z.apply(this.L),this.s=e.u,this.B(),this.tt}}return{SetupError:t,observable:i.v,computed:i.D,reactive:i.q,commit:e.t}});