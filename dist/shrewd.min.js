/**
 * shrewd v0.0.0-beta.11
 * (c) 2019 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t extends Error{constructor(t,e,s){super(s),this.class=t.constructor.name,this.prop=e.toString(),this.name=`SetupError at ${this.class}[${this.prop}]`}}class e{static t(){e.s=!0;for(let t=0;t<e.i.length;t++)if(e.i[t])for(let s of e.i[t])l.o(s);e.i=[],e.s=!1}static get h(){return e.s}static u(){e.t(),e.l=!1}static p(t){let s=e.i[t[o]];s&&s.delete(t)}static m(t){if(!t.$){let s=t[o];e.i[s]=e.i[s]||new Set,e.i[s].add(t)}if(!e.l){Promise.resolve().then(e.u),e.l=!0}}}e.i=[],e.s=!1,e.l=!1;const s=Symbol("Shrewd Decorators");class r{static get(t){if(u.g(t,s))return t[s];{let e=[];return u.v(t,s,e),e}}static S(t,e){if("string"!=typeof e)return(e,s)=>r.j(e,s,t);r.j(t,e)}static j(e,s,i){if(Object.getOwnPropertyDescriptor(e,s))throw new t(e,s,"Decorated property is not a field.");r.get(e).push({key:s,name:e.constructor.name+"."+s.toString(),type:x,validator:i}),Object.defineProperty(e,s,{get(){return n.get(this).O(),this[s]},set(t){n.get(this).O(),this[s]=t}})}static R(e,s,i){if(!i||!i.get)throw new t(e,s,"Decorated property has no getter.");if(i.set)throw new t(e,s,"Decorated property is not readonly.");let c=Symbol(s.toString());return r.get(e).push({key:c,name:e.constructor.name+"."+s.toString(),type:w,method:i.get}),i.get=function(){let t=n.get(this);return t.O(),t.D(c).k()},i}static _(e,s,i){if(!i||"function"!=typeof i.value)throw new t(e,s,"Decorated member is not a method.");let c=Symbol(s.toString());return r.get(e).push({key:c,name:e.constructor.name+"."+s.toString(),type:v,method:i.value}),delete i.value,delete i.writable,i.get=function(){let t=n.get(this);return t.O(),t.D(c).k()},i}}const i=Symbol("ShrewdObject");class n{constructor(t){this.M=!1,this.P=new Map,this.q=t}static get(t){if(u.g(t,i))return t[i];{let e=new n(t);return u.v(t,i,e),e}}D(t){return this.P.get(t)}O(){if(this.M)return;let t=Object.getPrototypeOf(this.q);for(;t;){if(u.g(t,s)){let e=t[s];for(let t of e)this.P.set(t.key,new t.type(this.q,t))}t=Object.getPrototypeOf(t)}this.M=!0}}var c;const o=Symbol("Dependency Level");class h{constructor(){this[c]=0,this.F=new Set}static W(t,e,s,r){"object"==typeof t&&u.g(t,d)&&(h.A=t[d]);let i=s.apply(r,[t,e]);return h.A=null,i}static C(t){return!e.h||h.A==t||(null!=h.A?console.warn("For safety reasons, during validation only the value itself can be modified, not including descendant Observables."):console.warn("Writing into Observables during committing is forbidden; use computed property instead."),!1)}static H(t){for(let e of t.F)e.L()}B(t){this.F.add(t)}G(t){this.F.delete(t)}get I(){return this.F.size>0}}c=o,h.A=null;class u{static g(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static v(t,e,s){Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s})}}class a{isExtensible(t){return!1}}class l extends h{constructor(){super(...arguments),this.J=new Set,this.K=!1,this.N=!1}static T(t){l.U&&l.U!=t&&l.U.T(t)}static o(t){let s,r=l.U;l.U=t,t.K=!0,e.h||e.p(t);for(let e of t.J)e.G(t);t.J.clear(),t[o]=0,t.V&&(s=t.o(),t.N=!0);for(let e of t.J)t[o]<=e[o]&&(t[o]=e[o]+1);return t.K=!1,l.U=r,s}L(){this.N=!1,e.m(this)}get X(){return this.N}get $(){return this.K}get V(){return!0}T(t){this.J.has(t)||(this.J.add(t),t.B(this))}}l.U=null;const d=Symbol("Observable Helper");class f extends h{constructor(t,e){super(),u.v(t,d,this),this.Y=new Proxy(t,e)}static Z(t){if("object"==typeof t&&!u.g(t,d))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new S(t).tt;break;case Set.prototype:t=new $(t).tt;break;case Map.prototype:t=new g(t).tt;break;case Object.prototype:t=new y(t).tt}return t}get tt(){return this.Y}}class b extends a{get(t,e,s){let r=t[d],i=Reflect.get(t,e);return"function"==typeof i&&(i=this.et.bind({prop:e,target:t,method:i.bind(t),helper:r,receiver:s})),"size"==e&&l.T(t[d]),i}et(...t){switch(this.prop){case"clear":return void(l.C(this.helper)&&this.target.size>0&&(this.target.clear(),h.H(this.helper)));case"delete":return void(l.C(this.helper)&&this.target.has(t[0])&&(this.target.delete(t[0]),h.H(this.helper)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":l.T(this.helper);default:return this.method(...t)}}}class p extends l{constructor(t,e){super(),this.q=t,this.st=e.name}get[Symbol.toStringTag](){return this.st}}class m extends a{has(t,e){return l.T(t[d]),Reflect.has(t,e)}get(t,e,s){return l.T(t[d]),Reflect.get(t,e,s)}set(t,e,s,r){let i=t[d];if(h.C(i)){return s!==Reflect.get(t,e,r)&&(Reflect.set(t,e,f.Z(s),r),h.H(i)),!0}return!0}deleteProperty(t,e){let s=t[d];if(h.C(s)){let r=Reflect.deleteProperty(t,e);return r&&h.H(s),r}return!0}}class y extends f{constructor(t){super(t,y.rt)}}y.rt=new m;class $ extends f{constructor(t){super(t,$.rt)}}$.rt=new class extends b{et(...t){return"add"==this.prop?(l.C(this.helper)&&!this.target.has(t[0])&&(this.target.add(f.Z(t[0])),h.H(this.helper)),this.receiver):super.et.apply(this,t)}};class g extends f{constructor(t){super(t,g.rt)}}g.rt=new class extends b{et(...t){return"set"==this.prop?(l.C(this.helper)&&!this.target.has(t[0])&&(this.target.set(t[0],f.Z(t[1])),h.H(this.helper)),this.receiver):super.et.apply(this,t)}};class w extends p{constructor(t,e){super(t,e),this.it=e.method}T(t){this.I&&super.T(t)}get V(){return!e.h||this.I}o(){let t=this.it.apply(this.q);t!=this.nt&&(this.nt=t,h.H(this))}k(){return l.T(this),this.X&&e.h||l.o(this),this.nt}}class x extends p{constructor(t,e){super(t,e),this.ct=e.validator||x.ot,Object.defineProperty(t,e.key,x.interceptor(e.key))}static interceptor(t){return x.ht[t]=x.ht[t]||{get(){return n.get(this).D(t).k()},set(e){n.get(this).D(t).ut(e)}}}k(){return l.T(this),this.X||l.o(this),this.at}ut(t){h.C(this)&&t!=this.lt&&(this.lt=f.Z(t),l.o(this))}o(){let t=h.W(this.lt,this.at,this.ct,this.q);t!==this.at&&(this.at=f.Z(t),h.H(this))}}x.ht={},x.ot=t=>t;class v extends p{constructor(t,e){super(t,e),this.et=e.method}k(){return l.T(this),e.h&&this.X?()=>this.dt:()=>l.o(this)}o(){return this.dt=this.et.apply(this.q),h.H(this),this.dt}}class S extends f{constructor(t){super(t,S.rt)}}return S.rt=new class extends m{get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&l.T(t[d]),Reflect.get(t,e,s)}},{SetupError:t,observable:r.S,computed:r.R,reactive:r._,commit:e.t}});