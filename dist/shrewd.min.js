/**
 * shrewd v0.0.5
 * (c) 2019-2020 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,(function(){"use strict";class t{constructor(){this.t=new Set,this.s=t.i++}static h(t){return!(!R.o&&t.u)||(R.l&&!R.$(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),i.p.debug,!1):!(!R.l&&R.g)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty."),i.p.debug,!1))}static m(t){i.p.hook.write(t.s);for(let e of t.t)e._()}v(t){this.t.add(t)}S(t){this.t.delete(t)}get u(){return this.t.size>0}get j(){return this.t.values()}}t.i=0;class e{read(t){return!1}write(t){}gc(){return[]}sub(t){return!1}}class s{constructor(t){if(this.O=t||Vue,!this.O)throw new Error("Global Vue not found; you need to pass a Vue constructor to VueHook.");this.R=new this.O({data:{shrewd:{}}})}read(t){let e=this.R.shrewd[t];return e&&e.C.dep.subs.length>0}write(t){this.O.set(this.R.shrewd,t,{})}gc(){let t=[];for(let e in this.R.shrewd)0==this.R.shrewd[e].C.dep.subs.length&&(this.O.delete(this.R.shrewd,e),t.push(Number(e)));return t}sub(t){return t in this.R.shrewd&&this.R.shrewd[t].C.dep.subs.length>0}}class i{static k(){R.P({g:!0});try{for(let t of i.A)l.G(t)}finally{l.M(),i.A.clear(),R.D();for(let t of i.V)t.W();i.V.clear();for(let t of i.p.hook.gc()){let e=l.q.get(t);e&&l.H(e)}}}static T(t){i.F.add(t)}static I(){if(!i.K){i.K=!0;for(let t of i.F)i.F.delete(t),t.I();i.K=!1}}static N(){i.k(),i.B=!1}static J(t){i.A.delete(t)}static L(t){if(t.U||i.A.add(t),i.p.autoCommit&&!i.B){Promise.resolve().then(i.N),i.B=!0}}static W(t,e=!1){if(o.X(t,n)){let s=t[n];e?i.V.add(s):s.W()}}}i.p={hook:new e,autoCommit:!0,debug:!0},i.A=new Set,i.V=new Set,i.F=new Set,i.B=!1,i.K=!1;class r{static get(t){if(o.X(t,C))return t[C];{let e=[];return o.Y(t,C,e),e}}static Z(t,e,s,n){if(void 0===e)return"function"==typeof t?r.tt(t):(e,s,i)=>r.Z(e,s,i,t);if("string"==typeof e){let i=s||Object.getOwnPropertyDescriptor(t,e);if(!i)return r.et(x,t,e,void 0,n);if(i.get&&!i.set)return r.et(j,t,e,i,n);if("function"==typeof i.value)return r.et(O,t,e,i,n)}console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. Decorated member must be one of the following: a field, a readonly get accessor, or a method.`),i.p.debug}static tt(t){var e=new Proxy(t,r.st);return r.it.add(e),e}static et(t,e,s,i,n){var h=new t(e,s,i,n);return r.get(e).push(h.rt),h.nt()}}r.it=new WeakSet,r.st={construct(t,e,s){r.it.has(s)||console.warn(`Class [${s.name}] is derived form @shrewd class [${t.name}], but it is not decorated with @shrewd.`),R.P({o:!0,g:!1,ht:null}),l.ot.push("construct "+t.name);try{let i=Reflect.construct(t,e,s);return i.constructor==t&&new h(i),i}finally{l.ot.pop(),R.D()}}};const n=Symbol("ShrewdObject");class h{constructor(t){this.ct=!1,this.ut=new Map,this.lt=o.Y(t,n,this);let e=Object.getPrototypeOf(this.lt);for(;e;){if(o.X(e,C)){let t=e[C];for(let e of t){let t=new e.at(this.lt,e);this.ut.set(t.ft,t)}}e=Object.getPrototypeOf(e)}for(let t of this.ut.values())i.T(t)}W(){if(!this.ct){for(let t of this.ut.values())t.W();this.ct=!0}}dt(t){return this.ut.get(t)}get $t(){let t=[];for(let e of this.ut.values())e instanceof m&&t.push(e);return t}}class o{static X(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static Y(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class c{get(t,e,s){let i=t[a],r=Reflect.get(t,e);return"function"==typeof r&&(r=this.pt.bind({bt:e,ht:t,gt:r.bind(t),yt:i,wt:s})),"size"==e&&l._t(t[a]),r}pt(...e){switch(this.bt){case"clear":return void(l.h(this.yt)&&this.ht.size>0&&(this.ht.clear(),t.m(this.yt)));case"delete":return void(l.h(this.yt)&&this.ht.has(e[0])&&(this.ht.delete(e[0]),t.m(this.yt)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":l._t(this.yt);default:return this.gt(...e)}}}var u;!function(t){t[t.vt=0]="$outdated",t[t.St=1]="$updated",t[t.jt=2]="$pending"}(u||(u={}));class l extends t{constructor(t){super(),this.xt=new Set,this.Ot=!1,this.Rt=u.vt,this.ct=!1,l.q.set(this.s,this),this.Ct=t}static M(){for(let t of l.kt)t.Rt==u.jt&&t.Pt&&(t.At(),l.kt.delete(t))}static _t(t){if(t instanceof l&&t.ct)return;i.p.hook.read(t.s)&&t instanceof l&&t.Gt();let e=R.ht;e&&e!=t&&!e.ct&&e.xt.add(t)}static H(t){if(t instanceof l&&!t.ct&&!(t.Mt=t.zt())){let e=new Set(t.xt);i.J(t);for(let t of e)l.H(t)}}static G(t){R.P({o:!1,ht:t}),t.Ot=!0,i.J(t);try{let e=new Set(t.xt);t.Dt();let s=t.G();if(t.At(),!t.ct)for(let s of t.xt)e.delete(s),s.v(t),t.Pt&&s instanceof l&&s.Gt();for(let t of e)l.H(t);return s}finally{t.Ot=!1,R.D()}}get U(){return this.Ot}_(){this.Vt(),this.Wt(),this.Pt&&i.L(this)}W(){this.ct||(i.J(this),l.q.delete(this.s),l.kt.delete(this),this.ct=!0,this.qt())}qt(){this.Dt();for(let t of this.j)t.xt.delete(this),this.S(t);this.At(),this.Ot=!1}Vt(){if(this.Rt==u.St){this.Rt=u.jt,l.kt.add(this);for(let t of this.j)t.Vt()}}Et(t=!1){if(this.Ot&&this.Ht(),this.Rt!=u.St){l.ot.push(this);try{for(let t of this.xt)if(t instanceof l){if(t.Ot){l.G(this);break}t.Rt!=u.St&&t.Et()}this.Rt==u.vt||t?l.G(this):(l.kt.delete(this),this.At())}finally{l.ot.pop()}}}Ht(){i.p.debug;let t=l.ot.indexOf(this),e=[this,...l.ot.slice(t+1)];e.forEach(t=>t instanceof l&&t.W()),e.push(this);let s=e.map(t=>"string"==typeof t?t:t.Ct).join(" => ");console.warn("Cyclic dependency detected: "+s+"\nAll these reactions will be terminated.")}At(){this.Rt=u.St}Wt(){this.Rt=u.vt}get Tt(){return this.Rt}get Pt(){return this.Mt=null!=this.Mt?this.Mt:this.zt()}zt(){if(i.p.hook.sub(this.s))return!0;for(let t of this.j)if(t.Pt)return!0;return!1}Gt(){if(!this.Pt){this.Mt=!0;for(let t of this.xt)t instanceof l&&t.Gt()}}Dt(){for(let t of this.xt)t.S(this);this.xt.clear()}get Ft(){return this.xt.size>0}get It(){return this.ct}}l.kt=new Set,l.q=new Map,l.ot=[];const a=Symbol("Observable Helper");class f extends t{constructor(t,e){super(),this.Kt=o.Y(t,a,this),this.Nt=new Proxy(t,e),f.Bt.set(t,this.Nt)}static Jt(t){if(null==t||"object"!=typeof t)return t;if(f.Bt.has(t))return f.Bt.get(t);if(!f.Lt(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new _(t).Qt;break;case Set.prototype:t=new b(t).Qt;break;case Map.prototype:t=new g(t).Qt;break;case Object.prototype:t=new p(t).Qt}return t}static Lt(t){return null!=t&&"object"==typeof t&&o.X(t,a)}get Qt(){return this.Nt}}f.Bt=new WeakMap;class d extends l{constructor(t,e){super(e.Ut+"."+e.Xt.toString()),this.Yt=e,this.Zt=Object.assign(this.te,e.p),this.lt=t}get ft(){return this.Yt.Ut+"."+this.Yt.Xt.toString()}I(){this.Et()}get te(){return{}}zt(){return!!this.Zt.active||super.zt()}ee(){return this.It?this.se():(l._t(this),this.ie())}}class ${has(t,e){return l._t(t[a]),Reflect.has(t,e)}get(t,e,s){return l._t(t[a]),Reflect.get(t,e,s)}set(e,s,i,r){let n=e[a];if(t.h(n)){return i!==Reflect.get(e,s,r)&&(Reflect.set(e,s,f.Jt(i),r),t.m(n)),!0}return!0}deleteProperty(e,s){let i=e[a];if(t.h(i)){let r=Reflect.deleteProperty(e,s);return r&&t.m(i),r}return!0}}class p extends f{constructor(t){for(let e in t)t[e]=f.Jt(t[e]);super(t,p.re)}get ne(){let t=[];for(let e in this.Kt){let s=this.Kt[e];"object"==typeof s&&t.push(s)}return t}}p.re=new $;class b extends f{constructor(t){for(let e of t)t.delete(e),t.add(f.Jt(e));super(t,b.re)}get ne(){let t=[];for(let e of this.Kt)"object"==typeof e&&t.push(e);return t}}b.re=new class extends c{pt(...e){return"add"==this.bt?(l.h(this.yt)&&!this.ht.has(e[0])&&(this.ht.add(f.Jt(e[0])),t.m(this.yt)),this.wt):super.pt.apply(this,e)}};class g extends f{constructor(t){for(let[e,s]of t)t.set(e,f.Jt(s));super(t,g.re)}get ne(){let t=[];for(let[e,s]of this.Kt)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}g.re=new class extends c{pt(...e){return"set"==this.bt?(l.h(this.yt)&&!this.ht.has(e[0])&&(this.ht.set(e[0],f.Jt(e[1])),t.m(this.yt)),this.wt):super.pt.apply(this,e)}};class y extends d{constructor(t,e){super(t,e),this.he=e.gt,this.Zt.active&&this._()}G(){let e=this.he.apply(this.lt);e!==this.oe&&(this.oe=e,t.m(this)),this.Ft||this.W()}ie(){return this.Et(),this.Ft||this.W(),this.oe}se(){return this.oe}}class m extends d{constructor(t,e){super(t,e),this.ce=!1,this.ue=t[e.Xt],Object.defineProperty(t,e.Xt,m.le(e.Xt)),this.Zt.renderer||this.At()}static le(t){return m.ae[t]=m.ae[t]||{get(){return this[n].dt(t).ee()},set(e){this[n].dt(t).fe(e)}}}static de(t){if(null!=t&&"object"==typeof t)if(f.Lt(t)){if(!R.$(t[a])){R.de(t[a]);for(let e of t[a].ne)m.de(e)}}else if(o.X(t,n))for(let e of t[n].$t)R.$(e)||(R.de(e),m.de(e.$e))}get ft(){return this.Yt.Xt.toString()}I(){this.ce||(this.Zt.validator&&!this.Zt.validator.apply(this.lt,[this.ue])&&(this.ue=void 0),this.pe(this.ue),this.ce=!0)}Wt(){this.Zt.renderer&&super.Wt()}ie(){return this.ce?this.Zt.renderer&&this.Et():this.I(),this.$e}se(){return this.$e}fe(e){if(this.It)this.$e=e;else if(t.h(this)&&e!==this.ue){if(this.Zt.validator&&!this.Zt.validator.apply(this.lt,[e]))return i.p.hook.write(this.s);this.pe(e)}}pe(t){this.ue=f.Jt(t),this.Zt.renderer?this.G():this.m(this.ue)}G(){R.P({l:!0,be:new Set});try{m.de(this.ue);let t=this.Zt.renderer.apply(this.lt,[this.ue]);t!==this.$e&&this.m(f.Jt(t))}finally{R.D()}}m(e){this.$e=e,t.m(this)}qt(){delete this.ue,delete this.Zt,super.qt()}}m.ae={};class w extends d{constructor(t,e){super(t,e),this.pt=e.gt}get te(){return{active:!0}}ie(){return()=>(this.Et(),this.ge)}se(){return()=>this.ge}G(){return this.ge=this.pt.apply(this.lt),t.m(this),this.ge}}class _ extends f{constructor(t){for(let e in t)t[e]=f.Jt(t[e]);super(t,_.re)}get ne(){let t=[];for(let e of this.Kt)"object"==typeof e&&t.push(e);return this.Kt}}_.re=new class extends ${get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&l._t(t[a]),Reflect.get(t,e,s)}};const v={shrewd:r.Z,symbol:n,commit:i.k,terminate:i.W,hook:{default:e,vue:s},option:i.p};"undefined"!=typeof window&&window.Vue&&(i.p.hook=new s);class S{constructor(t,e,s,i){this.ye=t,this.me=e,this.Yt=s,this.we=i}get Ct(){return this.ye.constructor.name+"."+this.me.toString()}get rt(){return{Xt:this.me.toString(),Ut:this.ye.constructor.name,at:this._e,gt:this.pt,p:this.we}}get pt(){}nt(){}}class j extends S{get _e(){return y}get pt(){return this.Yt.get}nt(){let t=this.Ct,e=this.pt;return this.Yt.get=function(){if(o.X(this,n)){return this[n].dt(t).ee()}return e.apply(this)},this.Yt}}class x extends S{get _e(){return m}}class O extends S{get _e(){return w}get pt(){return this.Yt.value}nt(){let t=this.Ct,e=this.pt;return delete this.Yt.value,delete this.Yt.writable,this.Yt.get=function(){if(o.X(this,n)){return this[n].dt(t).ee()}return e.bind(this)},this.Yt}}class R{static P(t){R.ve.push(R.Rt),R.Rt=Object.assign({},R.Rt,t)}static D(){R.Rt=R.ve.pop(),0==R.ve.length&&i.I()}static get g(){return R.Rt.g}static get o(){return R.Rt.o}static get l(){return R.Rt.l}static get ht(){return R.Rt.ht}static $(t){return R.Rt.be.has(t)}static de(t){R.Rt.be.add(t)}}R.Rt={g:!1,o:!1,l:!1,ht:null,be:new Set},R.ve=[];const C=Symbol("Shrewd Decorators");return v}));
//# sourceMappingURL=shrewd.min.js.map
