/**
 * shrewd v0.0.3
 * (c) 2019-2020 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Shrewd=t()}(this,function(){"use strict";class Observable{constructor(){this.t=new Set,this.s=Observable.i++}static o(e){return!(!Global.l&&e.h)||(Global.u&&!Global.p(e)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),Core.$.debug,!1):!(!Global.u&&Global.v)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty. For constructing new Shrewd objects, use Shrewd.construct() method."),Core.$.debug,!1))}static O(e){Core.$.hook.write(e.s);for(let t of e.t)t.H()}g(e){this.t.add(e)}m(e){this.t.delete(e)}get h(){return this.t.size>0}get C(){return this.t.values()}}Observable.i=0;class DefaultHook{read(e){}write(e){}gc(){}sub(e){return!1}}class VueHook{constructor(){this.P=new Vue({data:{shrewd:{}}})}read(e){this.P.shrewd[e]}write(e){Vue.set(this.P.shrewd,e,{})}gc(){for(let e in this.P.shrewd)0==this.P.shrewd[e].S.dep.subs.length&&Vue.delete(this.P.shrewd,e)}sub(e){return e in this.P.shrewd&&this.P.shrewd[e].S.dep.subs.length>0}}class Core{static j(){Global.G({v:!0});try{for(let e of Core.D)Observer.A(e)}finally{Observer._(),Core.D.clear(),Global.M();for(let e of Core.k)e.R();Core.k.clear(),Core.$.hook.gc()}}static V(e){Core.q.add(e)}static F(){if(!Core.T){Core.T=!0;for(let e of Core.q)Core.q.delete(e),e.F();Core.T=!1}}static W(){Core.j(),Core.I=!1}static K(e){Core.D.delete(e)}static B(e){if(e.J||Core.D.add(e),Core.$.autoCommit&&!Core.I){Promise.resolve().then(Core.W),Core.I=!0}}static R(e,t=!1){if(HiddenProperty.L(e,$shrewdObject)){let r=e[$shrewdObject];t?Core.k.add(r):r.R()}}}Core.$={hook:new DefaultHook,autoCommit:!0,debug:!0},Core.D=new Set,Core.k=new Set,Core.q=new Set,Core.I=!1,Core.T=!1;class Decorators{static get(e){if(HiddenProperty.L(e,$shrewdDecorators))return e[$shrewdDecorators];{let t=[];return HiddenProperty.N(e,$shrewdDecorators,t),t}}static U(e,t,r,s){if(void 0===t)return"function"==typeof e?Decorators.X(e):(t,r,s)=>Decorators.U(t,r,s,e);if("string"==typeof t){let i=r||Object.getOwnPropertyDescriptor(e,t);if(!i)return Decorators.Y(ObservablePropertyAdapter,e,t,void 0,s);if(i.get&&!i.set)return Decorators.Y(ComputedPropertyAdapter,e,t,i,s);if("function"==typeof i.value)return Decorators.Y(ReactiveMethodAdapter,e,t,i,s)}console.warn(`Setup error at ${e.constructor.name}[${t.toString()}]. `+"Decorated member must be one of the following: a field, a readonly get accessor, or a method."),Core.$.debug}static X(ctor){let result,name=ctor.name,start=()=>{Global.G({l:!0,v:!1,Z:null}),Observer.ee.push(`construct ${name}`)},finish=()=>{Observer.ee.pop(),Global.M()};return eval(`result=class ${name} extends ctor{constructor(...a){start();try{super(...a);if(this.constructor==result)new ShrewdObject(this);}finally{finish();}}}`),result}static Y(e,t,r,s,i){var o=new e(t,r,s,i);return Decorators.get(t).push(o.te),o.re()}}const $shrewdObject=Symbol("ShrewdObject");class ShrewdObject{constructor(e){this.se=!1,this.ie=new Map,this.oe=HiddenProperty.N(e,$shrewdObject,this);let t=Object.getPrototypeOf(this.oe);for(;t;){if(HiddenProperty.L(t,$shrewdDecorators)){let e=t[$shrewdDecorators];for(let t of e){let e=new t.le(this.oe,t);this.ie.set(e.ne,e)}}t=Object.getPrototypeOf(t)}for(let e of this.ie.values())Core.V(e)}R(){if(!this.se){for(let e of this.ie.values())e.R();this.se=!0}}ae(e){return this.ie.get(e)}get he(){let e=[];for(let t of this.ie.values())t instanceof ObservableProperty&&e.push(t);return e}}class HiddenProperty{static L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}static N(e,t,r){return Object.defineProperty(e,t,{enumerable:!1,writable:!1,configurable:!1,value:r}),e}}class CollectionProxyHandler{get(e,t,r){let s=e[$observableHelper],i=Reflect.get(e,t);return"function"==typeof i&&(i=this.ce.bind({be:t,Z:e,ue:i.bind(e),de:s,pe:r})),"size"==t&&Observer.fe(e[$observableHelper]),i}ce(...e){switch(this.be){case"clear":return void(Observer.o(this.de)&&this.Z.size>0&&(this.Z.clear(),Observable.O(this.de)));case"delete":return void(Observer.o(this.de)&&this.Z.has(e[0])&&(this.Z.delete(e[0]),Observable.O(this.de)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":Observer.fe(this.de);default:return this.ue(...e)}}}var ObserverState;!function(e){e[e.$e=0]="$outdated",e[e.ve=1]="$updated",e[e.Oe=2]="$pending"}(ObserverState||(ObserverState={}));class Observer extends Observable{constructor(e){super(),this.ye=new Set,this.He=!1,this.we=ObserverState.$e,this.se=!1,this.ge=e}static _(){for(let e of Observer.me)e.we==ObserverState.Oe&&e.Ce&&(e.Pe(),Observer.me.delete(e))}static fe(e){if(e instanceof Observer&&e.se)return;Core.$.hook.read(e.s);let t=Global.Z;t&&t!=e&&!t.se&&t.ye.add(e)}static Se(e){if(e instanceof Observer&&!e.se&&(e.je=e.checkActive(),!e.Ce)){let t=new Set(e.ye);Core.K(e);for(let e of t)Observer.Se(e)}}static A(e){Global.G({l:!1,Z:e}),e.He=!0,Core.K(e);try{let t=new Set(e.ye);e.Ge();let r=e.A();if(e.Pe(),!e.se)for(let r of e.ye)t.delete(r),r.g(e),e.Ce&&r instanceof Observer&&r.activate();for(let e of t)Observer.Se(e);return r}finally{e.He=!1,Global.M()}}get J(){return this.He}H(){this.xe(),this.De(),this.Ce&&Core.B(this)}R(){this.se||(Core.K(this),Observer.me.delete(this),this.se=!0,this.Ae())}Ae(){this.Ge();for(let e of this.C)e.ye.delete(this),this.m(e);this.Pe(),this.He=!1}xe(){if(this.we==ObserverState.ve){this.we=ObserverState.Oe,Observer.me.add(this);for(let e of this.C)e.xe()}}_e(e=!1){if(this.He&&this.Me(),this.we!=ObserverState.ve){Observer.ee.push(this);try{for(let e of this.ye)if(e instanceof Observer){if(e.He){Observer.A(this);break}e.we!=ObserverState.ve&&e._e()}this.we==ObserverState.$e||e?Observer.A(this):(Observer.me.delete(this),this.Pe())}finally{Observer.ee.pop()}}}Me(){Core.$.debug;let e=Observer.ee.indexOf(this),t=[this,...Observer.ee.slice(e+1)];t.forEach(e=>e instanceof Observer&&e.R()),t.push(this);let r=t.map(e=>"string"==typeof e?e:e.ge).join(" => ");console.warn("Cyclic dependency detected: "+r+"\nAll these reactions will be terminated.")}Pe(){this.we=ObserverState.ve}De(){this.we=ObserverState.$e}get ke(){return this.we}get Ce(){return this.je=null!=this.je?this.je:this.checkActive()}checkActive(){if(Core.$.hook.sub(this.s))return!0;for(let e of this.C)if(e.Ce)return!0;return!1}activate(){if(!this.Ce){this.je=!0;for(let e of this.ye)e instanceof Observer&&e.activate()}}Ge(){for(let e of this.ye)e.m(this);this.ye.clear()}get Re(){return this.se}}Observer.me=new Set,Observer.ee=[];const $observableHelper=Symbol("Observable Helper");class Helper extends Observable{constructor(e,t){super(),this.Ve=HiddenProperty.N(e,$observableHelper,this),this.ze=new Proxy(e,t),Helper.qe.set(e,this.ze)}static Fe(e){if(null==e||"object"!=typeof e)return e;if(Helper.qe.has(e))return Helper.qe.get(e);if(!Helper.Te(e))switch(Object.getPrototypeOf(e)){case Array.prototype:e=new ArrayHelper(e).We;break;case Set.prototype:e=new SetHelper(e).We;break;case Map.prototype:e=new MapHelper(e).We;break;case Object.prototype:e=new ObjectHelper(e).We}return e}static Te(e){return null!=e&&"object"==typeof e&&HiddenProperty.L(e,$observableHelper)}get We(){return this.ze}}Helper.qe=new WeakMap;class DecoratedMemeber extends Observer{constructor(e,t){super(t.Ee+"."+t.Ie.toString()),this.Ke=t,this.Be=Object.assign(this.Je,t.$),this.oe=e}get ne(){return this.Ke.Ee+"."+this.Ke.Ie.toString()}F(){this._e()}get Je(){return{}}checkActive(){return!!this.Be.active||super.checkActive()}Le(){return this.Re?this.Ne():(Observer.fe(this),this.Qe())}}class ObjectProxyHandler{has(e,t){return Observer.fe(e[$observableHelper]),Reflect.has(e,t)}get(e,t,r){return Observer.fe(e[$observableHelper]),Reflect.get(e,t,r)}set(e,t,r,s){let i=e[$observableHelper];if(Observable.o(i)){return r!==Reflect.get(e,t,s)&&(Reflect.set(e,t,Helper.Fe(r),s),Observable.O(i)),!0}return!0}deleteProperty(e,t){let r=e[$observableHelper];if(Observable.o(r)){let s=Reflect.deleteProperty(e,t);return s&&Observable.O(r),s}return!0}}class ObjectHelper extends Helper{constructor(e){for(let t in e)e[t]=Helper.Fe(e[t]);super(e,ObjectHelper.Ue)}get Xe(){let e=[];for(let t in this.Ve){let r=this.Ve[t];"object"==typeof r&&e.push(r)}return e}}ObjectHelper.Ue=new ObjectProxyHandler;class SetProxyHandler extends CollectionProxyHandler{ce(...e){return"add"==this.be?(Observer.o(this.de)&&!this.Z.has(e[0])&&(this.Z.add(Helper.Fe(e[0])),Observable.O(this.de)),this.pe):super.ce.apply(this,e)}}class SetHelper extends Helper{constructor(e){for(let t of e)e.delete(t),e.add(Helper.Fe(t));super(e,SetHelper.Ue)}get Xe(){let e=[];for(let t of this.Ve)"object"==typeof t&&e.push(t);return e}}SetHelper.Ue=new SetProxyHandler;class MapProxyHandler extends CollectionProxyHandler{ce(...e){return"set"==this.be?(Observer.o(this.de)&&!this.Z.has(e[0])&&(this.Z.set(e[0],Helper.Fe(e[1])),Observable.O(this.de)),this.pe):super.ce.apply(this,e)}}class MapHelper extends Helper{constructor(e){for(let[t,r]of e)e.set(t,Helper.Fe(r));super(e,MapHelper.Ue)}get Xe(){let e=[];for(let[t,r]of this.Ve)"object"==typeof t&&e.push(t),"object"==typeof r&&e.push(r);return e}}MapHelper.Ue=new MapProxyHandler;class ComputedProperty extends DecoratedMemeber{constructor(e,t){super(e,t),this.Ye=t.ue,this.Be.active&&this.H()}A(){let e=this.Ye.apply(this.oe);e!==this.Ze&&(this.Ze=e,Observable.O(this))}Qe(){return this._e(),this.Ze}Ne(){return this.Ze}}class ObservableProperty extends DecoratedMemeber{constructor(e,t){super(e,t),this.et=!1,this.tt=e[t.Ie],Object.defineProperty(e,t.Ie,ObservableProperty.rt(t.Ie)),this.Be.renderer||this.Pe()}static rt(e){return ObservableProperty.st[e]=ObservableProperty.st[e]||{get(){return this[$shrewdObject].ae(e).Le()},set(t){this[$shrewdObject].ae(e).it(t)}}}static ot(e){if(null!=e&&"object"==typeof e)if(Helper.Te(e)){if(!Global.p(e[$observableHelper])){Global.ot(e[$observableHelper]);for(let t of e[$observableHelper].Xe)ObservableProperty.ot(t)}}else if(HiddenProperty.L(e,$shrewdObject))for(let t of e[$shrewdObject].he)Global.p(t)||(Global.ot(t),ObservableProperty.ot(t.lt))}get ne(){return this.Ke.Ie.toString()}F(){this.et||(this.Be.validator&&!this.Be.validator.apply(this.oe,[this.tt])&&(this.tt=void 0),this.nt(this.tt),this.et=!0)}De(){this.Be.renderer&&super.De()}Qe(){return this.et?this.Be.renderer&&this._e():this.F(),this.lt}Ne(){return this.lt}it(e){if(this.Re)this.lt=e;else if(Observable.o(this)&&e!==this.tt){if(this.Be.validator&&!this.Be.validator.apply(this.oe,[e]))return Core.$.hook.write(this.s);this.nt(e)}}nt(e){this.tt=Helper.Fe(e),this.Be.renderer?this.A():this.O(this.tt)}A(){Global.G({u:!0,at:new Set});try{ObservableProperty.ot(this.tt);let e=this.Be.renderer.apply(this.oe,[this.tt]);e!==this.lt&&this.O(Helper.Fe(e))}finally{Global.M()}}O(e){this.lt=e,Observable.O(this)}Ae(){delete this.tt,delete this.Be,super.Ae()}}ObservableProperty.st={};class ReactiveMethod extends DecoratedMemeber{constructor(e,t){super(e,t),this.ce=t.ue}get Je(){return{active:!0}}Qe(){return()=>(this._e(),this.ht)}Ne(){return()=>this.ht}A(){return this.ht=this.ce.apply(this.oe),Observable.O(this),this.ht}}class ArrayProxyHandler extends ObjectProxyHandler{get(e,t,r){return("length"==t||"symbol"==typeof t||"number"==typeof t||"string"==typeof t&&t.match(/^\d+$/))&&Observer.fe(e[$observableHelper]),Reflect.get(e,t,r)}}class ArrayHelper extends Helper{constructor(e){for(let t in e)e[t]=Helper.Fe(e[t]);super(e,ArrayHelper.Ue)}get Xe(){let e=[];for(let t of this.Ve)"object"==typeof t&&e.push(t);return this.Ve}}ArrayHelper.Ue=new ArrayProxyHandler;const Shrewd={shrewd:Decorators.U,symbol:$shrewdObject,commit:Core.j,terminate:Core.R,hook:{default:DefaultHook,vue:VueHook},option:Core.$};"undefined"!=typeof window&&window.Vue&&(Core.$.hook=new VueHook);class Adapter{constructor(e,t,r,s){this.ct=e,this.bt=t,this.Ke=r,this.ut=s}get ge(){return this.ct.constructor.name+"."+this.bt.toString()}get te(){return{Ie:this.bt.toString(),Ee:this.ct.constructor.name,le:this.dt,ue:this.ce,$:this.ut}}get ce(){}re(){}}class ComputedPropertyAdapter extends Adapter{get dt(){return ComputedProperty}get ce(){return this.Ke.get}re(){let e=this.ge,t=this.ce;return this.Ke.get=function(){if(HiddenProperty.L(this,$shrewdObject)){return this[$shrewdObject].ae(e).Le()}return t.apply(this)},this.Ke}}class ObservablePropertyAdapter extends Adapter{get dt(){return ObservableProperty}}class ReactiveMethodAdapter extends Adapter{get dt(){return ReactiveMethod}get ce(){return this.Ke.value}re(){let e=this.ge,t=this.ce;return delete this.Ke.value,delete this.Ke.writable,this.Ke.get=function(){if(HiddenProperty.L(this,$shrewdObject)){return this[$shrewdObject].ae(e).Le()}return t.bind(this)},this.Ke}}class Global{static G(e){Global.pt.push(Global.we),Global.we=Object.assign({},Global.we,e)}static M(){Global.we=Global.pt.pop(),0==Global.pt.length&&Core.F()}static get v(){return Global.we.v}static get l(){return Global.we.l}static get u(){return Global.we.u}static get Z(){return Global.we.Z}static p(e){return Global.we.at.has(e)}static ot(e){Global.we.at.add(e)}}Global.we={v:!1,l:!1,u:!1,Z:null,at:new Set},Global.pt=[];const $shrewdDecorators=Symbol("Shrewd Decorators");return Shrewd});
//# sourceMappingURL=shrewd.min.js.map
