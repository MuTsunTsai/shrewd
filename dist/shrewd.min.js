/**
 * shrewd v0.0.0-beta.4
 * (c) 2019 Mu-Tsun Tsai
 * Released under the MIT License.
 */

!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t extends Error{constructor(t,e,s){super(s),this.class=t.constructor.name,this.prop=e.toString(),this.name=`SetupError at ${this.class}[${this.prop}]`}}class e{static t(){e.s++,e.i=!0;for(let t=0;t<e.o.length;t++)if(e.o[t])for(let s of e.o[t])a.h(s);e.o=[],e.i=!1}static get u(){return e.s}static get l(){return e.i}static p(t){let s=t[h];e.o[s]=e.o[s]||new Set,e.o[s].add(t)}}e.s=0,e.o=[],e.i=!1;const s=Symbol("Shrewd Decorators");class r{static get(t){if(u.m(t,s))return t[s];{let e=[];return u.$(t,s,e),e}}static g(t,e){if("string"!=typeof e)return(e,s)=>r.S(e,s,t);r.S(t,e)}static S(e,s,i){if(Object.getOwnPropertyDescriptor(e,s))throw new t(e,s,"Decorated property is not a field.");r.get(e).push({key:s,name:e.constructor.name+"."+s.toString(),type:d,validator:i}),Object.defineProperty(e,s,{get(){return n.get(this).v(),this[s]},set(t){n.get(this).v(),this[s]=t}})}static j(e,s,i){if(!i||!i.get)throw new t(e,s,"Decorated property has no getter.");if(i.set)throw new t(e,s,"Decorated property is not readonly.");let o=Symbol(s.toString());return r.get(e).push({key:o,name:e.constructor.name+"."+s.toString(),type:f,method:i.get}),i.get=function(){let t=n.get(this);return t.v(),t.D(o).O()},i}static k(e,s,i){if(!i||"function"!=typeof i.value)throw new t(e,s,"Decorated member is not a method.");let o=Symbol(s.toString());return r.get(e).push({key:o,name:e.constructor.name+"."+s.toString(),type:b,method:i.value}),delete i.value,delete i.writable,i.get=function(){let t=n.get(this);return t.v(),t.D(o).O()},i}}const i=Symbol("ShrewdObject");class n{constructor(t){this.M=!1,this.q=new Map,this.F=t}static get(t){if(u.m(t,i))return t[i];{let e=new n(t);return u.$(t,i,e),e}}D(t){return this.q.get(t)}v(){if(this.M)return;let t=Object.getPrototypeOf(this.F);for(;t;){if(u.m(t,s)){let e=t[s];for(let t of e)this.q.set(t.key,new t.type(this.F,t))}t=Object.getPrototypeOf(t)}this.M=!0}}var o;const h=Symbol("Dependency Level");class c{constructor(){this[o]=0,this.L=new Set}static get W(){return!e.l||(console.warn("Writing into Observables during committing is forbidden; use computed property instead."),!1)}A(t){this.L.add(t)}B(t){this.L.delete(t)}C(){for(let t of this.L)e.p(t)}}o=h;class u{static m(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static $(t,e,s){Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s})}}class a extends c{constructor(){super(...arguments),this.G=new Set}static H(t){a.I&&a.I.G.add(t)}static h(t){let e=a.I;a.I=t;for(let e of t.G)e.B(t);t.G.clear(),t[h]=0;let s=t.h();for(let e of t.G)e.A(t),e[h]>=t[h]&&(t[h]=e[h]+1);return a.I=e,s}}a.I=null;class l extends a{constructor(t,e){super(),this.F=t,this.J=e.name}get[Symbol.toStringTag](){return this.J}}class f extends l{constructor(t,e){super(t,e),this.M=!1,this.K=e.method}h(){let t=this.K.apply(this.F);t!=this.N&&(this.N=t,this.C())}O(){return a.H(this),this.M||(a.h(this),this.M=!0),this.N}}class d extends l{constructor(t,e){super(t,e),this.M=!1,this.P=e.validator||d.R,Object.defineProperty(t,e.key,d.interceptor(e.key))}static interceptor(t){return d.T[t]=d.T[t]||{get(){return n.get(this).D(t).O()},set(e){n.get(this).D(t).U(e)}}}v(){a.h(this),this.M=!0}O(){return this.M||this.v(),a.H(this),this.V}U(t){c.W&&t!=this.X&&(this.X=t,this.M?this.h():this.v())}h(){let t=this.P.apply(this.F,[this.X]);t!==this.V&&(this.V=t,this.C())}}d.T={},d.R=t=>t;class b extends l{constructor(t,e){super(t,e),this.s=0,this.Y=e.method}O(){return a.H(this),()=>a.h(this)}h(){return e.l&&this.s==e.u||(this.Z=this.Y.apply(this.F),this.s=e.u),this.C(),this.Z}}return{SetupError:t,observable:r.g,computed:r.j,reactive:r.k,commit:e.t}});