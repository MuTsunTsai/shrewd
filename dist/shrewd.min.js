/**
 * shrewd v0.0.0-beta.11
 * (c) 2019 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t extends Error{constructor(t,e,s){super(s),this.class=t.constructor.name,this.prop=e.toString(),this.name=`SetupError at ${this.class}[${this.prop}]`}}class e{static t(){let t=O.s({i:!0});for(let t=0;t<e.o.length;t++)if(e.o[t])for(let s of e.o[t])l.h(s);e.o=[],O.u(t)}static l(){e.t(),e.$=!1}static p(t){let s=e.o[t[c]];s&&s.delete(t)}static g(t){if(!t.m){let s=t[c];e.o[s]=e.o[s]||new Set,e.o[s].add(t)}if(!e.$){Promise.resolve().then(e.l),e.$=!0}}static v(t,...e){let s=O.s({j:!0,i:!1,S:!1,O:null}),r=new t(...e);return O.u(s),r}}e.o=[],e.$=!1;const s=Symbol("Shrewd Decorators");class r{static get(t){if(a.k(t,s))return t[s];{let e=[];return a.R(t,s,e),e}}static D(t,e){if("string"!=typeof e)return(e,s)=>r.P(e,s,t);r.P(t,e)}static P(e,s,i){if(Object.getOwnPropertyDescriptor(e,s))throw new t(e,s,"Decorated property is not a field.");r.get(e).push({M:s,_:e.constructor.name+"."+s.toString(),F:v,W:i}),Object.defineProperty(e,s,{get(){return n.get(this),this[s]},set(t){n.get(this),this[s]=t}})}static q(e,s,i){if(!i||!i.get)throw new t(e,s,"Decorated property has no getter.");if(i.set)throw new t(e,s,"Decorated property is not readonly.");let o=e.constructor.name+"."+s.toString();return r.get(e).push({M:o,_:o,F:w,A:i.get}),i.get=function(){return n.get(this).H(o).C()},i}static I(e,s,i){if(!i||"function"!=typeof i.value)throw new t(e,s,"Decorated member is not a method.");let o=e.constructor.name+"."+s.toString();return r.get(e).push({M:o,_:o,F:j,A:i.value}),delete i.value,delete i.writable,i.get=function(){return n.get(this).H(o).C()},i}}const i=Symbol("ShrewdObject");class n{constructor(t){this.L=!1,this.B=new Map,this.G=a.R(t,i,this);let e=Object.getPrototypeOf(this.G);for(;e;){if(a.k(e,s)){let t=e[s];for(let e of t)this.B.set(e.M,new e.F(this.G,e))}e=Object.getPrototypeOf(e)}}static get(t){return a.k(t,i)?t[i]:new n(t)}J(){if(!this.L){for(let t of this.B.values())t.J();this.L=!0}}H(t){return this.B.get(t)}get K(){let t=[];for(let e of this.B.values())e instanceof v&&t.push(e);return t}}var o;const c=Symbol("Dependency Level");class h{constructor(){this[o]=0,this.N=new Set}static T(t){return!(!O.j&&t.U)||(v.m&&!v.V(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),!1):!(!v.m&&O.i)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty. For constructing new Shrewd objects, use Shrewd.construct() method."),!1))}static X(t){for(let e of t.N)e.Y()}Z(t){this.N.add(t),t[c]<=this[c]&&(t[c]=this[c]+1)}tt(t){this.N.delete(t)}get U(){return this.N.size>0}}o=c;class a{static k(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static R(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class u{isExtensible(t){return!1}}class l extends h{constructor(){super(...arguments),this.et=new Set,this.st=!1,this.rt=!1,this.L=!1}static it(t){let e=O.O;e&&e!=t&&!e.L&&e.et.add(t)}static nt(t){if(t instanceof l&&!(t instanceof j)&&!t.U){let e=new Set(t.et);t.ot(),t.rt=!1;for(let t of e)this.nt(t)}}static h(t){let s=O.s({j:!1,O:t,S:O.S||t instanceof j||t.U});t.st=!0,O.i||e.p(t);let r=new Set(t.et);t.ot();let i=t.h();if(O.S&&(t.rt=!0),!t.L)for(let e of t.et)r.delete(e),O.S&&e.Z(t);for(let t of r)l.nt(t);return t.st=!1,O.u(s),i}Y(){this.rt=!1,e.g(this)}get ct(){return this.rt}get m(){return this.st}ot(){for(let t of this.et)t.tt(this);this.et.clear(),this[c]=0}J(){this.L||(this.ot(),this.L=!0)}get ht(){return this.L}}const f=Symbol("Observable Helper");class $ extends h{constructor(t,e){super(),this.at=a.R(t,f,this),this.ut=new Proxy(t,e),$.lt.set(t,this.ut)}static ft(t){if("object"!=typeof t)return t;if($.lt.has(t))return $.lt.get(t);if(!$.$t(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new S(t).dt;break;case Set.prototype:t=new m(t).dt;break;case Map.prototype:t=new y(t).dt;break;case Object.prototype:t=new g(t).dt}return t}static $t(t){return"object"==typeof t&&a.k(t,f)}get dt(){return this.ut}}$.lt=new WeakMap;class d extends u{get(t,e,s){let r=t[f],i=Reflect.get(t,e);return"function"==typeof i&&(i=this.bt.bind({pt:e,O:t,A:i.bind(t),gt:r,yt:s})),"size"==e&&l.it(t[f]),i}bt(...t){switch(this.pt){case"clear":return void(l.T(this.gt)&&this.O.size>0&&(this.O.clear(),h.X(this.gt)));case"delete":return void(l.T(this.gt)&&this.O.has(t[0])&&(this.O.delete(t[0]),h.X(this.gt)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":l.it(this.gt);default:return this.A(...t)}}}class b extends l{constructor(t,e){super(),this.G=t,this.wt=e._}get[Symbol.toStringTag](){return this.wt}}class p extends u{has(t,e){return l.it(t[f]),Reflect.has(t,e)}get(t,e,s){return l.it(t[f]),Reflect.get(t,e,s)}set(t,e,s,r){let i=t[f];if(h.T(i)){return s!==Reflect.get(t,e,r)&&(Reflect.set(t,e,$.ft(s),r),h.X(i)),!0}return!0}deleteProperty(t,e){let s=t[f];if(h.T(s)){let r=Reflect.deleteProperty(t,e);return r&&h.X(s),r}return!0}}class g extends ${constructor(t){for(let e in t)t[e]=$.ft(t[e]);super(t,g.vt)}get jt(){let t=[];for(let e in this.at){let s=this.at[e];"object"==typeof s&&t.push(s)}return t}}g.vt=new p;class m extends ${constructor(t){for(let e of t)t.delete(e),t.add($.ft(e));super(t,m.vt)}get jt(){let t=[];for(let e of this.at)"object"==typeof e&&t.push(e);return t}}m.vt=new class extends d{bt(...t){return"add"==this.pt?(l.T(this.gt)&&!this.O.has(t[0])&&(this.O.add($.ft(t[0])),h.X(this.gt)),this.yt):super.bt.apply(this,t)}};class y extends ${constructor(t){for(let[e,s]of t)t.set(e,$.ft(s));super(t,y.vt)}get jt(){let t=[];for(let[e,s]of this.at)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}y.vt=new class extends d{bt(...t){return"set"==this.pt?(l.T(this.gt)&&!this.O.has(t[0])&&(this.O.set(t[0],$.ft(t[1])),h.X(this.gt)),this.yt):super.bt.apply(this,t)}};class w extends b{constructor(t,e){super(t,e),this.St=e.A}h(){let t=this.St.apply(this.G);t!=this.xt&&(this.xt=t,h.X(this))}C(){return this.ht||(l.it(this),this.ct||l.h(this)),this.xt}}class v extends b{constructor(t,e){super(t,e),this.Ot=e.W||{},Object.defineProperty(t,e.M,v.kt(e.M))}static kt(t){return v.Rt[t]=v.Rt[t]||{get(){return n.get(this).H(t).C()},set(e){n.get(this).H(t).Dt(e)}}}static get m(){return v.st}static Et(t){if("object"==typeof t)if($.$t(t)){if(!v.Pt.has(t[f])){v.Pt.add(t[f]);for(let e of t[f].jt)v.Et(e)}}else if(a.k(t,i))for(let e of n.get(t).K)v.Pt.has(e)||(v.Pt.add(e),v.Et(e.Mt))}static V(t){return v.Pt.has(t)}C(){return this.ht||(l.it(this),this.Ot.renderer&&!this.ct&&l.h(this)),this.Mt}Dt(t){if(this.ht)console.warn(`[${this.wt}] has been terminated.`);else if(h.T(this)&&t!=this._t){if(this.Ot.validator&&!this.Ot.validator.apply(this.G,[t]))return;this._t=$.ft(t),this.Ot.renderer?l.h(this):this.X(this._t)}}h(){v.st=!0,v.Et(this._t);let t=this.Ot.renderer.apply(this.G,[this._t]);v.Pt.clear(),v.st=!1,t!==this.Mt&&this.X($.ft(t))}X(t){this.Mt=t,h.X(this)}}v.Rt={},v.st=!1,v.Pt=new Set;class j extends b{constructor(t,e){super(t,e),this.bt=e.A}C(){return this.ht||(l.it(this),O.i&&this.ct)?()=>this.Ft:()=>l.h(this)}h(){return this.Ft=this.bt.apply(this.G),h.X(this),this.Ft}}class S extends ${constructor(t){for(let e in t)t[e]=$.ft(t[e]);super(t,S.vt)}get jt(){let t=[];for(let e of this.at)"object"==typeof e&&t.push(e);return this.at}}S.vt=new class extends p{get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&l.it(t[f]),Reflect.get(t,e,s)}};const x={SetupError:t,observable:r.D,computed:r.q,reactive:r.I,commit:e.t,construct:e.v,terminate:function(t){a.k(t,i)&&t[i].J()},Observer:l};class O{static s(t){let e=O.Wt;return O.Wt=Object.assign({},O.Wt,t),e}static u(t){O.Wt=t}static get i(){return O.Wt.i}static get j(){return O.Wt.j}static get S(){return O.Wt.S}static get O(){return O.Wt.O}}return O.Wt={i:!1,j:!1,S:!1,O:null},x});