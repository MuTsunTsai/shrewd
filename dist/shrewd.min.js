/**
 * shrewd v0.0.0-beta.11
 * (c) 2019 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,function(){"use strict";class t extends Error{constructor(t,e,s){super(s),this.class=t.constructor.name,this.prop=e.toString(),this.name=`SetupError at ${this.class}[${this.prop}]`}}class e{static t(){for(x.s({i:!0});e.o.size>0;)for(let t of e.o)u.h(t);u.u(),e.o.clear(),x.l()}static $(){e.t(),e.p=!1}static g(t){e.o.delete(t)}static m(t){if(t.j||e.o.add(t),!e.p){Promise.resolve().then(e.$),e.p=!0}}static v(t,...e){x.s({S:!0,i:!1,O:!1,C:null});let s=new t(...e);return x.l(),s}}e.o=new Set,e.p=!1;const s=Symbol("Shrewd Decorators");class r{static get(t){if(c.R(t,s))return t[s];{let e=[];return c._(t,s,e),e}}static k(e,s,i){if(void 0===s){return(t,s)=>r.A(t,s,e)}if("string"!=typeof s)throw new Error("Incorrect call of decorator.");let n=i||Object.getOwnPropertyDescriptor(e,s);if(n){if(n.get&&!n.set)return r.P(e,s,n);if("function"==typeof n.value)return r.D(e,s,n);throw new t(e,s,"Incorrect call of decorator.")}r.A(e,s)}static A(e,s,i){if(Object.getOwnPropertyDescriptor(e,s))throw new t(e,s,"Decorated property is not a field.");r.get(e).push({M:s,I:e.constructor.name+"."+s.toString(),W:y,q:i}),Object.defineProperty(e,s,{get(){return n.get(this),this[s]},set(t){n.get(this),this[s]=t}})}static P(e,s,i){if(!i||!i.get)throw new t(e,s,"Decorated property has no getter.");if(i.set)throw new t(e,s,"Decorated property is not readonly.");let o=e.constructor.name+"."+s.toString();return r.get(e).push({M:o,I:o,W:m,F:i.get}),i.get=function(){return n.get(this).T(o).H()},i}static D(e,s,i){if(!i||"function"!=typeof i.value)throw new t(e,s,"Decorated member is not a method.");let o=e.constructor.name+"."+s.toString();return r.get(e).push({M:o,I:o,W:j,F:i.value}),delete i.value,delete i.writable,i.get=function(){return n.get(this).T(o).H()},i}}const i=Symbol("ShrewdObject");class n{constructor(t){this.B=!1,this.G=new Map,this.J=c._(t,i,this);let e=Object.getPrototypeOf(this.J);for(;e;){if(c.R(e,s)){let t=e[s];for(let e of t)this.G.set(e.M,new e.W(this.J,e))}e=Object.getPrototypeOf(e)}}static get(t){return c.R(t,i)?t[i]:new n(t)}K(){if(!this.B){for(let t of this.G.values())t.K();this.B=!0}}T(t){return this.G.get(t)}get L(){let t=[];for(let e of this.G.values())e instanceof y&&t.push(e);return t}}class o{constructor(){this.N=new Set}static U(t){return!(!x.S&&t.V)||(y.j&&!y.X(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),!1):!(!y.j&&x.i)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty. For constructing new Shrewd objects, use Shrewd.construct() method."),!1))}static Y(t){for(let e of t.N)e.Z()}tt(t){this.N.add(t)}et(t){this.N.delete(t)}get V(){return this.N.size>0}get st(){return this.N.values()}}class c{static R(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static _(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class h{isExtensible(t){return!1}}var a;!function(t){t[t.rt=0]="$outdated",t[t.it=1]="$updated",t[t.nt=2]="$pending"}(a||(a={}));class u extends o{constructor(){super(...arguments),this.ot=new Set,this.ct=!1,this.ht=a.rt,this.B=!1}static u(){for(let t of u.at)t.ht==a.nt&&t.ut();u.at.clear()}static lt(t){let e=x.C;e&&e!=t&&!e.B&&e.ot.add(t)}static ft(t){if(t instanceof u&&!t.dt){let s=new Set(t.ot);t.$t(),e.g(t),t.ht=a.rt;for(let t of s)u.ft(t)}}static h(t){x.s({S:!1,C:t,O:x.O||t.dt}),t.ct=!0,e.g(t);let s=new Set(t.ot);t.$t();let r=t.h();if(x.O&&t.ut(),!t.B)for(let e of t.ot)s.delete(e),x.O&&e.tt(t);for(let t of s)u.ft(t);return t.ct=!1,x.l(),r}get j(){return this.ct}Z(){this.bt(),this.ht=a.rt,e.m(this)}K(){this.B||(this.$t(),this.ut(),this.B=!0)}bt(){if(this.ht==a.it){this.ht=a.nt,u.at.add(this);for(let t of this.st)t.bt()}}pt(){if(this.ht!=a.it){for(let t of this.ot)if(t instanceof u){if(t.ct)throw new Error(`Circular dependency detected as ${this} attempt to read ${t}.`);t.ht!=a.it&&t.pt()}this.ht==a.rt?u.h(this):(u.at.delete(this),this.ut())}}ut(){this.ht=a.it}get gt(){return this.ht==a.nt}get dt(){return this.V}$t(){for(let t of this.ot)t.et(this);this.ot.clear()}get wt(){return this.B}}u.at=new Set;const l=Symbol("Observable Helper");class f extends o{constructor(t,e){super(),this.yt=c._(t,l,this),this.jt=new Proxy(t,e),f.vt.set(t,this.jt)}static St(t){if("object"!=typeof t)return t;if(f.vt.has(t))return f.vt.get(t);if(!f.xt(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new v(t).Ot;break;case Set.prototype:t=new g(t).Ot;break;case Map.prototype:t=new w(t).Ot;break;case Object.prototype:t=new p(t).Ot}return t}static xt(t){return"object"==typeof t&&c.R(t,l)}get Ot(){return this.jt}}f.vt=new WeakMap;class d extends h{get(t,e,s){let r=t[l],i=Reflect.get(t,e);return"function"==typeof i&&(i=this.Ct.bind({Rt:e,C:t,F:i.bind(t),_t:r,kt:s})),"size"==e&&u.lt(t[l]),i}Ct(...t){switch(this.Rt){case"clear":return void(u.U(this._t)&&this.C.size>0&&(this.C.clear(),o.Y(this._t)));case"delete":return void(u.U(this._t)&&this.C.has(t[0])&&(this.C.delete(t[0]),o.Y(this._t)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":u.lt(this._t);default:return this.F(...t)}}}class $ extends u{constructor(t,e){super(),this.J=t,this.At=e.I}get[Symbol.toStringTag](){return this.At}}class b extends h{has(t,e){return u.lt(t[l]),Reflect.has(t,e)}get(t,e,s){return u.lt(t[l]),Reflect.get(t,e,s)}set(t,e,s,r){let i=t[l];if(o.U(i)){return s!==Reflect.get(t,e,r)&&(Reflect.set(t,e,f.St(s),r),o.Y(i)),!0}return!0}deleteProperty(t,e){let s=t[l];if(o.U(s)){let r=Reflect.deleteProperty(t,e);return r&&o.Y(s),r}return!0}}class p extends f{constructor(t){for(let e in t)t[e]=f.St(t[e]);super(t,p.Pt)}get Et(){let t=[];for(let e in this.yt){let s=this.yt[e];"object"==typeof s&&t.push(s)}return t}}p.Pt=new b;class g extends f{constructor(t){for(let e of t)t.delete(e),t.add(f.St(e));super(t,g.Pt)}get Et(){let t=[];for(let e of this.yt)"object"==typeof e&&t.push(e);return t}}g.Pt=new class extends d{Ct(...t){return"add"==this.Rt?(u.U(this._t)&&!this.C.has(t[0])&&(this.C.add(f.St(t[0])),o.Y(this._t)),this.kt):super.Ct.apply(this,t)}};class w extends f{constructor(t){for(let[e,s]of t)t.set(e,f.St(s));super(t,w.Pt)}get Et(){let t=[];for(let[e,s]of this.yt)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}w.Pt=new class extends d{Ct(...t){return"set"==this.Rt?(u.U(this._t)&&!this.C.has(t[0])&&(this.C.set(t[0],f.St(t[1])),o.Y(this._t)),this.kt):super.Ct.apply(this,t)}};class m extends ${constructor(t,e){super(t,e),this.Dt=e.F}h(){let t=this.Dt.apply(this.J);t!=this.Mt&&(this.Mt=t,o.Y(this))}H(){return this.wt||(u.lt(this),this.pt()),this.Mt}}class y extends ${constructor(t,e){super(t,e),this.It=e.q||{},Object.defineProperty(t,e.M,y.Wt(e.M)),this.It.renderer||this.ut()}static Wt(t){return y.qt[t]=y.qt[t]||{get(){return n.get(this).T(t).H()},set(e){n.get(this).T(t).Ft(e)}}}static get j(){return y.ct}static Ht(t){if("object"==typeof t)if(f.xt(t)){if(!y.zt.has(t[l])){y.zt.add(t[l]);for(let e of t[l].Et)y.Ht(e)}}else if(c.R(t,i))for(let e of n.get(t).L)y.zt.has(e)||(y.zt.add(e),y.Ht(e.Tt))}static X(t){return y.zt.has(t)}H(){return this.wt||(u.lt(this),this.It.renderer&&this.pt()),this.Tt}Ft(t){if(this.wt)console.warn(`[${this.At}] has been terminated.`);else if(o.U(this)&&t!=this.Bt){if(this.It.validator&&!this.It.validator.apply(this.J,[t]))return;this.Bt=f.St(t),this.It.renderer?u.h(this):this.Y(this.Bt)}}h(){y.ct=!0,y.Ht(this.Bt);let t=this.It.renderer.apply(this.J,[this.Bt]);y.zt.clear(),y.ct=!1,t!==this.Tt&&this.Y(f.St(t))}Y(t){this.Tt=t,o.Y(this)}}y.qt={},y.ct=!1,y.zt=new Set;class j extends ${constructor(t,e){super(t,e),this.Ct=e.F}get dt(){return!0}H(){if(!this.wt){if(u.lt(this),!x.i&&!this.gt)return()=>u.h(this);this.pt()}return()=>this.Gt}h(){return this.Gt=this.Ct.apply(this.J),o.Y(this),this.Gt}}class v extends f{constructor(t){for(let e in t)t[e]=f.St(t[e]);super(t,v.Pt)}get Et(){let t=[];for(let e of this.yt)"object"==typeof e&&t.push(e);return this.yt}}v.Pt=new class extends b{get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&u.lt(t[l]),Reflect.get(t,e,s)}};const S={shrewd:r.k,commit:e.t,construct:e.v,terminate:function(t){c.R(t,i)&&t[i].K()}};class x{static s(t){x.Jt.push(x.ht),x.ht=Object.assign({},x.ht,t)}static l(){x.ht=x.Jt.pop()}static get i(){return x.ht.i}static get S(){return x.ht.S}static get O(){return x.ht.O}static get C(){return x.ht.C}}return x.ht={i:!1,S:!1,O:!1,C:null},x.Jt=[],S});