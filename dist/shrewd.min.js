/**
 * shrewd v0.0.4
 * (c) 2019-2020 Mu-Tsun Tsai
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Shrewd=e()}(this,(function(){"use strict";class t{constructor(){this.t=new Set,this.s=t.i++}static h(t){return!(!R.o&&t.u)||(R.l&&!R.$(t)?(console.warn("Inside a renderer function, only the objects owned by the ObservableProperty can be written."),i.p.debug,!1):!(!R.l&&R.g)||(console.warn("Writing into Observables is not allowed inside a ComputedProperty or a ReactiveMethod. For self-correcting behavior, use the renderer option of the ObservableProperty."),i.p.debug,!1))}static m(t){i.p.hook.write(t.s);for(let e of t.t)e.v()}_(t){this.t.add(t)}S(t){this.t.delete(t)}get u(){return this.t.size>0}get j(){return this.t.values()}}t.i=0;class e{read(t){return!1}write(t){}gc(){return[]}sub(t){return!1}}class s{constructor(t){if(this.O=t||Vue,!this.O)throw new Error("Global Vue not found; you need to pass a Vue constructor to VueHook.");this.R=new this.O({data:{shrewd:{}}})}read(t){let e=this.R.shrewd[t];return e&&e.C.dep.subs.length>0}write(t){this.O.set(this.R.shrewd,t,{})}gc(){let t=[];for(let e in this.R.shrewd)0==this.R.shrewd[e].C.dep.subs.length&&(this.O.delete(this.R.shrewd,e),t.push(Number(e)));return t}sub(t){return t in this.R.shrewd&&this.R.shrewd[t].C.dep.subs.length>0}}class i{static k(){R.P({g:!0});try{for(let t of i.A)l.G(t)}finally{l.M(),i.A.clear(),R.D();for(let t of i.V)t.W();i.V.clear();for(let t of i.p.hook.gc()){let e=l.q.get(t);e&&l.H(e)}}}static T(t){i.F.add(t)}static I(){if(!i.K){i.K=!0;for(let t of i.F)i.F.delete(t),t.I();i.K=!1}}static N(){i.k(),i.B=!1}static J(t){i.A.delete(t)}static L(t){if(t.U||i.A.add(t),i.p.autoCommit&&!i.B){Promise.resolve().then(i.N),i.B=!0}}static W(t,e=!1){if(o.X(t,n)){let s=t[n];e?i.V.add(s):s.W()}}}i.p={hook:new e,autoCommit:!0,debug:!0},i.A=new Set,i.V=new Set,i.F=new Set,i.B=!1,i.K=!1;class r{static get(t){if(o.X(t,C))return t[C];{let e=[];return o.Y(t,C,e),e}}static Z(t,e,s,n){if(void 0===e)return"function"==typeof t?r.tt(t):(e,s,i)=>r.Z(e,s,i,t);if("string"==typeof e){let i=s||Object.getOwnPropertyDescriptor(t,e);if(!i)return r.et(x,t,e,void 0,n);if(i.get&&!i.set)return r.et(j,t,e,i,n);if("function"==typeof i.value)return r.et(O,t,e,i,n)}console.warn(`Setup error at ${t.constructor.name}[${e.toString()}]. Decorated member must be one of the following: a field, a readonly get accessor, or a method.`),i.p.debug}static tt(t){var e=new Proxy(t,r.st);return r.it.add(e),e}static et(t,e,s,i,n){var h=new t(e,s,i,n);return r.get(e).push(h.rt),h.nt()}}r.it=new WeakSet,r.st={construct(t,e,s){r.it.has(s)||console.warn(`Class [${s.name}] is derived form @shrewd class [${t.name}], but it is not decorated with @shrewd.`),R.P({o:!0,g:!1,ht:null}),l.ot.push("construct "+t.name);try{let i=Reflect.construct(t,e,s);return i.constructor==t&&new h(i),i}finally{l.ot.pop(),R.D()}}};const n=Symbol("ShrewdObject");class h{constructor(t){this.ct=!1,this.ut=new Map,this.lt=o.Y(t,n,this);let e=Object.getPrototypeOf(this.lt);for(;e;){if(o.X(e,C)){let t=e[C];for(let e of t){let t=new e.at(this.lt,e);this.ut.set(t.ft,t)}}e=Object.getPrototypeOf(e)}for(let t of this.ut.values())i.T(t)}W(){if(!this.ct){for(let t of this.ut.values())t.W();this.ct=!0}}dt(t){return this.ut.get(t)}get $t(){let t=[];for(let e of this.ut.values())e instanceof m&&t.push(e);return t}}class o{static X(t,e){return Object.prototype.hasOwnProperty.call(t,e)}static Y(t,e,s){return Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!1,value:s}),t}}class c{get(t,e,s){let i=t[a],r=Reflect.get(t,e);return"function"==typeof r&&(r=this.pt.bind({bt:e,ht:t,gt:r.bind(t),yt:i,wt:s})),"size"==e&&l.vt(t[a]),r}pt(...e){switch(this.bt){case"clear":return void(l.h(this.yt)&&this.ht.size>0&&(this.ht.clear(),t.m(this.yt)));case"delete":return void(l.h(this.yt)&&this.ht.has(e[0])&&(this.ht.delete(e[0]),t.m(this.yt)));case Symbol.iterator:case"entries":case"forEach":case"has":case"keys":case"values":l.vt(this.yt);default:return this.gt(...e)}}}var u;!function(t){t[t._t=0]="$outdated",t[t.St=1]="$updated",t[t.jt=2]="$pending"}(u||(u={}));class l extends t{constructor(t){super(),this.xt=new Set,this.Ot=!1,this.Rt=u._t,this.ct=!1,l.q.set(this.s,this),this.Ct=t}static M(){for(let t of l.kt)t.Rt==u.jt&&t.Pt&&(t.At(),l.kt.delete(t))}static vt(t){if(t instanceof l&&t.ct)return;i.p.hook.read(t.s)&&t instanceof l&&t.activate();let e=R.ht;e&&e!=t&&!e.ct&&e.xt.add(t)}static H(t){if(t instanceof l&&!t.ct&&!(t.Gt=t.checkActive())){let e=new Set(t.xt);i.J(t);for(let t of e)l.H(t)}}static G(t){R.P({o:!1,ht:t}),t.Ot=!0,i.J(t);try{let e=new Set(t.xt);t.Mt();let s=t.G();if(t.At(),!t.ct)for(let s of t.xt)e.delete(s),s._(t),t.Pt&&s instanceof l&&s.activate();for(let t of e)l.H(t);return s}finally{t.Ot=!1,R.D()}}get U(){return this.Ot}v(){this.zt(),this.Dt(),this.Pt&&i.L(this)}W(){this.ct||(i.J(this),l.q.delete(this.s),l.kt.delete(this),this.ct=!0,this.Vt())}Vt(){this.Mt();for(let t of this.j)t.xt.delete(this),this.S(t);this.At(),this.Ot=!1}zt(){if(this.Rt==u.St){this.Rt=u.jt,l.kt.add(this);for(let t of this.j)t.zt()}}Wt(t=!1){if(this.Ot&&this.qt(),this.Rt!=u.St){l.ot.push(this);try{for(let t of this.xt)if(t instanceof l){if(t.Ot){l.G(this);break}t.Rt!=u.St&&t.Wt()}this.Rt==u._t||t?l.G(this):(l.kt.delete(this),this.At())}finally{l.ot.pop()}}}qt(){i.p.debug;let t=l.ot.indexOf(this),e=[this,...l.ot.slice(t+1)];e.forEach(t=>t instanceof l&&t.W()),e.push(this);let s=e.map(t=>"string"==typeof t?t:t.Ct).join(" => ");console.warn("Cyclic dependency detected: "+s+"\nAll these reactions will be terminated.")}At(){this.Rt=u.St}Dt(){this.Rt=u._t}get Et(){return this.Rt}get Pt(){return this.Gt=null!=this.Gt?this.Gt:this.checkActive()}checkActive(){if(i.p.hook.sub(this.s))return!0;for(let t of this.j)if(t.Pt)return!0;return!1}activate(){if(!this.Pt){this.Gt=!0;for(let t of this.xt)t instanceof l&&t.activate()}}Mt(){for(let t of this.xt)t.S(this);this.xt.clear()}get Ht(){return this.xt.size>0}get Tt(){return this.ct}}l.kt=new Set,l.q=new Map,l.ot=[];const a=Symbol("Observable Helper");class f extends t{constructor(t,e){super(),this.Ft=o.Y(t,a,this),this.It=new Proxy(t,e),f.Kt.set(t,this.It)}static Nt(t){if(null==t||"object"!=typeof t)return t;if(f.Kt.has(t))return f.Kt.get(t);if(!f.Bt(t))switch(Object.getPrototypeOf(t)){case Array.prototype:t=new v(t).Jt;break;case Set.prototype:t=new b(t).Jt;break;case Map.prototype:t=new g(t).Jt;break;case Object.prototype:t=new p(t).Jt}return t}static Bt(t){return null!=t&&"object"==typeof t&&o.X(t,a)}get Jt(){return this.It}}f.Kt=new WeakMap;class d extends l{constructor(t,e){super(e.Lt+"."+e.Qt.toString()),this.Ut=e,this.Xt=Object.assign(this.Yt,e.p),this.lt=t}get ft(){return this.Ut.Lt+"."+this.Ut.Qt.toString()}I(){this.Wt()}get Yt(){return{}}checkActive(){return!!this.Xt.active||super.checkActive()}Zt(){return this.Tt?this.te():(l.vt(this),this.ee())}}class ${has(t,e){return l.vt(t[a]),Reflect.has(t,e)}get(t,e,s){return l.vt(t[a]),Reflect.get(t,e,s)}set(e,s,i,r){let n=e[a];if(t.h(n)){return i!==Reflect.get(e,s,r)&&(Reflect.set(e,s,f.Nt(i),r),t.m(n)),!0}return!0}deleteProperty(e,s){let i=e[a];if(t.h(i)){let r=Reflect.deleteProperty(e,s);return r&&t.m(i),r}return!0}}class p extends f{constructor(t){for(let e in t)t[e]=f.Nt(t[e]);super(t,p.se)}get ie(){let t=[];for(let e in this.Ft){let s=this.Ft[e];"object"==typeof s&&t.push(s)}return t}}p.se=new $;class b extends f{constructor(t){for(let e of t)t.delete(e),t.add(f.Nt(e));super(t,b.se)}get ie(){let t=[];for(let e of this.Ft)"object"==typeof e&&t.push(e);return t}}b.se=new class extends c{pt(...e){return"add"==this.bt?(l.h(this.yt)&&!this.ht.has(e[0])&&(this.ht.add(f.Nt(e[0])),t.m(this.yt)),this.wt):super.pt.apply(this,e)}};class g extends f{constructor(t){for(let[e,s]of t)t.set(e,f.Nt(s));super(t,g.se)}get ie(){let t=[];for(let[e,s]of this.Ft)"object"==typeof e&&t.push(e),"object"==typeof s&&t.push(s);return t}}g.se=new class extends c{pt(...e){return"set"==this.bt?(l.h(this.yt)&&!this.ht.has(e[0])&&(this.ht.set(e[0],f.Nt(e[1])),t.m(this.yt)),this.wt):super.pt.apply(this,e)}};class y extends d{constructor(t,e){super(t,e),this.re=e.gt,this.Xt.active&&this.v()}G(){let e=this.re.apply(this.lt);e!==this.ne&&(this.ne=e,t.m(this)),this.Ht||this.W()}ee(){return this.Wt(),this.Ht||this.W(),this.ne}te(){return this.ne}}class m extends d{constructor(t,e){super(t,e),this.he=!1,this.oe=t[e.Qt],Object.defineProperty(t,e.Qt,m.ce(e.Qt)),this.Xt.renderer||this.At()}static ce(t){return m.ue[t]=m.ue[t]||{get(){return this[n].dt(t).Zt()},set(e){this[n].dt(t).le(e)}}}static ae(t){if(null!=t&&"object"==typeof t)if(f.Bt(t)){if(!R.$(t[a])){R.ae(t[a]);for(let e of t[a].ie)m.ae(e)}}else if(o.X(t,n))for(let e of t[n].$t)R.$(e)||(R.ae(e),m.ae(e.fe))}get ft(){return this.Ut.Qt.toString()}I(){this.he||(this.Xt.validator&&!this.Xt.validator.apply(this.lt,[this.oe])&&(this.oe=void 0),this.de(this.oe),this.he=!0)}Dt(){this.Xt.renderer&&super.Dt()}ee(){return this.he?this.Xt.renderer&&this.Wt():this.I(),this.fe}te(){return this.fe}le(e){if(this.Tt)this.fe=e;else if(t.h(this)&&e!==this.oe){if(this.Xt.validator&&!this.Xt.validator.apply(this.lt,[e]))return i.p.hook.write(this.s);this.de(e)}}de(t){this.oe=f.Nt(t),this.Xt.renderer?this.G():this.m(this.oe)}G(){R.P({l:!0,$e:new Set});try{m.ae(this.oe);let t=this.Xt.renderer.apply(this.lt,[this.oe]);t!==this.fe&&this.m(f.Nt(t))}finally{R.D()}}m(e){this.fe=e,t.m(this)}Vt(){delete this.oe,delete this.Xt,super.Vt()}}m.ue={};class w extends d{constructor(t,e){super(t,e),this.pt=e.gt}get Yt(){return{active:!0}}ee(){return()=>(this.Wt(),this.pe)}te(){return()=>this.pe}G(){return this.pe=this.pt.apply(this.lt),t.m(this),this.pe}}class v extends f{constructor(t){for(let e in t)t[e]=f.Nt(t[e]);super(t,v.se)}get ie(){let t=[];for(let e of this.Ft)"object"==typeof e&&t.push(e);return this.Ft}}v.se=new class extends ${get(t,e,s){return("length"==e||"symbol"==typeof e||"number"==typeof e||"string"==typeof e&&e.match(/^\d+$/))&&l.vt(t[a]),Reflect.get(t,e,s)}};const _={shrewd:r.Z,symbol:n,commit:i.k,terminate:i.W,hook:{default:e,vue:s},option:i.p};"undefined"!=typeof window&&window.Vue&&(i.p.hook=new s);class S{constructor(t,e,s,i){this.be=t,this.ge=e,this.Ut=s,this.ye=i}get Ct(){return this.be.constructor.name+"."+this.ge.toString()}get rt(){return{Qt:this.ge.toString(),Lt:this.be.constructor.name,at:this.me,gt:this.pt,p:this.ye}}get pt(){}nt(){}}class j extends S{get me(){return y}get pt(){return this.Ut.get}nt(){let t=this.Ct,e=this.pt;return this.Ut.get=function(){if(o.X(this,n)){return this[n].dt(t).Zt()}return e.apply(this)},this.Ut}}class x extends S{get me(){return m}}class O extends S{get me(){return w}get pt(){return this.Ut.value}nt(){let t=this.Ct,e=this.pt;return delete this.Ut.value,delete this.Ut.writable,this.Ut.get=function(){if(o.X(this,n)){return this[n].dt(t).Zt()}return e.bind(this)},this.Ut}}class R{static P(t){R.we.push(R.Rt),R.Rt=Object.assign({},R.Rt,t)}static D(){R.Rt=R.we.pop(),0==R.we.length&&i.I()}static get g(){return R.Rt.g}static get o(){return R.Rt.o}static get l(){return R.Rt.l}static get ht(){return R.Rt.ht}static $(t){return R.Rt.$e.has(t)}static ae(t){R.Rt.$e.add(t)}}R.Rt={g:!1,o:!1,l:!1,ht:null,$e:new Set},R.we=[];const C=Symbol("Shrewd Decorators");return _}));
//# sourceMappingURL=shrewd.min.js.map
